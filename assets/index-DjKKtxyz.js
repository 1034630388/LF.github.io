import{T as ot}from"./ThemeToggle-DVmo2TGF.js";import{k as Ae,c as N,i as k,a as m,J as ce,q as F,I as j,S as Fe,d as s,r as b,o as We,L as nt,z as Oe,f as E,b as D,w as r,a3 as lt,O as be,n as $,V as Te,T as De,P as we,p as me,K as Ce,j as _,t as W,a4 as xe,G as st,s as at,v as rt,y as it,l as ut,u as g,F as ct,g as dt,e as ft,N as x,E as H}from"./index-wKIbGhGo.js";import{_ as mt}from"./xiaoyugan-Dwisk7G8.js";import pt from"./manual-BHLFA9VF.js";import vt from"./url-C_cSU-nf.js";import{K as kt,E as yt,B as gt,T as bt}from"./bin-CSOk44Ez.js";import{_ as Tt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Re,g as Pe,e as Me,s as Ve,j as He,B as Ge,c as se,k as Ie,d as Le}from"./index-xPc3ULf4.js";import{g as wt,i as Ct,o as de,b as Ue,c as ht,d as St,e as $t,f as _t,h as Bt,j as Ot,u as Mt,k as Ut,l as Et,m as At,n as Pt,M as Dt,p as xt,q as he,r as It}from"./index-DikGr7Uh.js";import{C as Lt,S as jt}from"./index-CEanjQJS.js";import{A as je}from"./Add-DyUH0i3w.js";import{H as Ne}from"./Home-Bl2Fl15-.js";import{M as Nt,S as zt}from"./Star-BFyi0QRs.js";import{R as ze}from"./Refresh-B4apZMLB.js";import{E as Ft}from"./EllipsisHorizontal-BXjMV4b_.js";import{S as Wt,T as Rt}from"./TrashBin-BdQjjFcw.js";import{C as Vt}from"./Create-DecgUSGI.js";import{C as Ht}from"./Copy-B4mkBN3W.js";import"./Sunny-DXo3UMBW.js";import"./CloudUpload-bfszKK-e.js";import"./index-ngrFHoWO.js";const Gt=Ae({name:"IconInfoCircleFill",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:e=>["butt","round","square"].includes(e)},strokeLinejoin:{type:String,default:"miter",validator:e=>["arcs","bevel","miter","miter-clip","round"].includes(e)},rotate:Number,spin:Boolean},emits:{click:e=>!0},setup(e,{emit:n}){const i=Pe("icon"),a=j(()=>[i,`${i}-info-circle-fill`,{[`${i}-spin`]:e.spin}]),y=j(()=>{const c={};return e.size&&(c.fontSize=Me(e.size)?`${e.size}px`:e.size),e.rotate&&(c.transform=`rotate(${e.rotate}deg)`),c});return{cls:a,innerStyle:y,onClick:c=>{n("click",c)}}}}),Kt=["stroke-width","stroke-linecap","stroke-linejoin"];function Yt(e,n,i,a,y,l){return k(),N("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:F(e.cls),style:ce(e.innerStyle),"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin,onClick:n[0]||(n[0]=(...c)=>e.onClick&&e.onClick(...c))},n[1]||(n[1]=[m("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M24 44c11.046 0 20-8.954 20-20S35.046 4 24 4 4 12.954 4 24s8.954 20 20 20Zm2-30a1 1 0 0 0-1-1h-2a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-2Zm0 17h1a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-6a1 1 0 0 1-1-1v-2a1 1 0 0 1 1-1h1v-8a1 1 0 0 1-1-1v-2a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1v11Z",fill:"currentColor",stroke:"none"},null,-1)]),14,Kt)}var Se=Re(Gt,[["render",Yt]]);const qt=Object.assign(Se,{install:(e,n)=>{var i;const a=(i=n==null?void 0:n.iconPrefix)!=null?i:"";e.component(a+Se.name,Se)}}),Xt=["red","orangered","orange","gold","lime","green","cyan","arcoblue","purple","pinkpurple","magenta","gray"],Zt=["normal","processing","success","warning","danger"];var $e=Ae({name:"Badge",props:{text:{type:String},dot:{type:Boolean},dotStyle:{type:Object},maxCount:{type:Number,default:99},offset:{type:Array,default:()=>[]},color:{type:String},status:{type:String,validator:e=>Zt.includes(e)},count:{type:Number}},setup(e,{slots:n}){const{status:i,color:a,dotStyle:y,offset:l,text:c,dot:M,maxCount:w,count:f}=Fe(e),p=Pe("badge"),C=Jt(p,i==null?void 0:i.value,n==null?void 0:n.default),A=j(()=>{const u={...(y==null?void 0:y.value)||{}},[h,B]=(l==null?void 0:l.value)||[];h&&(u.marginRight=`${-h}px`),B&&(u.marginTop=`${B}px`);const O=!(a!=null&&a.value)||Xt.includes(a==null?void 0:a.value)?{}:{backgroundColor:a.value};return{mergedStyle:{...O,...u},computedDotStyle:u,computedColorStyle:O}}),P=()=>{const u=c==null?void 0:c.value,h=a==null?void 0:a.value,B=i==null?void 0:i.value,O=M==null?void 0:M.value,U=Number(f==null?void 0:f.value),G=(f==null?void 0:f.value)!=null,{computedDotStyle:I,mergedStyle:z}=A.value;return n.content?s("span",{class:`${p}-custom-dot`,style:I},[n.content()]):u&&!h&&!B?s("span",{class:`${p}-text`,style:I},[u]):B||h&&!G?s("span",{class:`${p}-status-wrapper`},[s("span",{class:[`${p}-status-dot`,{[`${p}-status-${B}`]:B,[`${p}-color-${h}`]:h}],style:z},null),u&&s("span",{class:`${p}-status-text`},[u])]):(O||h)&&U>0?s("span",{class:[`${p}-dot`,{[`${p}-color-${h}`]:h}],style:z},null):U===0?null:s("span",{class:`${p}-number`,style:z},[s("span",null,[w.value&&U>w.value?`${w.value}+`:U])])};return()=>s("span",{class:C.value},[n.default&&n.default(),P()])}});const Jt=(e,n,i)=>j(()=>[e,{[`${e}-status`]:n,[`${e}-no-children`]:!i}]),Qt=Object.assign($e,{install:(e,n)=>{Ve(e,n);const i=He(n);e.component(i+$e.name,$e)}}),eo=e=>{const n=b(!1),i={overflow:"",width:"",boxSizing:""};return{setOverflowHidden:()=>{if(e.value){const l=e.value;if(!n.value&&l.style.overflow!=="hidden"){const c=wt(l);(c>0||Ct(l))&&(i.overflow=l.style.overflow,i.width=l.style.width,i.boxSizing=l.style.boxSizing,l.style.overflow="hidden",l.style.width=`${l.offsetWidth-c}px`,l.style.boxSizing="border-box",n.value=!0)}}},resetOverflow:()=>{if(e.value&&n.value){const l=e.value;l.style.overflow=i.overflow,l.style.width=i.width,l.style.boxSizing=i.boxSizing,n.value=!1}}}},to=({modalRef:e,wrapperRef:n,draggable:i,alignCenter:a})=>{const y=b(!1),l=b([0,0]),c=b([0,0]),M=b(),w=b([0,0]),f=b([0,0]),p=()=>{var u,h,B;if(n.value&&e.value){const{top:O,left:U}=n.value.getBoundingClientRect(),{clientWidth:G,clientHeight:I}=n.value,{top:z,left:Z,width:K,height:Y}=e.value.getBoundingClientRect(),R=a.value?0:(u=e.value)==null?void 0:u.offsetTop,L=Z-U,J=z-O-R;(L!==((h=c.value)==null?void 0:h[0])||J!==((B=c.value)==null?void 0:B[1]))&&(c.value=[L,J]);const q=G>K?G-K:0,Q=I>Y?I-Y-R:0;(q!==f.value[0]||Q!==f.value[1])&&(f.value=[q,Q]),R&&(w.value=[0,0-R])}},C=u=>{i.value&&(u.preventDefault(),y.value=!0,p(),l.value=[u.x,u.y],de(window,"mousemove",A),de(window,"mouseup",P),de(window,"contextmenu",P))},A=u=>{if(y.value){const h=u.x-l.value[0],B=u.y-l.value[1];let O=c.value[0]+h,U=c.value[1]+B;O<w.value[0]&&(O=w.value[0]),O>f.value[0]&&(O=f.value[0]),U<w.value[1]&&(U=w.value[1]),U>f.value[1]&&(U=f.value[1]),M.value=[O,U]}},P=()=>{y.value=!1,Ue(window,"mousemove",A),Ue(window,"mouseup",P)};return{position:M,handleMoveDown:C}};var oo=Ae({name:"Modal",components:{ClientOnly:Ot,ArcoButton:Ge,IconHover:Bt,IconClose:_t,IconInfoCircleFill:qt,IconCheckCircleFill:$t,IconExclamationCircleFill:St,IconCloseCircleFill:ht},inheritAttrs:!1,props:{visible:{type:Boolean,default:void 0},defaultVisible:{type:Boolean,default:!1},width:{type:[Number,String]},top:{type:[Number,String]},mask:{type:Boolean,default:!0},title:{type:String},titleAlign:{type:String,default:"center"},alignCenter:{type:Boolean,default:!0},unmountOnClose:Boolean,maskClosable:{type:Boolean,default:!0},hideCancel:{type:Boolean,default:!1},simple:{type:Boolean,default:e=>e.notice},closable:{type:Boolean,default:!0},okText:String,cancelText:String,okLoading:{type:Boolean,default:!1},okButtonProps:{type:Object},cancelButtonProps:{type:Object},footer:{type:Boolean,default:!0},renderToBody:{type:Boolean,default:!0},popupContainer:{type:[String,Object],default:"body"},maskStyle:{type:Object},modalClass:{type:[String,Array]},modalStyle:{type:Object},onBeforeOk:{type:Function},onBeforeCancel:{type:Function},escToClose:{type:Boolean,default:!0},draggable:{type:Boolean,default:!1},fullscreen:{type:Boolean,default:!1},maskAnimationName:{type:String,default:e=>e.fullscreen?"fade-in-standard":"fade-modal"},modalAnimationName:{type:String,default:e=>e.fullscreen?"zoom-in":"zoom-modal"},bodyClass:{type:[String,Array]},bodyStyle:{type:[String,Object,Array]},messageType:{type:String},hideTitle:{type:Boolean,default:!1}},emits:{"update:visible":e=>!0,ok:e=>!0,cancel:e=>!0,open:()=>!0,close:()=>!0,beforeOpen:()=>!0,beforeClose:()=>!0},setup(e,{emit:n}){const{fullscreen:i,popupContainer:a,alignCenter:y}=Fe(e),l=Pe("modal"),{t:c}=Mt(),M=b(),w=b(),f=b(e.defaultVisible),p=j(()=>{var t;return(t=e.visible)!=null?t:f.value}),C=b(!1),A=j(()=>e.okLoading||C.value),P=j(()=>e.draggable&&!e.fullscreen),{teleportContainer:u,containerRef:h}=Ut({popupContainer:a,visible:p}),B=b(p.value),O=j(()=>e.okText||c("modal.okText")),U=j(()=>e.cancelText||c("modal.cancelText")),{zIndex:G,isLastDialog:I}=Et("dialog",{visible:p});let z=!1;const Z=t=>{e.escToClose&&t.key===kt.ESC&&I()&&te(t)},K=()=>{e.escToClose&&!z&&(z=!0,de(document.documentElement,"keydown",Z))},Y=()=>{z=!1,Ue(document.documentElement,"keydown",Z)};let R=0;const{position:L,handleMoveDown:J}=to({wrapperRef:M,modalRef:w,draggable:P,alignCenter:y}),q=()=>{R++,C.value&&(C.value=!1),f.value=!1,n("update:visible",!1)},Q=async t=>{const v=R,T=await new Promise(async V=>{var X;if(se(e.onBeforeOk)){let S=e.onBeforeOk((ee=!0)=>V(ee));if((Ie(S)||!Le(S))&&(C.value=!0),Ie(S))try{S=(X=await S)!=null?X:!0}catch(ee){throw S=!1,ee}Le(S)&&V(S)}else V(!0)});v===R&&(T?(n("ok",t),q()):C.value&&(C.value=!1))},te=t=>{var v;let T=!0;se(e.onBeforeCancel)&&(T=(v=e.onBeforeCancel())!=null?v:!1),T&&(n("cancel",t),q())},oe=b(!1),pe=t=>{t.target===M.value&&(oe.value=!0)},ve=t=>{e.mask&&e.maskClosable&&oe.value&&te(t)},ke=()=>{p.value&&(!Pt(M.value,document.activeElement)&&document.activeElement instanceof HTMLElement&&document.activeElement.blur(),n("open"))},ye=()=>{p.value||(P.value&&(L.value=void 0),B.value=!1,ae(),n("close"))},{setOverflowHidden:ne,resetOverflow:ae}=eo(h);We(()=>{h.value=At(e.popupContainer),p.value&&(ne(),e.escToClose&&K())}),nt(()=>{ae(),Y()}),Oe(p,t=>{f.value!==t&&(f.value=t),t?(n("beforeOpen"),B.value=!0,oe.value=!1,ne(),K()):(n("beforeClose"),Y())}),Oe(i,()=>{L.value&&(L.value=void 0)});const ge=j(()=>[`${l}-wrapper`,{[`${l}-wrapper-align-center`]:e.alignCenter&&!e.fullscreen,[`${l}-wrapper-moved`]:!!L.value}]),re=j(()=>[`${l}`,e.modalClass,{[`${l}-simple`]:e.simple,[`${l}-draggable`]:P.value,[`${l}-fullscreen`]:e.fullscreen}]),o=j(()=>{var t;const v={...(t=e.modalStyle)!=null?t:{}};return e.width&&!e.fullscreen&&(v.width=Me(e.width)?`${e.width}px`:e.width),!e.alignCenter&&e.top&&(v.top=Me(e.top)?`${e.top}px`:e.top),L.value&&(v.transform=`translate(${L.value[0]}px, ${L.value[1]}px)`),v});return{prefixCls:l,mounted:B,computedVisible:p,containerRef:h,wrapperRef:M,mergedModalStyle:o,okDisplayText:O,cancelDisplayText:U,zIndex:G,handleOk:Q,handleCancel:te,handleMaskClick:ve,handleMaskMouseDown:pe,handleOpen:ke,handleClose:ye,mergedOkLoading:A,modalRef:w,wrapperCls:ge,modalCls:re,teleportContainer:u,handleMoveDown:J}}});function no(e,n,i,a,y,l){const c=E("icon-info-circle-fill"),M=E("icon-check-circle-fill"),w=E("icon-exclamation-circle-fill"),f=E("icon-close-circle-fill"),p=E("icon-close"),C=E("icon-hover"),A=E("arco-button"),P=E("client-only");return k(),D(P,null,{default:r(()=>[(k(),D(lt,{to:e.teleportContainer,disabled:!e.renderToBody},[!e.unmountOnClose||e.computedVisible||e.mounted?be((k(),N("div",Te({key:0,class:`${e.prefixCls}-container`,style:{zIndex:e.zIndex}},e.$attrs),[s(De,{name:e.maskAnimationName,appear:""},{default:r(()=>[e.mask?be((k(),N("div",{key:0,ref:"maskRef",class:F(`${e.prefixCls}-mask`),style:ce(e.maskStyle)},null,6)),[[we,e.computedVisible]]):$("v-if",!0)]),_:1},8,["name"]),m("div",{ref:"wrapperRef",class:F(e.wrapperCls),onClick:n[2]||(n[2]=me((...u)=>e.handleMaskClick&&e.handleMaskClick(...u),["self"])),onMousedown:n[3]||(n[3]=me((...u)=>e.handleMaskMouseDown&&e.handleMaskMouseDown(...u),["self"]))},[s(De,{name:e.modalAnimationName,appear:"",onAfterEnter:e.handleOpen,onAfterLeave:e.handleClose,persisted:""},{default:r(()=>[be(m("div",{ref:"modalRef",class:F(e.modalCls),style:ce(e.mergedModalStyle)},[!e.hideTitle&&(e.$slots.title||e.title||e.closable)?(k(),N("div",{key:0,class:F(`${e.prefixCls}-header`),onMousedown:n[1]||(n[1]=(...u)=>e.handleMoveDown&&e.handleMoveDown(...u))},[e.$slots.title||e.title?(k(),N("div",{key:0,class:F([`${e.prefixCls}-title`,`${e.prefixCls}-title-align-${e.titleAlign}`])},[e.messageType?(k(),N("div",{key:0,class:F(`${e.prefixCls}-title-icon`)},[e.messageType==="info"?(k(),D(c,{key:0})):$("v-if",!0),e.messageType==="success"?(k(),D(M,{key:1})):$("v-if",!0),e.messageType==="warning"?(k(),D(w,{key:2})):$("v-if",!0),e.messageType==="error"?(k(),D(f,{key:3})):$("v-if",!0)],2)):$("v-if",!0),Ce(e.$slots,"title",{},()=>[_(W(e.title),1)])],2)):$("v-if",!0),!e.simple&&e.closable?(k(),N("div",{key:1,tabindex:"-1",role:"button","aria-label":"Close",class:F(`${e.prefixCls}-close-btn`),onClick:n[0]||(n[0]=(...u)=>e.handleCancel&&e.handleCancel(...u))},[s(C,null,{default:r(()=>[s(p)]),_:1})],2)):$("v-if",!0)],34)):$("v-if",!0),m("div",{class:F([`${e.prefixCls}-body`,e.bodyClass]),style:ce(e.bodyStyle)},[Ce(e.$slots,"default")],6),e.footer?(k(),N("div",{key:1,class:F(`${e.prefixCls}-footer`)},[Ce(e.$slots,"footer",{},()=>[e.hideCancel?$("v-if",!0):(k(),D(A,Te({key:0},e.cancelButtonProps,{onClick:e.handleCancel}),{default:r(()=>[_(W(e.cancelDisplayText),1)]),_:1},16,["onClick"])),s(A,Te({type:"primary"},e.okButtonProps,{loading:e.mergedOkLoading,onClick:e.handleOk}),{default:r(()=>[_(W(e.okDisplayText),1)]),_:1},16,["loading","onClick"])])],2)):$("v-if",!0)],6),[[we,e.computedVisible]])]),_:3},8,["name","onAfterEnter","onAfterLeave"])],34)],16)),[[we,e.computedVisible||e.mounted]]):$("v-if",!0)],8,["to","disabled"]))]),_:3})}var fe=Re(oo,[["render",no]]);const _e=(e,n)=>{let i=xt("modal");const a=()=>{f.component&&(f.component.props.visible=!1),se(e.onOk)&&e.onOk()},y=()=>{f.component&&(f.component.props.visible=!1),se(e.onCancel)&&e.onCancel()},l=async()=>{await st(),i&&(xe(null,i),document.body.removeChild(i)),i=null,se(e.onClose)&&e.onClose()},c=()=>{f.component&&(f.component.props.visible=!1)},M=p=>{f.component&&Object.entries(p).forEach(([C,A])=>{f.component.props[C]=A})},f=s(fe,{...{visible:!0,renderToBody:!1,unmountOnClose:!0,onOk:a,onCancel:y,onClose:l},...It(e,["content","title","footer","visible","unmountOnClose","onOk","onCancel","onClose"]),footer:typeof e.footer=="boolean"?e.footer:void 0},{default:he(e.content),title:he(e.title),footer:typeof e.footer!="boolean"?he(e.footer):void 0});return(n??Ee._context)&&(f.appContext=n??Ee._context),xe(f,i),document.body.appendChild(i),{close:c,update:M}},Be={open:_e,confirm:(e,n)=>{const i={simple:!0,messageType:"warning",...e};return _e(i,n)},...Dt.reduce((e,n)=>(e[n]=(i,a)=>{const y={simple:!0,hideCancel:!0,messageType:n,...i};return _e(y,a)},e),{})},Ee=Object.assign(fe,{...Be,install:(e,n)=>{Ve(e,n);const i=He(n);e.component(i+fe.name,fe);const a={};for(const y of Object.keys(Be))a[y]=(l,c=e._context)=>Be[y](l,c);e.config.globalProperties.$modal=a},_context:null}),lo={class:"token-import-page"},so={class:"container"},ao={class:"page-header"},ro={class:"header-content"},io={class:"header-top"},uo={class:"card-header"},co={class:"card-body"},fo={key:0,class:"tokens-section"},mo={class:"section-header"},po={class:"header-actions"},vo={class:"tokens-grid"},ko={class:"token-display"},yo={class:"token-value"},go={class:"token-timestamps"},bo={class:"timestamp-item"},To={class:"timestamp-value"},wo={class:"timestamp-item"},Co={class:"timestamp-value"},ho={class:"storage-info"},So={class:"storage-item"},$o={key:0,class:"storage-upgrade"},_o={class:"modal-actions"},Bo={__name:"index",props:{token:String,name:String,server:String,wsUrl:String,api:String,auto:Boolean},setup(e){const n=e,i=ft(),a=at(),y=rt(),l=it(),c=b(!1),M=b(!1),w=b(!1);b(null),b(null);const f=b(null),p=b(null),C=b("manual"),A=b(new Set),P=b(new Set),u=ut({name:"",token:"",server:"",wsUrl:""}),h={name:[{required:!0,message:"请输入Token名称",trigger:"blur"}],token:[{required:!0,message:"请输入Token字符串",trigger:"blur"}]},B=[{label:"导出所有Token",key:"export"},{label:"导入Token文件",key:"import"},{label:"清理过期Token",key:"clean"},{label:"断开所有连接",key:"disconnect"},{label:"清除所有Token",key:"clear"}],O=async o=>{A.value.add(o.id);try{if(o.sourceUrl){let t;if(o.sourceUrl.startsWith(window.location.origin)||o.sourceUrl.startsWith("/")||o.sourceUrl.startsWith("http://localhost")||o.sourceUrl.startsWith("http://127.0.0.1"))t=await fetch(o.sourceUrl);else try{t=await fetch(o.sourceUrl,{method:"GET",headers:{Accept:"application/json"},mode:"cors"})}catch(V){throw new Error(`跨域请求被阻止。请确保目标服务器支持CORS。错误详情: ${V.message}`)}if(!t.ok)throw new Error(`请求失败: ${t.status} ${t.statusText}`);const T=await t.json();if(!T.token)throw new Error("返回数据中未找到token字段");l.updateToken(o.id,{token:T.token,server:T.server||o.server,lastRefreshed:Date.now()}),a.success("Token刷新成功")}else{y.info({title:"重新获取Token",content:`Token "${o.name}" 是手动导入的，没有配置自动刷新地址。

请选择以下操作：
1. 重新手动导入新的Token
2. 尝试重新连接现有Token`,positiveText:"重新导入",negativeText:"重新连接",onPositiveClick:()=>{c.value=!0,C.value="manual",importForm.name=o.name,importForm.server=o.server,importForm.wsUrl=o.wsUrl},onNegativeClick:()=>{l.getWebSocketStatus(o.id)==="connected"&&l.closeWebSocketConnection(o.id),setTimeout(()=>{l.createWebSocketConnection(o.id,o.token,o.wsUrl),a.info("正在尝试重新连接...")},500)}});return}l.getWebSocketStatus(o.id)==="connected"&&(l.closeWebSocketConnection(o.id),setTimeout(()=>{l.createWebSocketConnection(o.id,o.token,o.wsUrl)},500))}catch(t){console.error("刷新Token失败:",t),a.error(t.message||"Token刷新失败")}finally{A.value.delete(o.id)}},U=o=>{y.warning({title:"升级为长期有效",content:`确认要将Token "${o.name}" 升级为长期有效吗？升级后该Token将不会因24小时未使用而被自动清理。`,positiveText:"确认升级",negativeText:"取消",onPositiveClick:()=>{l.upgradeTokenToPermanent(o.id)?a.success(`Token "${o.name}" 已升级为长期有效！`):a.error("升级失败，该Token可能已经是长期有效状态")}})},G=(o,t=!1)=>{const v=l.selectedTokenId===o.id,T=I(o.id);if(v&&T==="connected"&&!t){a.info(`${o.name} 已选中且已连接`);return}if(v&&T==="connecting"&&!t){a.info(`${o.name} 正在连接中...`);return}l.selectToken(o.id,t)?t?a.success(`强制重连：${o.name}`):v?a.success(`重新连接：${o.name}`):a.success(`已选择：${o.name}`):a.error(`选择Token失败：${o.name}`)},I=o=>l.getWebSocketStatus(o),z=o=>{const t=I(o);return{connected:"已连接",connecting:"连接中...",disconnected:"已断开",error:"连接错误",disconnecting:"断开中..."}[t]||"未连接"},Z=o=>{const t=I(o);return{connected:"success",connecting:"processing",disconnected:"normal",error:"danger",disconnecting:"warning"}[t]||"normal"},K=o=>{const t=[{label:"编辑",key:"edit",icon:()=>H(x,null,{default:()=>H(Vt)})},{label:"复制Token",key:"copy",icon:()=>H(x,null,{default:()=>H(Ht)})}];return o.importMethod==="url"&&o.sourceUrl?t.push({label:"从URL刷新",key:"refresh-url",icon:()=>H(x,null,{default:()=>H(Wt)})}):t.push({label:"重新获取",key:"refresh",icon:()=>H(x,null,{default:()=>H(ze)})}),t.push({type:"divider"},{label:"删除",key:"delete",icon:()=>H(x,null,{default:()=>H(Rt)}),props:{style:{color:"#e74c3c"}}}),t},Y=async(o,t)=>{switch(o){case"edit":R(t);break;case"copy":J(t);break;case"refresh":O(t);break;case"refresh-url":O(t);break;case"delete":q(t);break}},R=o=>{p.value=o,Object.assign(u,{name:o.name,token:o.token,server:o.server||"",wsUrl:o.wsUrl||""}),w.value=!0},L=async()=>{if(!(!f.value||!p.value))try{await f.value.validate(),l.updateToken(p.value.id,{name:u.name,token:u.token,server:u.server,wsUrl:u.wsUrl}),a.success("Token信息已更新"),w.value=!1,p.value=null}catch{}},J=async o=>{try{await navigator.clipboard.writeText(o.token),a.success("Token已复制到剪贴板")}catch{a.error("复制失败")}},q=o=>{y.warning({title:"删除Token",content:`确定要删除Token "${o.name}" 吗？此操作无法恢复。`,positiveText:"确定删除",negativeText:"取消",onPositiveClick:()=>{l.removeToken(o.id),a.success("Token已删除")}})},Q=o=>{switch(o){case"export":te();break;case"import":oe();break;case"clean":pe();break;case"disconnect":ve();break;case"clear":ke();break}},te=()=>{try{const o=l.exportTokens(),t=JSON.stringify(o,null,2),v=new Blob([t],{type:"application/json"}),T=document.createElement("a");T.href=URL.createObjectURL(v),T.download=`tokens_backup_${new Date().toISOString().split("T")[0]}.json`,T.click(),a.success("Token数据已导出")}catch{a.error("导出失败")}},oe=()=>{const o=document.createElement("input");o.type="file",o.accept=".json",o.onchange=t=>{const v=t.target.files[0];if(v){const T=new FileReader;T.onload=V=>{try{const X=JSON.parse(V.target.result),S=l.importTokens(X);S.success?a.success(S.message):a.error(S.message)}catch{a.error("文件格式错误")}},T.readAsText(v)}},o.click()},pe=()=>{const o=l.cleanExpiredTokens();a.success(`已清理 ${o} 个过期Token`)},ve=()=>{l.gameTokens.forEach(o=>{l.closeWebSocketConnection(o.id)}),a.success("所有连接已断开")},ke=()=>{y.error({title:"清除所有Token",content:"确定要清除所有Token吗？此操作无法恢复！",positiveText:"确定清除",negativeText:"取消",onPositiveClick:()=>{l.clearAllTokens(),a.success("所有Token已清除")}})},ye=o=>{if(!o)return"";const t=o.length;return t<=8?o:o.substring(0,4)+"***"+o.substring(t-4)},ne=o=>new Date(o).toLocaleString("zh-CN"),ae=()=>{i.push("/admin/dashboard")},ge=async o=>{P.value.add(o.id);try{if(l.selectToken(o.id),I(o.id)==="connected"){a.success(`${o.name} 已连接，进入任务管理`),i.push("/admin/dashboard");return}}finally{P.value.delete(o.id)}},re=async()=>{if(n.token||n.api)try{M.value=!0;let o=null;if(n.api){a.info("正在从API获取token...");const t=await fetch(n.api,{method:"GET",headers:{Accept:"application/json"},mode:"cors"});if(!t.ok)throw new Error(`API请求失败: ${t.status} ${t.statusText}`);const v=await t.json();if(!v.token)throw new Error("API返回数据中未找到token字段");o=l.importBase64Token(n.name||v.name||"通过API导入的Token",v.token,{server:n.server||v.server,wsUrl:n.wsUrl,sourceUrl:n.api,importMethod:"url"})}else n.token&&(a.info("正在导入token..."),o=l.importBase64Token(n.name||"通过URL导入的Token",n.token,{server:n.server,wsUrl:n.wsUrl,importMethod:"url"}));if(o&&o.success)a.success(`Token "${o.tokenName}" 导入成功！`),n.auto&&o.token?(l.selectToken(o.token.id),a.success("正在跳转到控制台..."),setTimeout(()=>{i.push("/admin/dashboard")},1500)):i.replace("/tokens");else throw new Error((o==null?void 0:o.message)||"Token导入失败")}catch(o){console.error("URL参数处理失败:",o),a.error(`导入失败: ${o.message}`),i.replace("/tokens")}finally{M.value=!1}};return Oe(()=>[n.token,n.api],re,{immediate:!1}),We(async()=>{l.initTokenStore(),await re(),!l.hasTokens&&!n.token&&!n.api&&(c.value=!0)}),(o,t)=>{const v=ot,T=E("n-radio-button"),V=E("n-radio-group"),X=Ee,S=E("n-button"),ee=E("n-dropdown"),Ke=bt,Ye=Qt,qe=jt,Xe=Ge,Ze=E("n-tag"),Je=Lt,Qe=yt,ie=E("n-input"),ue=E("n-form-item"),et=E("n-form"),tt=E("n-modal");return k(),N("div",lo,[m("div",so,[m("div",ao,[m("div",ro,[m("div",io,[t[15]||(t[15]=m("img",{src:mt,alt:"XYZW",class:"brand-logo"},null,-1)),s(v)]),t[16]||(t[16]=m("h1",null,"游戏Token管理",-1))])]),s(X,{visible:c.value,"onUpdate:visible":t[7]||(t[7]=d=>c.value=d),width:"40rem",footer:!1,"default-visible":!g(l).hasTokens},{title:r(()=>[m("h2",null,[s(g(x),null,{default:r(()=>[s(g(je))]),_:1}),t[17]||(t[17]=_(" 添加游戏Token ",-1))])]),default:r(()=>[m("div",uo,[s(V,{value:C.value,"onUpdate:value":t[0]||(t[0]=d=>C.value=d),class:"import-method-tabs",size:"small"},{default:r(()=>[s(T,{value:"manual"},{default:r(()=>[...t[18]||(t[18]=[_(" 手动输入 ",-1)])]),_:1}),s(T,{value:"url"},{default:r(()=>[...t[19]||(t[19]=[_(" URL获取 ",-1)])]),_:1}),s(T,{value:"bin"},{default:r(()=>[...t[20]||(t[20]=[_(" BIN获取 ",-1)])]),_:1})]),_:1},8,["value"])]),m("div",co,[C.value==="manual"?(k(),D(pt,{key:0,onCancel:t[1]||(t[1]=()=>c.value=!1),onOk:t[2]||(t[2]=()=>c.value=!1)})):$("",!0),C.value==="url"?(k(),D(vt,{key:1,onCancel:t[3]||(t[3]=()=>c.value=!1),onOk:t[4]||(t[4]=()=>c.value=!1)})):$("",!0),C.value==="bin"?(k(),D(gt,{key:2,onCancel:t[5]||(t[5]=()=>c.value=!1),onOk:t[6]||(t[6]=()=>c.value=!1)})):$("",!0)])]),_:1},8,["visible","default-visible"]),g(l).hasTokens?(k(),N("div",fo,[m("div",mo,[m("h2",null,"我的Token列表 ("+W(g(l).gameTokens.length)+"个)",1),m("div",po,[g(l).selectedToken?(k(),D(S,{key:0,type:"success",onClick:ae},{icon:r(()=>[s(g(x),null,{default:r(()=>[s(g(Ne))]),_:1})]),default:r(()=>[t[21]||(t[21]=_(" 返回控制台 ",-1))]),_:1})):$("",!0),c.value?$("",!0):(k(),D(S,{key:1,type:"primary",onClick:t[8]||(t[8]=d=>c.value=!0)},{icon:r(()=>[s(g(x),null,{default:r(()=>[s(g(je))]),_:1})]),default:r(()=>[t[22]||(t[22]=_(" 添加Token ",-1))]),_:1})),s(ee,{options:B,onSelect:Q},{default:r(()=>[s(S,null,{icon:r(()=>[s(g(x),null,{default:r(()=>[s(g(Nt))]),_:1})]),default:r(()=>[t[23]||(t[23]=_(" 批量操作 ",-1))]),_:1})]),_:1})])]),m("div",vo,[(k(!0),N(ct,null,dt(g(l).gameTokens,d=>(k(),D(Je,{key:d.id,class:F({"token-card":!0,active:g(l).selectedTokenId===d.id}),onClick:le=>G(d)},{title:r(()=>[s(qe,{class:"token-name"},{default:r(()=>[_(W(d.name)+" ",1),d.server?(k(),D(Ke,{key:0,color:"red"},{default:r(()=>[_(W(d.server),1)]),_:2},1024)):$("",!0),s(Ye,{status:Z(d.id),text:z(d.id)},null,8,["status","text"])]),_:2},1024)]),extra:r(()=>[s(ee,{options:K(d),onSelect:le=>Y(le,d)},{default:r(()=>[s(S,{text:""},{icon:r(()=>[s(g(x),null,{default:r(()=>[s(g(Ft))]),_:1})]),_:1})]),_:1},8,["options","onSelect"])]),default:r(()=>[m("div",ko,[t[24]||(t[24]=m("span",{class:"token-label"},"Token:",-1)),m("code",yo,W(ye(d.token)),1)]),s(Xe,{loading:A.value.has(d.id),onClick:me(le=>O(d),["stop"])},{icon:r(()=>[s(g(x),null,{default:r(()=>[s(g(ze))]),_:1})]),default:r(()=>[_(" "+W(d.sourceUrl?"刷新":"重新获取"),1)]),_:2},1032,["loading","onClick"]),m("div",go,[m("div",bo,[t[25]||(t[25]=m("span",{class:"timestamp-label"},"创建：",-1)),m("span",To,W(ne(d.createdAt)),1)]),m("div",wo,[t[26]||(t[26]=m("span",{class:"timestamp-label"},"使用：",-1)),m("span",Co,W(ne(d.lastUsed)),1)])]),m("div",ho,[m("div",So,[t[27]||(t[27]=m("span",{class:"storage-label"},"存储类型：",-1)),s(Ze,{size:"small",type:d.importMethod==="url"?"success":"warning"},{default:r(()=>[_(W(d.importMethod==="url"?"长期有效":"临时存储"),1)]),_:2},1032,["type"])]),d.importMethod!=="url"?(k(),N("div",$o,[s(S,{size:"tiny",type:"success",ghost:"",onClick:me(le=>U(d),["stop"])},{icon:r(()=>[s(g(x),null,{default:r(()=>[s(g(zt))]),_:1})]),default:r(()=>[t[28]||(t[28]=_(" 升级为长期有效 ",-1))]),_:1},8,["onClick"])])):$("",!0)])]),actions:r(()=>[s(S,{type:"primary",size:"large",block:"",loading:P.value.has(d.id),onClick:le=>ge(d)},{icon:r(()=>[s(g(x),null,{default:r(()=>[s(g(Ne))]),_:1})]),default:r(()=>[t[29]||(t[29]=_(" 开始任务管理 ",-1))]),_:1},8,["loading","onClick"])]),_:2},1032,["class","onClick"]))),128))])])):$("",!0),!g(l).hasTokens&&!c.value?(k(),D(Qe,{key:1},{image:r(()=>[...t[30]||(t[30]=[m("i",{class:"mdi:bed-empty"},null,-1)])]),default:r(()=>[t[31]||(t[31]=_(" 还没有导入任何Token ",-1))]),_:1})):$("",!0)]),s(tt,{show:w.value,"onUpdate:show":t[14]||(t[14]=d=>w.value=d),preset:"card",title:"编辑Token",style:{width:"500px"}},{footer:r(()=>[m("div",_o,[s(S,{onClick:t[13]||(t[13]=d=>w.value=!1)},{default:r(()=>[...t[32]||(t[32]=[_(" 取消 ",-1)])]),_:1}),s(S,{type:"primary",onClick:L},{default:r(()=>[...t[33]||(t[33]=[_(" 保存 ",-1)])]),_:1})])]),default:r(()=>[s(et,{ref_key:"editFormRef",ref:f,model:u,rules:h,"label-placement":"left","label-width":"80px"},{default:r(()=>[s(ue,{label:"名称",path:"name"},{default:r(()=>[s(ie,{value:u.name,"onUpdate:value":t[9]||(t[9]=d=>u.name=d)},null,8,["value"])]),_:1}),s(ue,{label:"Token字符串",path:"token"},{default:r(()=>[s(ie,{value:u.token,"onUpdate:value":t[10]||(t[10]=d=>u.token=d),type:"textarea",rows:3,placeholder:"粘贴Token字符串...",clearable:""},null,8,["value"])]),_:1}),s(ue,{label:"服务器"},{default:r(()=>[s(ie,{value:u.server,"onUpdate:value":t[11]||(t[11]=d=>u.server=d)},null,8,["value"])]),_:1}),s(ue,{label:"WebSocket地址"},{default:r(()=>[s(ie,{value:u.wsUrl,"onUpdate:value":t[12]||(t[12]=d=>u.wsUrl=d)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])])}}},qo=Tt(Bo,[["__scopeId","data-v-737d65fb"]]);export{qo as default};
