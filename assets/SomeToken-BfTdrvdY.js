import{k as ks,c as w,i as y,a as n,r as R,l as Ee,n as Y,t as U,p as ne,q as be,s as rt,v as it,x as ct,y as dt,z as Ge,o as vs,A as ut,u as i,b as pe,d as r,w as c,f as ae,B as E,F as Pe,g as De,j as b,N as z,C as mt,D as ys,E as Fe,G as ft,e as pt,H as Ts}from"./index-wKIbGhGo.js";import{K as gt}from"./ThemeToggle.vue_vue_type_style_index_0_scoped_89126448_lang-BjYg0yWP.js";import{_ as $s}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{T as _s,S as Je}from"./TrashBin-BdQjjFcw.js";import{C as ht}from"./Copy-B4mkBN3W.js";import{C as vt}from"./CloudUpload-bfszKK-e.js";import{A as yt}from"./Add-DyUH0i3w.js";import{M as Tt,S as Oe}from"./Star-BFyi0QRs.js";import{C as ws}from"./Time-34a_cIzw.js";import{E as _t}from"./EllipsisHorizontal-BXjMV4b_.js";import{S as bs}from"./Settings-etHOxbY7.js";import{H as wt}from"./Home-Bl2Fl15-.js";import{C as bt,E as kt}from"./EllipseOutline-CphiJv0t.js";import{R as $t}from"./Refresh-B4apZMLB.js";import{C as St}from"./CheckmarkCircle-B0PnRn1P.js";const Ct={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},xt=n("path",{d:"M200.66 352H144a96 96 0 0 1 0-192h55.41",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48"},null,-1),Mt=n("path",{d:"M312.59 160H368a96 96 0 0 1 0 192h-56.66",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48"},null,-1),Pt=n("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M169.07 256h175.86"},null,-1),Dt=[xt,Mt,Pt],Et=ks({name:"Link",render:function(fe,ue){return y(),w("svg",Ct,Dt)}}),Ut={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Rt=n("path",{d:"M432 32H80a64.07 64.07 0 0 0-64 64v320a64.07 64.07 0 0 0 64 64h352a64.07 64.07 0 0 0 64-64V96a64.07 64.07 0 0 0-64-64zM96 256a16 16 0 0 1-10-28.49L150.39 176L86 124.49a16 16 0 1 1 20-25l80 64a16 16 0 0 1 0 25l-80 64A16 16 0 0 1 96 256zm160 0h-64a16 16 0 0 1 0-32h64a16 16 0 0 1 0 32z",fill:"currentColor"},null,-1),zt=[Rt],Bt=ks({name:"Terminal",render:function(fe,ue){return y(),w("svg",Ut,zt)}}),At={class:"token-extractor-container"},Nt={class:"upload-text"},Lt=["disabled","multiple"],Ft={key:0,class:"file-info"},Ot={key:1,class:"batch-processing-stats"},Wt={class:"stats-item"},Ht={class:"stat-value"},jt={class:"stats-item"},qt={class:"stat-value"},Vt={class:"stats-item"},Gt={class:"stat-value success"},Jt={class:"stats-item"},Yt={class:"stat-value error"},Xt={__name:"BinFileTokenExtractor",emits:["fileSelected","tokenExtracted","batchProcessed"],setup(Ue,{emit:fe}){const ue=fe,f=R([]),ge=R(""),d=R(""),K=R(!1),ye=R(""),Te=R(""),he=R(),re=R(!1),G=R(!0),B=Ee({total:0,processed:0,success:0,failed:0}),Z=()=>{var N;(N=he.value)==null||N.click()},Re=async N=>{const _=N.target;_.files&&_.files.length>0&&(f.value=Array.from(_.files),f.value.length===1?ue("fileSelected",f.value[0].name):ue("fileSelected",`批量选择了${f.value.length}个文件`),f.value.length===1?await ze(f.value[0]):await We(f.value))},We=async N=>{B.total=N.length,B.processed=0,B.success=0,B.failed=0,re.value=!0,K.value=!0;const _=[];try{for(const x of N)try{const C=await ze(x,!0);C.success?(B.success++,_.push({fileName:x.name,success:!0,token:C.token,wssParams:C.wssParams})):(B.failed++,_.push({fileName:x.name,success:!1,error:C.error}))}catch(C){B.failed++,_.push({fileName:x.name,success:!1,error:C.message||"处理失败"})}finally{B.processed++}ue("batchProcessed",_),M(`批量处理完成: 成功 ${B.success} 个，失败 ${B.failed} 个`,"success")}finally{K.value=!1,re.value=!1}},ze=async(N,_=!1)=>{ge.value="",d.value="",_||(K.value=!0);try{const x=await He(N),C=new XMLHttpRequest;return C.open("POST","https://xxz-xyzw.hortorgames.com/login/authuser?_seq=1",!0),C.responseType="arraybuffer",await new Promise(function(j,oe){C.addEventListener("load",function(){if(C.status>=200&&C.status<300)try{const Q=C.response;Q?(je(Q),_||M("Token提取成功！WSS链接已自动复制","success"),j()):(M("上传成功，但响应为空","error"),oe(new Error("响应为空")))}catch(Q){M("处理响应时出错: "+Q.message,"error"),oe(Q)}else M("上传失败: "+C.statusText,"error"),oe(new Error("HTTP错误: "+C.status))}),C.addEventListener("error",function(){M("上传过程中发生错误","error"),oe(new Error("网络错误"))}),C.setRequestHeader("Content-Type","application/octet-stream"),C.send(x)}),{success:!0,token:ge.value,wssParams:d.value}}catch(x){return console.error("处理失败:",x),{success:!1,error:x.message}}finally{_||(K.value=!1)}},M=(N,_="info")=>{ye.value=N,Te.value=_,setTimeout(()=>{ye.value="",Te.value=""},3e3)},He=N=>new Promise(function(_,x){const C=new FileReader;C.onload=function(){C.result instanceof ArrayBuffer?_(C.result):x(new Error("无法读取文件内容"))},C.onerror=function(){x(C.error)},C.readAsArrayBuffer(N)}),Be=N=>/[A-Za-z0-9+/=]/.test(N),je=N=>{try{const _=new Uint8Array(N);let x="";for(let j=0;j<_.length;j++)_[j]>=32&&_[j]<=126?x+=String.fromCharCode(_[j]):x+=".";const C=x.indexOf("Token");if(C!==-1){let j=C+5;for(;j<x.length;){const Ae=x[j];if(Be(Ae))break;j++}let oe=j;for(;oe<x.length&&Be(x[oe]);)oe++;const Q=x.substring(j,oe);Q.length>0?(ge.value=Q,g(Q)):M("找到Token标记但未找到Token值","error")}else M("在响应中未找到Token标记","error")}catch(_){M("提取Token时发生错误: "+_.message,"error")}},g=N=>{const _=Date.now(),x=_*100+Math.floor(Math.random()*100),C=_+Math.floor(Math.random()*10),j='{"roleToken":"'+N+'","sessId":'+x+',"connId":'+C+',"isRestore":0}';d.value=j,ue("tokenExtracted",j)};return(N,_)=>(y(),w("div",At,[n("div",{class:be(["upload-area",{"multiple-upload":G.value}]),onClick:Z},[n("p",Nt,U(K.value?"正在处理文件...":G.value?"点击上传多个BIN文件":"点击上传BIN文件"),1),n("input",{ref_key:"fileInputRef",ref:he,type:"file",accept:".bin",class:"file-input",disabled:K.value,multiple:G.value,onChange:Re,onClick:_[0]||(_[0]=ne(()=>{},["stop"]))},null,40,Lt)],2),f.value.length>0?(y(),w("div",Ft," 已选择 "+U(f.value.length)+" 个文件 ",1)):Y("",!0),re.value&&B.total>0?(y(),w("div",Ot,[n("div",Wt,[_[1]||(_[1]=n("span",{class:"stat-label"},"总文件数:",-1)),n("span",Ht,U(B.total),1)]),n("div",jt,[_[2]||(_[2]=n("span",{class:"stat-label"},"已处理:",-1)),n("span",qt,U(B.processed),1)]),n("div",Vt,[_[3]||(_[3]=n("span",{class:"stat-label"},"成功:",-1)),n("span",Gt,U(B.success),1)]),n("div",Jt,[_[4]||(_[4]=n("span",{class:"stat-label"},"失败:",-1)),n("span",Yt,U(B.failed),1)])])):Y("",!0)]))}},Kt=$s(Xt,[["__scopeId","data-v-95cf8fc8"]]),Zt={class:"token-import-page"},Qt={class:"container"},It={key:0,class:"import-section"},ea={class:"import-card"},sa={class:"card-header"},ta={class:"optional-fields"},aa={class:"form-actions"},oa={class:"tokens-section"},la={class:"section-header"},na={class:"header-actions"},ra={class:"bulk-panel-header"},ia={class:"bulk-operations-grid"},ca={class:"tokens-grid"},da=["onClick"],ua={class:"card-header"},ma={class:"token-info"},fa={class:"token-name"},pa=["title"],ga={class:"token-meta"},ha={key:0,class:"meta-item"},va={class:"connection-status"},ya={class:"card-actions"},Ta={key:0,class:"role-info-section"},_a={class:"role-stats"},wa={style:{display:"flex","flex-direction":"column"}},ba={class:"role-name"},ka={class:"level-text"},$a={style:{display:"flex","flex-direction":"column"}},Sa={style:{color:"var(--warning-color)","font-weight":"var(--font-weight-medium)"}},Ca={style:{color:"var( --secondary-color)","font-weight":"var(--font-weight-medium)"}},xa={style:{color:"var(--info-color)","font-weight":"var(--font-weight-medium)"}},Ma={key:0},Pa={key:1,style:{color:"red"}},Da={key:2},Ea={key:0},Ua={key:1,style:{color:"red"}},Ra={key:2},za={key:0},Ba={key:1,style:{color:"red"}},Aa={key:2},Na={key:1,class:"game-actions"},La={class:"actions-grid"},Fa={key:0},Oa={key:1},Wa={key:0},Ha={key:1},ja={key:0},qa={key:1},Va={key:0},Ga={key:1},Ja={key:0},Ya={key:1},Xa={class:"token-console"},Ka={class:"console-header"},Za={class:"console-actions"},Qa={class:"console-body"},Ia={key:0,class:"console-empty"},eo={class:"log-time"},so={class:"log-message"},to={key:2,class:"game-progress compact"},ao={class:"progress-card-small"},oo={class:"progress-card-header-small"},lo={class:"progress-container-small"},no={class:"progress-text-small"},ro={class:"progress-percentage"},io={key:3,class:"card-footer"},co={key:1,class:"empty-state"},uo={class:"modal-header"},mo=["disabled","onClick"],fo={class:"task-list"},po={class:"task-item-left"},go={class:"task-name"},ho={class:"modal-header"},vo={class:"task-settings-content"},yo={class:"task-settings-section"},To={class:"task-settings-grid"},_o={class:"task-setting-item"},wo={class:"task-setting-label"},bo={class:"task-setting-item"},ko={class:"task-setting-label"},$o={class:"task-settings-section"},So={class:"task-settings-grid"},Co={class:"task-setting-item"},xo={class:"task-setting-label"},Mo={class:"task-setting-item"},Po={class:"task-setting-label"},Do={class:"task-setting-item"},Eo={class:"task-setting-label"},Uo={class:"task-setting-item"},Ro={class:"task-setting-label"},zo={class:"task-setting-item"},Bo={class:"task-setting-label"},Ao={class:"task-setting-item"},No={class:"task-setting-label"},Lo={class:"modal-actions"},Fo=30,Oo={__name:"SomeToken",props:{token:String,name:String,server:String,wsUrl:String,api:String,auto:Boolean},setup(Ue){const fe=Ue,ue=pt(),f=rt(),ge=it();ct();const d=dt();Ge(()=>d.gameTokens,e=>{!e||!Array.isArray(e)||e.forEach(s=>{if(s&&s.id){const a=$(s.id),o=Re.get(s.id);a==="connected"&&o!=="connected"&&Ne(s.id),Re.set(s.id,a)}})},{deep:!0});const K=R(!1),ye=R(!1);R(!1);const Te=R(null);R(null),R(null),R(null);const he=R("url");R(new Set);const re=R(new Set),G=R(new Map),B=R(new Map),Z=R(new Map),Re=new Map,We=(e,s)=>{s&&s.stopPropagation(),Z.value.has(e)?Z.value.set(e,!Z.value.get(e)):Z.value.set(e,!0)},ze=()=>{d.gameTokens.forEach(e=>{Z.value.has(e.id)||Z.value.set(e.id,!0)})},M=Ee({name:"",base64Token:"",server:"",wsUrl:""});Ee({name:"",url:"",server:"",wsUrl:""}),Ee({name:"",server:"",wsUrl:""});const He={name:[{required:!0,message:"请输入Token名称",trigger:"blur"}],base64Token:[{required:!0,message:"请输入Base64 Token",trigger:"blur"}]},Be=[{label:"导出所有Token",key:"export"},{label:"导入Token文件",key:"import"},{label:"清理过期Token",key:"clean"},{label:"断开所有连接",key:"disconnect"},{label:"清除所有Token",key:"clear"},{type:"divider"},{label:"为所有已连接Token执行每日任务",key:"bulk-daily"},{label:"为所有已连接Token启动盐罐机器人",key:"bulk-bottle"},{label:"为所有已连接Token进行挂机加钟",key:"bulk-hangup"},{label:"为所有已连接Token挑战咸将塔",key:"bulk-tower"},{label:"为所有等级<4001的Token进行商店购买",key:"bulk-shop-4001"},{label:"为所有已连接Token执行智能发车",key:"bulk-smart-send-car"},{label:"为所有已连接Token执行一键收车",key:"bulk-claim-all-cars"}],je=[0,1,2,3,4].map(e=>({label:`${e}次`,value:e})),g=R({dailyTasks:{},bottleRobots:{},hangupTimes:{},towerFloors:{}}),N=R({});let _=null,x=null;const C=async()=>{await Q(),_&&clearInterval(_),_=setInterval(Q,3e4),x&&clearInterval(x),oe()},j=()=>{_&&clearInterval(_),x&&clearInterval(x)},oe=()=>{x&&clearInterval(x),x=setInterval(()=>{d.gameTokens.forEach(e=>{const s=e.id;if(g.value.bottleRobots[s]){const a=g.value.bottleRobots[s];typeof a.remainingTime=="number"&&a.isRunning&&a.remainingTime>0&&(a.remainingTime=Math.max(0,a.remainingTime-1),a.time=Xe(a.remainingTime*1e3),a.remainingTime<=0&&(a.isRunning=!1,a.status="已停止"))}if(g.value.hangupTimes[s]){const a=g.value.hangupTimes[s];typeof a.timeLeft=="number"&&typeof a.totalTime=="number"&&a.isActive&&a.timeLeft>0&&(a.timeLeft=Math.max(0,a.timeLeft-1),a.totalTime=a.totalTime+1,a.timeLeft<=0&&(a.isActive=!1))}})},1e3)},Q=async()=>{const e=d.gameTokens.filter(s=>$(s.id)==="connected");await Promise.all(e.map(s=>Ne(s.id)))},Ae=(e,s)=>{var a,o,l,u;try{if(!((o=(a=s==null?void 0:s.role)==null?void 0:a.dailyTask)!=null&&o.complete)){console.log("角色信息中无任务完成数据");return}const p=s.role.dailyTask.complete,v=P=>P===-1;if(typeof p!="object"||p===null){console.log("任务完成数据格式错误");return}g.value.dailyTasks[e]||(g.value.dailyTasks[e]={completed:!1,progress:0,lastUpdated:Date.now(),rawTaskData:null,taskCompleteData:{}}),g.value.dailyTasks[e].lastUpdated=Date.now(),g.value.dailyTasks[e].taskCompleteData=p,(u=(l=s==null?void 0:s.role)==null?void 0:l.task)!=null&&u.dailyProgress&&(g.value.dailyTasks[e].progress=s.role.task.dailyProgress,g.value.dailyTasks[e].completed=s.role.task.dailyCompleted||s.role.task.dailyProgress>=100),Object.keys(p).forEach(P=>{try{const h=Number(P);if(!isNaN(h)){const L=v(p[P])}}catch(h){console.warn(`处理任务${P}时出错:`,h)}})}catch(p){console.error("同步任务状态时发生错误:",p)}},Ye=R({}),ke=e=>Ye.value[e]||{},Ss=e=>{if(!e)return"0";const s=Number(e);return s>=1e8?(s/1e8).toFixed(2)+"亿":s>=1e4?(s/1e4).toFixed(2)+"万":s.toString()},Cs=e=>[{id:1,name:"登录一次游戏",completed:!1,loading:!1},{id:2,name:"分享一次游戏",completed:!1,loading:!1},{id:3,name:"赠送好友3次金币",completed:!1,loading:!1},{id:4,name:"进行2次招募",completed:!1,loading:!1},{id:5,name:"领取5次挂机奖励",completed:!1,loading:!1},{id:6,name:"进行3次点金",completed:!1,loading:!1},{id:7,name:"开启3次宝箱",completed:!1,loading:!1},{id:12,name:"黑市购买1次物品",completed:!1,loading:!1},{id:13,name:"进行1场竞技场战斗",completed:!1,loading:!1},{id:14,name:"收获1个任意盐罐",completed:!1,loading:!1}],xs=e=>{var l;const s=((l=g.value.dailyTasks[e])==null?void 0:l.taskCompleteData)||{},a=Cs(),o=u=>u===-1;return a.map(u=>({...u,completed:o(s[u.id])}))},Ms=e=>{N.value[e]=!0},Ps=(e,s)=>{N.value[s]=e},Ds=async e=>{var s;try{if((s=G.value.get(e))!=null&&s.includes("daily")){f.warning("任务正在执行中，请稍候再试");return}const a=G.value.get(e)||[];G.value.set(e,[...a,"refresh"]);const o=await d.sendMessageWithPromise(e,"role_getroleinfo",{},1e3);o&&o.role&&(Ae(e,o),f.success("任务状态刷新成功"))}catch(a){console.error("刷新任务状态失败:",a),f.error("刷新任务状态失败: "+(a.message||"未知错误"))}finally{const o=(G.value.get(e)||[]).filter(l=>l!=="refresh");o.length>0?G.value.set(e,o):G.value.delete(e)}},Ne=async e=>{var s,a;try{g.value.hangupTimes[e]||(g.value.hangupTimes[e]={timeLeft:0,totalTime:0,isActive:!1}),g.value.bottleRobots[e]||(g.value.bottleRobots[e]={status:"未开启",time:"00:00:00",remainingTime:0,isRunning:!1}),g.value.towerFloors[e]||(g.value.towerFloors[e]={floor:0,layer:0,energy:0}),g.value.dailyTasks[e]||(g.value.dailyTasks[e]={completed:!1,progress:0,lastUpdated:Date.now(),rawTaskData:null,taskCompleteData:{}});const o=await d.sendMessageWithPromise(e,"role_getroleinfo",{},1e3);if(o&&o.role&&(Ye.value[e]=o.role),o&&o.role){if(o.role.task){const l=o.role.task.dailyProgress||0,u=o.role.task.dailyCompleted||!1;g.value.dailyTasks[e]={completed:u,progress:l,lastUpdated:Date.now(),rawTaskData:o.role.task,taskCompleteData:((s=o.role.dailyTask)==null?void 0:s.complete)||{}}}else g.value.dailyTasks[e]={completed:!1,progress:0,lastUpdated:Date.now(),rawTaskData:null,taskCompleteData:((a=o.role.dailyTask)==null?void 0:a.complete)||{}};if(Ae(e,o),!g.value.dailyTasks[e].progress){const l=g.value.dailyTasks[e].taskCompleteData;if(l){const u=Object.keys(l).length,p=Object.values(l).filter(v=>v===-1).length;g.value.dailyTasks[e].progress=u>0?Math.round(p/u*100):0,g.value.dailyTasks[e].completed=u>0&&u===p}}}else g.value.dailyTasks[e]||(g.value.dailyTasks[e]={completed:!1,progress:0,lastUpdated:Date.now(),rawTaskData:null,taskCompleteData:{}});if(o&&o.role&&o.role.bottleHelpers){const l=Date.now(),u=o.role.bottleHelpers.helperStopTime,p=u.toString().length<=10?u*1e3:u,v=Math.max(0,Math.floor((p-l)/1e3)),P=p>l;g.value.bottleRobots[e]={status:P?"运行中":"已停止",time:Xe(v*1e3),remainingTime:v,isRunning:P}}else if(o&&o.role&&o.role.bottle){const l=o.role.bottle.status===1;g.value.bottleRobots[e]={status:l?"运行中":"已停止",time:Es(o.role.bottle.lastRunTime||Date.now()),isRunning:l}}if(o&&o.role&&o.role.hangUp){const l=Date.now()/1e3,u=o.role.hangUp.lastTime||0,p=o.role.hangUp.hangUpTime||0,v=l-u;let P,h,L;v<=p?(P=Math.max(0,Math.floor(p-v)),h=Math.floor(v),L=!0):(P=0,h=Math.min(Math.floor(v),Math.floor(p)),L=!1),g.value.hangupTimes[e]={timeLeft:P,totalTime:h,isActive:L}}if(o&&o.role&&o.role.tower){const l=o.role.tower.id||0;g.value.towerFloors[e]={floor:Math.floor(l/10)+1,layer:l%10+1,energy:o.role.tower.energy||0}}}catch(o){console.warn(`更新Token ${e} 进度失败:`,o)}},Es=e=>e?new Date(e).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit"}):"--:--:--",Xe=e=>{const s=Math.floor(e/36e5),a=Math.floor(e%36e5/6e4),o=Math.floor(e%6e4/1e3);return`${s.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`},Ke=e=>{const s=Math.floor(Number(e)||0);if(s<=0)return"00:00";const a=Math.floor(s/3600),o=Math.floor(s%3600/60);return`${a.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`},$e=R({}),Se=Ee({}),Us=e=>{try{if(!("localStorage"in window))return console.warn("localStorage不可用"),null;const s=`daily-task-settings:${e}`,a=localStorage.getItem(s);if(!a)return console.log(`未找到Token ${e} 的保存设置`),null;try{const o=JSON.parse(a);return console.log("成功加载设置:",o),o}catch(o){return console.error("解析设置失败，清除损坏的设置数据:",o),localStorage.removeItem(s),null}}catch(s){return console.error("加载设置失败:",s),null}},qe=(e,s)=>{try{if(!("localStorage"in window))return console.warn("localStorage不可用，无法保存设置"),!1;const a=`daily-task-settings:${e}`;try{const o=JSON.stringify(s);return localStorage.setItem(a,o),console.log("设置保存成功:",s),!0}catch(o){return console.error("序列化设置失败:",o),!1}}catch(a){return console.error("保存设置失败:",a),!1}},q=e=>{if(!Se[e]){const s=Us(e),a={bossTimes:3,claimBottle:!0,payRecruit:!0,openBox:!0,arenaEnable:!0,claimHangUp:!0,claimEmail:!0,blackMarketPurchase:!0};Se[e]={...a,...s},(!s||Object.keys(s).length<Object.keys(a).length)&&qe(e,Se[e])}return Se[e]};Ge(()=>Se,e=>{Object.keys(e).forEach(s=>{qe(s,e[s])})},{deep:!0});const Ze=R({}),A=(e,s,a="info")=>{B.value.has(e)||B.value.set(e,[]);const o={time:new Date().toLocaleTimeString(),message:s,type:a},l=B.value.get(e);l.push(o);const u=100;l.length>u&&l.splice(0,l.length-u),B.value.set(e,l),ft(()=>{const p=Ze.value[e];p&&(p.scrollTop=p.scrollHeight,p.scrollTo({top:p.scrollHeight,behavior:"auto"}))})},Rs=e=>{B.value.has(e)&&B.value.set(e,[])},zs=()=>{ge.warning({title:"清空所有日志",content:"确定要清空所有Token的执行日志吗？此操作无法恢复。",positiveText:"确定清空",negativeText:"取消",onPositiveClick:()=>{B.value.clear(),f.success("所有Token的执行日志已清空")}})},Bs=(e,s)=>{$e.value[s]=e},As=e=>e>=100?"#10b981":e>=50?"#3b82f6":"#f59e0b",Ns=async()=>{const e=d.gameTokens.filter(h=>$(h.id)!=="connected");if(e.length===0){f.success("所有Token已连接");return}const s=50,a=3,o=1e3,l={total:e.length,success:0,failed:0,retrying:0,startTime:Date.now()};console.log(`正在连接 ${e.length} 个Token...`);const u=async(h,L=0)=>{try{try{A(h.id,`开始连接...${L>0?` (第${L}次重试)`:""}`,"info"),re.value.add(h.id);const F=await new Promise(D=>{const W=setTimeout(()=>{D({success:!1,error:"连接超时"})},2e3);d.selectToken(h.id),setTimeout(()=>{clearTimeout(W);const t=$(h.id);D(t==="connected"?{success:!0,token:h}:{success:!1,error:`连接状态: ${t}`})},2e3)});if(F.success)return l.success++,A(h.id,"连接成功","success"),{success:!0,token:h};throw new Error(F.error)}catch(F){return L<a?(l.retrying++,A(h.id,`连接失败: ${F.message}，将在${o}ms后重试`,"warning"),await new Promise(D=>setTimeout(D,o)),u(h,L+1)):(l.failed++,A(h.id,`连接失败: ${F.message} (已达到最大重试次数)`,"error"),{success:!1,token:h,error:F.message})}finally{d.releaseConnectionLock(h.id,"connect"),re.value.delete(h.id),p()}}catch(F){return l.failed++,A(h.id,`连接过程发生异常: ${F.message}`,"error"),re.value.delete(h.id),d.releaseConnectionLock(h.id,"connect"),p(),{success:!1,token:h,error:F.message}}},p=()=>{const h=l.success+l.failed;Q(),h===l.total&&setTimeout(()=>{startMessage==null||startMessage.close(),v()},500)},v=()=>{const h=((Date.now()-l.startTime)/1e3).toFixed(1);l.success===l.total?f.success(`所有 ${l.total} 个Token连接成功！总耗时: ${h}秒`):l.success>0?f.warning(`连接完成：成功 ${l.success} 个，失败 ${l.failed} 个，总耗时: ${h}秒`):f.error(`所有 ${l.total} 个Token连接失败，请检查网络和Token有效性`)},P=async()=>{const h=[];for(let L=0;L<e.length;L+=s){const F=e.slice(L,L+s),D=await Promise.all(F.map(W=>u(W)));h.push(...D),L+s<e.length&&await new Promise(W=>setTimeout(W,1e3+Math.random()*1e3))}return h};try{await P()}catch(h){console.error("批量连接过程中发生严重错误:",h),f.error("批量连接过程中发生错误"),startMessage==null||startMessage.close()}},Qe=R([]);vs(()=>{Qe.value=Be.filter(e=>!e.key||!e.key.startsWith("bulk-")),ze()});const Ls=async()=>{var e;if(Te.value)try{await Te.value.validate(),ye.value=!0;const s=d.importBase64Token(M.name,M.base64Token,{server:M.server,wsUrl:M.wsUrl,importMethod:"manual"});if(s.success)f.success(s.message),s.details,Hs(),K.value=!1;else{const a=s.error||s.message||"Token导入失败";f.error(a),console.error("Token导入错误详情:",{error:s.error,message:s.message,originalToken:((e=M.base64Token)==null?void 0:e.substring(0,50))+"..."})}}catch{}finally{ye.value=!1}};let Ve="";const Fs=e=>{Ve=e,f.success(`已选择文件: ${e}`)},Os=e=>{try{M.base64Token=e,Ve?M.name=Ve:M.name=`自动导入-${new Date().toLocaleString()}`}catch(s){console.error("处理Token参数时出错:",s),f.error("Token提取成功，但处理参数时出错")}},Ws=async e=>{try{const s=e.length;let a=0,o=0;console.log(`开始批量导入 ${s} 个账号...`);for(let l=0;l<e.length;l++){const u=e[l];if(u.success)try{const p=u.fileName.replace(/\.bin$/,""),v=d.importBase64Token(p,u.wssParams,{server:"",wsUrl:"",importMethod:"bin_file"});v.success?a++:(o++,console.error(`导入文件 ${u.fileName} 失败:`,v.error||v.message))}catch(p){o++,console.error(`导入文件 ${u.fileName} 时发生异常:`,p)}else o++,console.error(`文件 ${u.fileName} 处理失败:`,u.error);((l+1)%5===0||l===e.length-1)&&console.log(`批量导入进度: ${l+1}/${s}`)}f.success(`批量导入完成: 成功 ${a} 个，失败 ${o} 个`)}catch(s){console.error("批量导入过程中发生错误:",s),f.error("批量导入过程中发生错误")}},Hs=()=>{Object.keys(M).forEach(e=>{M[e]=""})},js=(e,s=!1)=>{const a=d.selectedTokenId===e.id,o=$(e.id);if(a&&o==="connected"&&!s){A(e.id,`${e.name} 已选中且已连接`,"info");return}if(a&&o==="connecting"&&!s){A(e.id,`${e.name} 正在连接中...`,"info");return}d.selectToken(e.id,s)?s?f.success(`强制重连：${e.name}`):a?f.success(`重新连接：${e.name}`):f.success(`已选择：${e.name}`):f.error(`选择Token失败：${e.name}`)},$=e=>d.getWebSocketStatus(e),Ie=e=>{const s=$(e);return{connected:"已连接",connecting:"连接中...",disconnected:"已断开",error:"连接错误",disconnecting:"断开中..."}[s]||"未连接"};function se(e,s){const a=G.value.get(e);return a&&typeof a.has=="function"&&a.has(s)}function J(e,s,a){G.value.has(e)||G.value.set(e,new Set);const o=G.value.get(e);a?o.add(s):(o.delete(s),o.size===0&&G.value.delete(e))}const es=async e=>{var a,o,l;if(!e)return;J(e.id,"daily",!0),g.value.dailyTasks[e.id]={completed:!1,progress:0,lastUpdated:Date.now()};const s=(u,p="info")=>{A(e.id,u,p)};try{if(A(e.id,`正在为 ${e.name} 执行每日任务...`,"info"),!d||!d.selectedToken)throw new Error("未选择Token或Token无效");const u=q(e.id);s(`当前任务设置: ${JSON.stringify(u)}`),s("开始执行每日任务..."),s("第一步: 获取角色信息...");let p;try{p=await Ce(e.id)}catch{s("首次获取角色信息失败，尝试重试...","warning"),await new Promise(O=>setTimeout(O,3e3)),p=await Ce(e.id)}if(!(p!=null&&p.role))throw new Error("获取角色信息失败或数据异常");s(`当前每日任务进度: ${((a=p.role.dailyTask)==null?void 0:a.dailyPoint)||0}/100`),s("第二步: 构建任务列表...");const v=[],P=p==null?void 0:p.role;console.log("角色数据",P);const h=((o=P.dailyTask)==null?void 0:o.complete)??{},L=P.statistics??{},F=P.statisticsTime??{},D=m=>h[m]===-1,W=m=>{if(!m)return!0;const O=new Date().toDateString(),H=new Date(m).toDateString();return O!==H},t=async(m,O,H={},T="",te=200,ee=0,ce=2)=>{var me,xe;try{if(!d||!d.sendMessageWithPromise)throw new Error("tokenStore或sendMessageWithPromise方法不存在");T&&s(`执行: ${T}${ee>0?` (第${ee}次重试)`:""}`),ee===0&&await new Promise(_e=>setTimeout(_e,Math.random()*300));const de=await d.sendMessageWithPromise(m.id,O,H,te);return T&&s(`${T} - 成功`,"success"),de}catch(de){const _e=de.message||"未知错误",we=`${T||`执行命令${O}`} - 失败: ${_e}`,lt=((me=de.message)==null?void 0:me.includes("服务器错误"))||((xe=de.message)==null?void 0:xe.includes("请求超时")),gs=ee<ce&&lt;if(gs||(s(we,"error"),console.error(we,"详细错误:",de)),gs){const hs=Math.pow(2,ee)*200+Math.random()*200;return s(`${T||`命令${O}`}执行失败，${hs.toFixed(0)}ms后重试...`,"warning"),await new Promise(nt=>setTimeout(nt,hs)),t(m,O,H,T,te,ee+1,ce)}const Me=new Error(we);throw Me.originalError=de,Me.command=O,Me.params=H,Me.retried=ee,Me}},S=()=>{const m=[9904,9905,9901,9902,9903,9904,9905],O=new Date().getDay();return m[O]};if(D(2)||v.push({name:"分享一次游戏",execute:()=>t(e,"system_mysharecallback",{isSkipShareCard:!0,type:2},"分享游戏")}),D(3)||v.push({name:"赠送好友金币",execute:()=>t(e,"friend_batch",{},"赠送好友金币")}),D(4)||(v.push({name:"免费招募",execute:()=>t(e,"hero_recruit",{recruitType:3,recruitNumber:1},"免费招募")}),u.payRecruit&&v.push({name:"付费招募",execute:()=>t(e,"hero_recruit",{recruitType:1,recruitNumber:1},"付费招募")})),!D(6)&&W(F["buy:gold"]))for(let m=0;m<3;m++)v.push({name:`免费点金 ${m+1}/3`,execute:()=>t(e,"system_buygold",{buyNum:1},`免费点金 ${m+1}`)});if(u.claimHangUp&&!D(5)){for(let m=0;m<4;m++)v.push({name:`挂机加钟 ${m+1}/4`,execute:()=>t(e,"system_mysharecallback",{isSkipShareCard:!0,type:2},`挂机加钟 ${m+1}`)});v.push({name:"领取挂机奖励",execute:()=>t(e,"system_claimhangupreward",{},"领取挂机奖励")}),v.push({name:"挂机加钟 5/5",execute:()=>t(e,"system_mysharecallback",{isSkipShareCard:!0,type:2},"挂机加钟 5")})}if(u.openBox&&!D(7)&&v.push({name:"开启木质宝箱",execute:()=>t(e,"item_openbox",{itemId:2001,number:10},"开启木质宝箱10个")}),u.claimBottle&&!D(14)&&v.push({name:"领取盐罐奖励",execute:()=>t(e,"bottlehelper_claim",{},"领取盐罐奖励")}),u.arenaEnable&&!D(13)&&v.push({name:"竞技场战斗",execute:async()=>{var m,O;s("开始竞技场战斗流程"),await t(e,"arena_startarea",{},"开始竞技场");for(let H=1;H<=3;H++){s(`竞技场战斗 ${H}/3`);const T=await t(e,"arena_getareatarget",{refresh:!1},`获取竞技场目标${H}`),te=(O=(m=T==null?void 0:T.roleList)==null?void 0:m[0])==null?void 0:O.roleId;te?await t(e,"fight_startareaarena",{targetId:te},`竞技场战斗${H}`,1e4):s(`竞技场战斗${H} - 未找到目标`,"warning"),await new Promise(ee=>setTimeout(ee,1e3))}}}),u.bossTimes>0){const m=L["legion:boss"]??0,O=Math.max(u.bossTimes-m,0);if(O>0)for(let T=0;T<O;T++)v.push({name:`军团BOSS ${T+1}/${O}`,execute:()=>t(e,"fight_startlegionboss",{},`军团BOSS ${T+1}`,2e3)});const H=S();for(let T=0;T<3;T++)v.push({name:`每日BOSS ${T+1}/3`,execute:()=>t(e,"fight_startboss",{bossId:H},`每日BOSS ${T+1}`,2e3)})}const k=[{name:"福利签到",cmd:"system_signinreward"},{name:"俱乐部签到",cmd:"legion_signin"},{name:"领取每日礼包",cmd:"discount_claimreward"},{name:"领取收集每日奖励",cmd:"collection_claimfreereward"},{name:"领取免费礼包",cmd:"card_claimreward"}];if(u.claimEmail&&k.push({name:"领取邮件奖励",cmd:"mail_claimallattachment"}),k.forEach(m=>{v.push({name:m.name,execute:()=>t(e,m.cmd,m.params||{},m.name)})}),W(F["artifact:normal:lottery:time"]))for(let m=0;m<3;m++)v.push({name:`免费钓鱼 ${m+1}/3`,execute:()=>t(e,"artifact_lottery",{lotteryNumber:1,newFree:!0,type:1},`免费钓鱼 ${m+1}`)});const X=["魏国","蜀国","吴国","群雄"];for(let m=1;m<=4;m++)W(F[`genie:daily:free:${m}`])&&v.push({name:`${X[m-1]}灯神免费扫荡`,execute:()=>t(e,"genie_sweep",{genieId:m},`${X[m-1]}灯神免费扫荡`)});for(let m=0;m<3;m++)v.push({name:`领取免费扫荡卷 ${m+1}/3`,execute:()=>t(e,"genie_buysweep",{},`领取免费扫荡卷 ${m+1}`)});u.blackMarketPurchase&&!D(12)&&v.push({name:"黑市购买1次物品",execute:()=>t(e,"store_purchase",{goodsId:1},"黑市购买1次物品")});for(let m=1;m<=10;m++)v.push({name:`领取任务奖励${m}`,execute:()=>t(e,"task_claimdailypoint",{taskId:m},`领取任务奖励${m}`,1e3)});v.push({name:"领取日常任务奖励",execute:()=>t(e,"task_claimdailyreward",{},"领取日常任务奖励")},{name:"领取周常任务奖励",execute:()=>t(e,"task_claimweekreward",{},"领取周常任务奖励")});const V=v.length;s(`共有 ${V} 个任务待执行`);const le=2;let I=0;const ie=[];for(let m=0;m<v.length;m+=le)ie.push(v.slice(m,m+le));for(let m=0;m<ie.length;m++){const O=ie[m];try{const H=O.map(ce=>ce.execute().then(()=>(I++,{success:!0,task:ce.name})).catch(me=>{var de,_e,we;const xe=((de=me.message)==null?void 0:de.includes("服务器错误"))||((we=(_e=me.originalError)==null?void 0:_e.message)==null?void 0:we.includes("服务器错误"));return xe?s(`任务执行失败: ${ce.name} - 服务器错误，尝试继续执行其他任务`,"warning"):s(`任务执行失败: ${ce.name} - ${me.message}`,"error"),{success:!1,task:ce.name,error:me.message,isServerError:xe}})),T=await Promise.all(H),te=Math.min((m+1)*le,V),ee=Math.floor(te/V*100);if(g.value.dailyTasks[e.id]={completed:te>=V,progress:ee,lastUpdated:Date.now()},m<ie.length-1){const ce=200+Math.random()*300;await new Promise(me=>setTimeout(me,ce))}}catch(H){console.error("批次执行失败:",H);const T=Math.min((m+1)*le,V),te=Math.floor(T/V*100);g.value.dailyTasks[e.id]={completed:!1,progress:te,lastUpdated:Date.now()},m<ie.length-1&&await new Promise(ee=>setTimeout(ee,1e3))}}g.value.dailyTasks[e.id]={completed:!0,progress:100,lastUpdated:Date.now()},s("所有任务执行完成","success"),I===v.length?f.success(`${e.name} 每日任务全部执行成功`):I>0?f.success(`${e.name} 每日任务部分执行成功 (${I}/${v.length})`):f.error(`${e.name} 每日任务全部执行失败`),await new Promise(m=>setTimeout(m,3e3)),await Ce(e.id)}catch(u){console.error("执行每日任务失败:",u),f.error(`${e.name} 每日任务执行过程中发生错误: ${u.message||"未知错误"}`),g.value.dailyTasks[e.id]={completed:!1,progress:((l=g.value.dailyTasks[e.id])==null?void 0:l.progress)||0,lastUpdated:Date.now()}}finally{setTimeout(()=>{J(e.id,"daily",!1)},1e3)}},Ce=async(e,s=0,a=3)=>{var o;try{if(!d)throw new Error("tokenStore未初始化");console.log(`正在刷新Token ${e} 的角色信息...${s>0?` 第${s}次重试`:""}`);try{const l=await d.sendGetRoleInfo(e);return console.log(`Token ${e} 角色信息获取成功`),l}catch(l){if(console.error(`获取Token ${e} 角色信息失败:`,l),(o=l.message)!=null&&o.includes("服务器错误")&&s<a){console.log(`准备重试获取Token ${e} 角色信息...`);const u=Math.pow(2,s)*1e3+Math.random()*500;return await new Promise(p=>setTimeout(p,u)),Ce(e,s+1,a)}throw l}}catch(l){throw console.error(`刷新Token ${e} 角色信息时发生严重错误:`,l),l}},qs=e=>{$e.value[e]=!$e.value[e]},ss=async e=>{if(e){J(e.id,"bottle",!0);try{A(e.id,`正在为 ${e.name} 处理盐罐机器人...`,"info"),d.sendMessage(e.id,"bottlehelper_stop"),await new Promise(s=>setTimeout(s,500)),d.sendMessage(e.id,"bottlehelper_start"),f.success(`${e.name} 盐罐机器人已重启`),A(e.id,`${e.name} 盐罐机器人已重启`,"success")}catch(s){console.error("处理盐罐机器人失败:",s),f.error(`${e.name} 盐罐机器人处理失败: ${s.message}`),A(e.id,`${e.name} 盐罐机器人处理失败: ${s.message}`,"error")}finally{setTimeout(()=>{J(e.id,"bottle",!1)},1e3)}}},ts=async e=>{if(e){J(e.id,"hangup",!0);try{A(e.id,`正在为 ${e.name} 处理挂机相关操作...`,"info"),A(e.id,`正在为 ${e.name} 领取挂机奖励...`,"info"),d.sendMessage(e.id,"system_mysharecallback"),await new Promise(a=>setTimeout(a,200)),d.sendMessage(e.id,"system_claimhangupreward"),await new Promise(a=>setTimeout(a,200)),d.sendMessage(e.id,"system_mysharecallback",{isSkipShareCard:!0,type:2}),A(e.id,`正在为 ${e.name} 进行挂机加钟...`,"info");const s=[];for(let a=0;a<4;a++){const o=new Promise(l=>{setTimeout(()=>{d.sendMessage(e.id,"system_mysharecallback",{isSkipShareCard:!0,type:2}),l()},a*300)});s.push(o)}await Promise.all(s),setTimeout(()=>{Ne(e.id),f.success(`${e.name} 挂机加钟已完成，请查看挂机剩余时间`),setTimeout(()=>{J(e.id,"hangup",!1)},1e3)},2500)}catch(s){console.error("挂机操作失败:",s),f.error(`${e.name} 挂机操作失败: ${s.message}`),J(e.id,"hangup",!1)}}},as=async e=>{if(!e)return;J(e.id,"tower",!0);const s=setTimeout(()=>{J(e.id,"tower",!1),f.error(`${e.name} 咸将塔挑战超时`)},2e4);try{A(e.id,`正在为 ${e.name} 进行咸将塔挑战...`,"info"),await d.sendMessageWithPromise(e.id,"fight_starttower",{},2e3),f.success(`${e.name} 咸将塔挑战已完成`)}catch(a){console.error("咸将塔挑战失败:",a),f.error(`${e.name} 咸将塔挑战失败: ${a.message}`)}finally{clearTimeout(s),setTimeout(()=>{J(e.id,"tower",!1)},500)}},os=async e=>{if(e){J(e.id,"store_buy",!0);try{A(e.id,`正在为 ${e.name} 进行商店购买...`,"info");const s=[1,2,3];let a=[];A(e.id,`${e.name} 开始第一轮购买...`,"info");const o=await ls(e,s);a=[...a,...o],A(e.id,`${e.name} 正在刷新商店...`,"info"),await Vs(e),A(e.id,`${e.name} 商店刷新完成`,"success"),A(e.id,`${e.name} 开始第二轮购买...`,"info");const l=await ls(e,s);a=[...a,...l],a.length>0?f.success(`${e.name} 商店购买全部完成，共成功购买 ${a.length} 个商品`):f.warning(`${e.name} 所有商品购买均失败`)}catch(s){console.error("商店购买流程出错:",s),f.error(`${e.name} 商店购买流程出错: ${s.message}`)}finally{setTimeout(()=>{J(e.id,"store_buy",!1)},1e3)}}},ls=async(e,s)=>{const a=[];for(const o of s)try{A(e.id,`正在购买商品 ID: ${o}`,"info");const l=await d.sendMessageWithPromise(e.id,"store_buy",{goodsId:o},800);a.push(o),o<s[s.length-1]&&await new Promise(u=>setTimeout(u,200))}catch(l){console.error(`购买商品 ID ${o} 失败:`,l),f.warning(`商品 ID ${o} 购买失败: ${l.message||"未知错误"}`),await new Promise(u=>setTimeout(u,500))}return a},Vs=async e=>{try{await d.sendMessageWithPromise(e.id,"store_refresh",{},8e3),await new Promise(s=>setTimeout(s,1e3))}catch(s){console.error("商店刷新失败:",s),f.warning(`${e.name} 商店刷新失败: ${s.message}`)}},Gs=e=>{const s=[{label:"复制Token",key:"copy",icon:()=>Fe(z,null,{default:()=>Fe(ht)})}];return s.push({type:"divider"},{label:"删除",key:"delete",icon:()=>Fe(z,null,{default:()=>Fe(_s)}),props:{style:{color:"#e74c3c"}}}),s},Js=async(e,s)=>{switch(e){case"copy":Ys(s);break;case"delete":Xs(s);break}},Ys=async e=>{try{await navigator.clipboard.writeText(e.token),f.success("Token已复制到剪贴板")}catch{f.error("复制失败")}},Xs=e=>{ge.warning({title:"删除Token",content:`确定要删除Token "${e.name}" 吗？此操作无法恢复。`,positiveText:"确定删除",negativeText:"取消",onPositiveClick:()=>{d.removeToken(e.id),f.success("Token已删除")}})},Le=e=>{switch(e){case"export":Ks();break;case"import":Zs();break;case"clean":Qs();break;case"disconnect":Is();break;case"clear":et();break;case"bulk-daily":ns();break;case"bulk-bottle":rs();break;case"bulk-hangup":is();break;case"bulk-tower":cs();break;case"bulk-shop-4001":ds();break;case"bulk-smart-send-car":st();break;case"bulk-claim-all-cars":tt();break}},Ks=()=>{try{const e=d.exportTokens(),s=JSON.stringify(e,null,2),a=new Blob([s],{type:"application/json"}),o=document.createElement("a");o.href=URL.createObjectURL(a),o.download=`tokens_backup_${new Date().toISOString().split("T")[0]}.json`,o.click(),f.success("Token数据已导出")}catch{f.error("导出失败")}},Zs=()=>{const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=s=>{const a=s.target.files[0];if(a){const o=new FileReader;o.onload=l=>{try{const u=JSON.parse(l.target.result),p=d.importTokens(u);p.success?f.success(p.message):f.error(p.message)}catch{f.error("文件格式错误")}},o.readAsText(a)}},e.click()},Qs=()=>{const e=d.cleanExpiredTokens();f.success(`已清理 ${e} 个过期Token`)},Is=()=>{d.gameTokens.forEach(e=>{d.closeWebSocketConnection(e.id)}),f.success("所有连接已断开")},et=()=>{ge.error({title:"清除所有Token",content:"确定要清除所有Token吗？此操作无法恢复！",positiveText:"确定清除",negativeText:"取消",onPositiveClick:()=>{d.clearAllTokens(),f.success("所有Token已清除")}})},ns=()=>{const e=d.gameTokens.filter(s=>$(s.id)==="connected");if(e.length===0){f.warning("没有已连接的Token可执行任务");return}console.log(`开始为 ${e.length} 个Token执行每日任务...`),ve(e,es,"每日任务")},st=()=>{const e=d.gameTokens.filter(s=>$(s.id)==="connected");if(e.length===0){f.warning("没有已连接的Token可执行任务");return}ve(e,us,"智能发车")},tt=()=>{const e=d.gameTokens.filter(s=>$(s.id)==="connected");if(e.length===0){f.warning("没有已连接的Token可执行任务");return}ve(e,ms,"一键收车")},rs=()=>{const e=d.gameTokens.filter(s=>$(s.id)==="connected");if(e.length===0){f.warning("没有已连接的Token可执行任务");return}console.log(`开始为 ${e.length} 个Token启动盐罐机器人...`),ve(e,ss,"盐罐机器人")},is=()=>{const e=d.gameTokens.filter(s=>$(s.id)==="connected");if(e.length===0){f.warning("没有已连接的Token可执行任务");return}console.log(`开始为 ${e.length} 个Token进行挂机加钟...`),ve(e,ts,"挂机加钟")},cs=()=>{const e=d.gameTokens.filter(s=>$(s.id)==="connected");if(e.length===0){f.warning("没有已连接的Token可执行任务");return}console.log(`开始为 ${e.length} 个Token挑战咸将塔...`),ve(e,as,"咸将塔挑战")},ds=()=>{const e=d.gameTokens.filter(s=>$(s.id)==="connected");ve(e,async s=>{try{return await os(s),Promise.resolve()}catch(a){return console.error(`Token ${s.id} 商店购买失败:`,a),Promise.reject(a)}},"4001以下商店购买")},ve=async(e,s,a)=>{const o={success:0,failed:0,total:e.length};try{const l=new Set,u=[...e];let p=0;for(;p<u.length||l.size>0;){for(;p<u.length&&l.size<Fo;){const v=u[p];p++;const P=s(v).then(()=>{o.success++}).catch(h=>{o.failed++,console.error(`${v.name||v.id} ${a}失败:`,h)}).finally(()=>{l.delete(P),progressNotification.update({description:`${o.success+o.failed}/${o.total} 完成`})});l.add(P)}l.size>0&&await Promise.race(Array.from(l))}progressNotification.update({type:o.failed>0?"warning":"success",message:`${a}执行完成`,description:`成功: ${o.success}, 失败: ${o.failed}`,duration:5})}catch(l){console.error(`${a}批量执行异常:`,l),progressNotification.update({type:"error",message:`${a}执行失败`,description:l.message,duration:5})}},at=async e=>{re.value.add(e.id);try{if($(e.id)==="connected"){f.success(`${e.name} 已连接，进入任务管理`),ue.push("/admin/dashboard");return}A(e.id,`正在探测 ${e.name} 的连接状态...`,"info");try{await d.createWebSocketConnection(e.id,e.token,e.wsUrl);let a=0;const o=30;for(;a<o;){await new Promise(u=>setTimeout(u,100));const l=$(e.id);if(l==="connected"){f.success(`${e.name} 连接成功，进入任务管理`),ue.push("/admin/dashboard");return}if(l==="error")throw new Error("连接失败");a++}throw new Error("连接超时")}catch(a){console.error("连接探测失败:",a)}}finally{re.value.delete(e.id)}};Ge(()=>[fe.token,fe.api],{immediate:!1}),vs(async()=>{d.initTokenStore(),!d.hasTokens&&!fe.token&&!fe.api&&(K.value=!0),await C()}),ut(()=>{j()});const us=async e=>{var s,a,o,l,u,p,v,P;if(e){J(e.id,"launch",!0);try{A(e.id,`正在为 ${e.name} 执行智能发车...`,"info");const h=await d.sendMessageWithPromise(e.id,"car_getrolecar",{},3e3),L=await d.sendMessageWithPromise(e.id,"role_getroleinfo",{},3e3);let F=((o=(a=(s=L==null?void 0:L.role)==null?void 0:s.items)==null?void 0:a[35002])==null?void 0:o.quantity)||0;if(!h||!h.roleCar||!h.roleCar.carDataMap)throw new Error("获取车辆列表失败");const D=h.roleCar.carDataMap;for(const W in D)if(D.hasOwnProperty(W)){const t=D[W];if((t.sendAt||0)===0){if(console.log(`处理车辆: ${W}，颜色: ${t.color||0}`),fs(t,F)){await d.sendMessageWithPromise(e.id,"car_send",{carId:W,helperId:0,text:""},3e3),await new Promise(V=>setTimeout(V,500));continue}let k=!1;const X=Number(t.refreshCount||0)===0;if(F>=6)k=!0;else if(X)k=!0;else{await d.sendMessageWithPromise(e.id,"car_send",{carId:W,helperId:0,text:""},3e3),await new Promise(V=>setTimeout(V,500));continue}for(;k;){await d.sendMessageWithPromise(e.id,"car_refresh",{carId:W},3e3),await new Promise(m=>setTimeout(m,300));const V=await d.sendMessageWithPromise(e.id,"role_getroleinfo",{},3e3);F=((p=(u=(l=V==null?void 0:V.role)==null?void 0:l.items)==null?void 0:u[35002])==null?void 0:p.quantity)||0;const le=await d.sendMessageWithPromise(e.id,"car_getrolecar",{},3e3),I=(P=(v=le==null?void 0:le.roleCar)==null?void 0:v.carDataMap)==null?void 0:P[W];if(I&&fs(I,F)){await d.sendMessageWithPromise(e.id,"car_send",{carId:W,helperId:0,text:""},3e3),await new Promise(m=>setTimeout(m,500));break}const ie=Number((I==null?void 0:I.refreshCount)||0)===0;if(F>=6)k=!0;else if(ie)k=!0;else{await d.sendMessageWithPromise(e.id,"car_send",{carId:W,helperId:0,text:""},3e3),await new Promise(m=>setTimeout(m,500));break}}}}f.success(`${e.name} 智能发车已完成`)}catch(h){console.error("智能发车失败:",h),f.error(`${e.name} 智能发车失败: ${h.message}`)}finally{setTimeout(()=>{J(e.id,"launch",!1)},1e3)}}},ms=async e=>{if(e){J(e.id,"recycle",!0);try{A(e.id,`正在为 ${e.name} 执行一键收车...`,"info");const s=await d.sendMessageWithPromise(e.id,"car_getrolecar",{},3e3);if(!s||!s.roleCar||!s.roleCar.carDataMap)throw new Error("获取车辆列表失败");const a=s.roleCar.carDataMap;let o=0;for(const l in a)if(a.hasOwnProperty(l)){const u=a[l],p=u.sendAt||0,v=u.claimAt||0,P=u.rewards||[];if(p>0&&v===0&&P.length>0)try{await d.sendMessageWithPromise(e.id,"car_claim",{carId:l},3e3),o++,await new Promise(h=>setTimeout(h,300))}catch(h){console.error(`收车失败 (ID: ${l}):`,h)}}await Ce(e.id),Ne(e.id),f.success(`${e.name} 一键收车已完成，共收取 ${o} 辆赛车奖励`)}catch(s){console.error("一键收车失败:",s),f.error(`${e.name} 一键收车失败: ${s.message}`)}finally{setTimeout(()=>{J(e.id,"recycle",!1)},1e3)}}},fs=(e,s)=>{const a=e.color||0,o=e.rewards||[],l=ot(o);return s>=6?a>=5||l>=4||ps(o):a>=4||l>=2||ps(o)},ot=e=>{if(!e||!Array.isArray(e))return 0;let s=0;for(const a of e)a.type===3&&a.itemId===35002&&(s+=a.value);return s},ps=e=>{const s=[{type:3,itemId:1001,value:10},{type:3,itemId:3201,value:10},{type:3,itemId:1022,value:2e3},{type:2,itemId:0,value:2e3},{type:3,itemId:1022,value:2500},{type:3,itemId:1001,value:12}];if(!e||!Array.isArray(e))return!1;for(const a of s)if(e.find(l=>l.type===a.type&&l.itemId===a.itemId&&l.value>=a.value))return!0;return!1};return(e,s)=>{const a=ae("n-radio-button"),o=ae("n-radio-group"),l=ae("n-input"),u=ae("n-form-item"),p=ae("n-collapse-item"),v=ae("n-collapse"),P=ae("n-form"),h=ae("n-dropdown"),L=ae("BuildingIcon"),F=ae("n-empty"),D=ae("n-switch"),W=ae("n-select");return y(),w("div",Zt,[n("div",Qt,[!i(d).hasTokens||K.value?(y(),w("div",It,[n("div",ea,[n("div",sa,[r(o,{value:he.value,"onUpdate:value":s[0]||(s[0]=t=>he.value=t),class:"import-method-tabs",size:"small"},{default:c(()=>[r(a,{value:"url"},{default:c(()=>[...s[10]||(s[10]=[b(" 导入获取 ",-1)])]),_:1}),r(a,{value:"manual"},{default:c(()=>[...s[11]||(s[11]=[b(" 手动输入 ",-1)])]),_:1})]),_:1},8,["value"])]),he.value==="url"?(y(),pe(Kt,{key:0,onFileSelected:Fs,onTokenExtracted:Os,onBatchProcessed:Ws})):Y("",!0),he.value==="manual"?(y(),pe(P,{key:1,ref_key:"importFormRef",ref:Te,model:M,rules:He,"label-placement":"top",size:"large","show-label":!0},{default:c(()=>[r(u,{label:"游戏角色名称",path:"name","show-label":!0},{default:c(()=>[r(l,{value:M.name,"onUpdate:value":s[1]||(s[1]=t=>M.name=t),placeholder:"例如：主号战士",clearable:""},null,8,["value"])]),_:1}),r(u,{label:"Token字符串",path:"base64Token","show-label":!0},{default:c(()=>[r(l,{value:M.base64Token,"onUpdate:value":s[2]||(s[2]=t=>M.base64Token=t),type:"textarea",rows:3,placeholder:"粘贴Token字符串...",clearable:""},null,8,["value"])]),_:1}),r(v,null,{default:c(()=>[r(p,{title:"角色详情 (可选)",name:"optional"},{default:c(()=>[n("div",ta,[r(u,{label:"服务器"},{default:c(()=>[r(l,{value:M.server,"onUpdate:value":s[3]||(s[3]=t=>M.server=t),placeholder:"服务器名称"},null,8,["value"])]),_:1}),r(u,{label:"自定义连接地址"},{default:c(()=>[r(l,{value:M.wsUrl,"onUpdate:value":s[4]||(s[4]=t=>M.wsUrl=t),placeholder:"留空使用默认连接"},null,8,["value"])]),_:1})])]),_:1})]),_:1}),n("div",aa,[r(i(E),{type:"primary",size:"large",block:"",loading:ye.value,onClick:Ls},{icon:c(()=>[r(i(z),null,{default:c(()=>[r(i(vt))]),_:1})]),default:c(()=>[s[12]||(s[12]=b(" 添加Token ",-1))]),_:1},8,["loading"]),i(d).hasTokens?(y(),pe(i(E),{key:0,size:"large",block:"",onClick:s[5]||(s[5]=t=>K.value=!1)},{default:c(()=>[...s[13]||(s[13]=[b(" 取消 ",-1)])]),_:1})):Y("",!0)])]),_:1},8,["model"])):Y("",!0)])])):Y("",!0),n("div",oa,[n("div",la,[n("h2",null,"Token列表 ("+U(i(d).gameTokens.length)+"个)",1),n("div",na,[r(i(E),{type:"info",onClick:Ns},{icon:c(()=>[r(i(z),null,{default:c(()=>[r(i(Je))]),_:1})]),default:c(()=>[s[14]||(s[14]=b(" 一键连接 ",-1))]),_:1}),r(i(E),{type:"primary",onClick:s[6]||(s[6]=t=>K.value=!0)},{icon:c(()=>[r(i(z),null,{default:c(()=>[r(i(yt))]),_:1})]),default:c(()=>[s[15]||(s[15]=b(" 添加Token ",-1))]),_:1}),r(i(E),{type:"error",onClick:s[7]||(s[7]=t=>Le("clear"))},{default:c(()=>[...s[16]||(s[16]=[b(" 删除Token ",-1)])]),_:1}),r(h,{options:[...Qe.value],onSelect:Le},{default:c(()=>[r(i(E),null,{icon:c(()=>[r(i(z),null,{default:c(()=>[r(i(Tt))]),_:1})]),default:c(()=>[s[17]||(s[17]=b(" 批量管理 ",-1))]),_:1})]),_:1},8,["options"])])]),r(v,{class:"bulk-operations-panel"},{default:c(()=>[r(p,{name:"bulk-operations","show-icon":!1},{header:c(()=>[n("div",ra,[r(i(z),{size:"16"},{default:c(()=>[r(i(Oe))]),_:1}),s[18]||(s[18]=n("span",{class:"bulk-panel-title"},"批量任务操作",-1)),i(d).gameTokens.filter(t=>$(t.id)==="connected").length>0?(y(),pe(i(Ts),{key:0,type:"success",size:"small"},{default:c(()=>[b(" 已连接 "+U(i(d).gameTokens.filter(t=>$(t.id)==="connected").length)+" 个 ",1)]),_:1})):Y("",!0)])]),default:c(()=>[n("div",ia,[r(i(E),{type:"primary",size:"large",disabled:i(d).gameTokens.filter(t=>$(t.id)==="connected").length===0,onClick:ns},{icon:c(()=>[r(i(z),null,{default:c(()=>[r(i(Oe))]),_:1})]),default:c(()=>[s[19]||(s[19]=b(" 批量每日任务 ",-1))]),_:1},8,["disabled"]),r(i(E),{type:"success",size:"large",disabled:i(d).gameTokens.filter(t=>$(t.id)==="connected").length===0,onClick:rs},{icon:c(()=>[r(i(z),null,{default:c(()=>[r(i(Je))]),_:1})]),default:c(()=>[s[20]||(s[20]=b(" 批量盐罐机器人 ",-1))]),_:1},8,["disabled"]),r(i(E),{type:"warning",size:"large",disabled:i(d).gameTokens.filter(t=>$(t.id)==="connected").length===0,onClick:is},{icon:c(()=>[r(i(z),null,{default:c(()=>[r(i(ws))]),_:1})]),default:c(()=>[s[21]||(s[21]=b(" 批量挂机加钟 ",-1))]),_:1},8,["disabled"]),r(i(E),{type:"info",size:"large",disabled:i(d).gameTokens.filter(t=>$(t.id)==="connected").length===0,onClick:cs},{icon:c(()=>[r(i(z),null,{default:c(()=>[r(L)]),_:1})]),default:c(()=>[s[22]||(s[22]=b(" 批量咸将塔挑战 ",-1))]),_:1},8,["disabled"]),r(i(E),{type:"success",size:"large",disabled:i(d).gameTokens.filter(t=>$(t.id)==="connected").length===0,onClick:ds},{default:c(()=>[...s[23]||(s[23]=[b(" 4001以下商店购买 ",-1)])]),_:1},8,["disabled"]),r(i(E),{type:"success",size:"large",disabled:i(d).gameTokens.filter(t=>$(t.id)==="connected").length===0,onClick:s[8]||(s[8]=t=>Le("bulk-smart-send-car"))},{default:c(()=>[...s[24]||(s[24]=[b(" 批量智能发车 ",-1)])]),_:1},8,["disabled"]),r(i(E),{type:"success",size:"large",disabled:i(d).gameTokens.filter(t=>$(t.id)==="connected").length===0,onClick:s[9]||(s[9]=t=>Le("bulk-claim-all-cars"))},{default:c(()=>[...s[25]||(s[25]=[b(" 批量一键收车 ",-1)])]),_:1},8,["disabled"]),r(i(E),{type:"error",size:"large",onClick:zs},{icon:c(()=>[r(i(z),null,{default:c(()=>[r(i(_s))]),_:1})]),default:c(()=>[s[26]||(s[26]=b(" 清空所有日志 ",-1))]),_:1})])]),_:1})]),_:1}),n("div",ca,[(y(!0),w(Pe,null,De(i(d).gameTokens,t=>{var S,k,X,V,le,I,ie,m,O,H;return y(),w("div",{key:t.id,class:be(["token-card",{active:t.id===i(d).selectedTokenId,connected:$(t.id)==="connected"}]),onClick:T=>js(t)},[n("div",ua,[n("div",ma,[n("h3",fa,[b(U(t.name)+" ",1),n("span",{class:be(["connection-indicator",{connected:$(t.id)==="connected",connecting:$(t.id)==="connecting",disconnected:$(t.id)==="disconnected"||!$(t.id),error:$(t.id)==="error"}]),title:Ie(t.id)},null,10,pa)]),n("div",ga,[t.server?(y(),w("span",ha,U(t.server),1)):Y("",!0),n("span",va,U(Ie(t.id)),1)])]),n("div",ya,[r(i(E),{text:"",size:"small",onClick:ne(T=>We(t.id,T),["stop"]),title:Z.value.get(t.id)?"展开":"折叠",class:"collapse-button"},{icon:c(()=>[r(i(z),null,{default:c(()=>[n("span",{class:be(["collapse-icon",{collapsed:Z.value.get(t.id)}])},"▼",2)]),_:2},1024)]),_:2},1032,["onClick","title"]),r(h,{options:Gs(),onSelect:T=>Js(T,t)},{default:c(()=>[r(i(E),{text:""},{icon:c(()=>[r(i(z),null,{default:c(()=>[r(i(_t))]),_:1})]),_:1})]),_:1},8,["options","onSelect"])])]),$(t.id)==="connected"&&!Z.value.get(t.id)?(y(),w("div",Ta,[n("div",_a,[n("div",wa,[n("span",ba,"角色："+U(((S=ke(t.id))==null?void 0:S.name)||"未知角色"),1),n("span",ka,"等级："+U(((k=ke(t.id))==null?void 0:k.level)||0),1)]),n("div",$a,[n("span",Sa,"战力："+U(Ss((X=ke(t.id))==null?void 0:X.power)),1),n("span",Ca,"金砖："+U(((V=ke(t.id))==null?void 0:V.diamond)||0),1),n("span",xa,"车票："+U(((ie=(I=(le=ke(t.id))==null?void 0:le.items)==null?void 0:I[35002])==null?void 0:ie.quantity)||0),1)])]),n("div",null,[n("div",null,[n("div",null,[s[27]||(s[27]=n("span",null,[n("b",null,"盐罐：")],-1)),g.value.bottleRobots[t.id]?(y(),w("span",Ma,U(g.value.bottleRobots[t.id].status),1)):(y(),w("span",Pa,"加载中...")),g.value.bottleRobots[t.id]&&g.value.bottleRobots[t.id].time?(y(),w("span",Da," ("+U(g.value.bottleRobots[t.id].time)+") ",1)):Y("",!0)])]),n("div",null,[s[29]||(s[29]=n("span",null,[n("b",null,"已挂机：")],-1)),g.value.hangupTimes[t.id]?(y(),w("span",Ea,U(Ke(g.value.hangupTimes[t.id].totalTime)),1)):(y(),w("span",Ua,"加载中...")),g.value.hangupTimes[t.id]?(y(),w("span",Ra,[n("span",null,[s[28]||(s[28]=n("b",null,"  加钟：",-1)),b(U(Ke(g.value.hangupTimes[t.id].timeLeft)),1)])])):Y("",!0)]),n("div",null,[g.value.towerFloors[t.id]?(y(),w("span",za,[s[30]||(s[30]=n("span",null,[n("b",null,"咸将塔：")],-1)),b(" "+U(g.value.towerFloors[t.id].floor)+"-"+U(g.value.towerFloors[t.id].layer)+"层 ",1)])):(y(),w("span",Ba,"加载中...")),g.value.towerFloors[t.id]?(y(),w("span",Aa,[s[31]||(s[31]=n("b",null,"  次数:",-1)),b(U(g.value.towerFloors[t.id].energy),1)])):Y("",!0)])])])):Y("",!0),$(t.id)==="connected"&&!Z.value.get(t.id)?(y(),w("div",Na,[n("div",La,[r(i(E),{size:"small",type:"primary",loading:se(t.id,"daily"),title:"执行每日任务",class:"feature-button",onClick:ne(T=>es(t),["stop"])},{icon:c(()=>[r(i(z),null,{default:c(()=>[r(i(Oe))]),_:1})]),default:c(()=>[se(t.id,"daily")?(y(),w("span",Fa,"执行中...")):(y(),w("span",Oa,"每日任务"))]),_:2},1032,["loading","onClick"]),r(i(E),{size:"small",type:"success",loading:se(t.id,"bottle"),title:"盐罐机器人",class:"feature-button",onClick:ne(T=>ss(t),["stop"])},{icon:c(()=>[r(i(z),null,{default:c(()=>[r(i(Je))]),_:1})]),default:c(()=>[se(t.id,"bottle")?(y(),w("span",Wa,"处理中...")):(y(),w("span",Ha,"盐罐机器人"))]),_:2},1032,["loading","onClick"]),r(i(E),{size:"small",type:"warning",loading:se(t.id,"hangup"),title:"挂机加钟",class:"feature-button",onClick:ne(T=>ts(t),["stop"])},{icon:c(()=>[r(i(z),null,{default:c(()=>[r(i(ws))]),_:1})]),default:c(()=>[se(t.id,"hangup")?(y(),w("span",ja,"加钟中...")):(y(),w("span",qa,"挂机加钟"))]),_:2},1032,["loading","onClick"]),r(i(E),{size:"small",type:"info",loading:se(t.id,"tower"),title:"咸将塔",class:"feature-button",onClick:ne(T=>as(t),["stop"])},{icon:c(()=>[r(i(z),null,{default:c(()=>[r(i(Et))]),_:1})]),default:c(()=>[se(t.id,"tower")?(y(),w("span",Va,"挑战中...")):(y(),w("span",Ga,"咸将塔"))]),_:2},1032,["loading","onClick"]),r(i(E),{size:"small",type:"success",loading:se(t.id,"store_buy"),title:"商店购买(4001以下，购买商品三个宝箱两轮)",class:"feature-button",onClick:ne(T=>os(t),["stop"])},{default:c(()=>[se(t.id,"store_buy")?(y(),w("span",Ja,"购买中...")):(y(),w("span",Ya,"4001以下商店购买"))]),_:2},1032,["loading","onClick"]),r(i(E),{size:"small",type:"info",loading:se(t.id,"car_claim"),title:"一键收车",class:"feature-button",onClick:ne(T=>ms(t),["stop"])},{default:c(()=>[...s[32]||(s[32]=[b(" 一键收车 ",-1)])]),_:1},8,["loading","onClick"]),r(i(E),{size:"small",type:"info",loading:se(t.id,"car_send"),title:"智能发车",class:"feature-button",onClick:ne(T=>us(t),["stop"])},{default:c(()=>[...s[33]||(s[33]=[b(" 智能发车 ",-1)])]),_:1},8,["loading","onClick"])])])):Y("",!0),n("div",Xa,[n("div",Ka,[r(i(z),null,{default:c(()=>[r(i(Bt))]),_:1}),s[35]||(s[35]=n("span",null,"执行日志",-1)),n("div",Za,[r(i(E),{size:"tiny",onClick:T=>Rs(t.id)},{default:c(()=>[...s[34]||(s[34]=[b(" 清空 ",-1)])]),_:1},8,["onClick"])])]),n("div",Qa,[!B.value.has(t.id)||B.value.get(t.id).length===0?(y(),w("div",Ia," 暂无日志 ")):(y(),w("div",{key:1,class:"console-logs",ref_for:!0,ref:T=>{T&&(Ze.value[t.id]=T)}},[(y(!0),w(Pe,null,De(B.value.get(t.id),(T,te)=>(y(),w("div",{key:te,class:be(["console-log",`log-${T.type}`])},[n("span",eo,U(T.time),1),n("span",so,U(T.message),1)],2))),128))],512))])]),$(t.id)==="connected"&&!Z.value.get(t.id)?(y(),w("div",to,[n("div",ao,[n("div",oo,[r(i(z),{size:"14"},{default:c(()=>[r(i(Oe))]),_:1}),s[36]||(s[36]=n("span",null,"每日任务",-1)),r(i(E),{size:"tiny",text:"",onClick:ne(T=>qs(t.id),["stop"]),class:"progress-card-action"},{default:c(()=>[r(i(z),{size:"12"},{default:c(()=>[r(i(bs))]),_:1})]),_:1},8,["onClick"])]),n("div",lo,[r(i(mt),{type:"line",percentage:((m=g.value.dailyTasks[t.id])==null?void 0:m.progress)||0,height:8,"border-radius":4,color:As(((O=g.value.dailyTasks[t.id])==null?void 0:O.progress)||0),"rail-color":"#f3f4f6"},null,8,["percentage","color"]),n("span",no,[n("span",ro," 完成度: "+U(((H=g.value.dailyTasks[t.id])==null?void 0:H.progress)||0)+"% ",1),r(i(E),{text:"",size:"tiny",class:"task-detail-btn",onClick:ne(T=>Ms(t.id),["stop"])},{default:c(()=>[...s[37]||(s[37]=[b(" 详情 ",-1)])]),_:1},8,["onClick"])])])])])):Y("",!0),s[39]||(s[39]=n("div",{class:"card-body"},null,-1)),t.id===i(d).selectedTokenId?(y(),w("div",io,[r(i(E),{type:"primary",size:"large",block:"",loading:re.value.has(t.id),onClick:T=>at(t)},{icon:c(()=>[r(i(z),null,{default:c(()=>[r(i(wt))]),_:1})]),default:c(()=>[s[38]||(s[38]=b(" 开始任务管理 ",-1))]),_:1},8,["loading","onClick"])])):Y("",!0)],10,da)}),128))])]),!i(d).hasTokens&&!K.value?(y(),w("div",co,[r(F,{size:"large",description:"还没有导入任何Token"},{icon:c(()=>[r(i(z),{size:"64"},{default:c(()=>[r(i(gt))]),_:1})]),_:1})])):Y("",!0)]),(y(!0),w(Pe,null,De(N.value,(t,S)=>(y(),pe(i(ys),{key:S,show:t,preset:"card",title:"每日任务详情",style:{width:"400px"},"onUpdate:show":k=>Ps(k,S)},{default:c(()=>{var k;return[n("div",uo,[r(i(z),null,{default:c(()=>[r(i(bt))]),_:1}),s[41]||(s[41]=n("span",null,"每日任务详情",-1)),n("button",{class:"refresh-button",disabled:(k=G.value.get(S))==null?void 0:k.includes("refresh"),onClick:X=>Ds(S)},[r(i(z),null,{default:c(()=>[r(i($t))]),_:1}),s[40]||(s[40]=b(" 刷新状态 ",-1))],8,mo)]),n("div",fo,[(y(!0),w(Pe,null,De(xs(S),X=>(y(),w("div",{key:X.id,class:"task-item"},[n("div",po,[r(i(z),{class:be(["task-status-icon",{completed:X.completed}])},{default:c(()=>[X.completed?(y(),pe(i(St),{key:0})):(y(),pe(i(kt),{key:1}))]),_:2},1032,["class"]),n("span",go,U(X.name),1)]),r(i(Ts),{type:X.completed?"success":"default",size:"small"},{default:c(()=>[b(U(X.completed?"已完成":"未完成"),1)]),_:2},1032,["type"])]))),128))])]}),_:2},1032,["show","onUpdate:show"]))),128)),(y(!0),w(Pe,null,De($e.value,(t,S)=>(y(),pe(i(ys),{key:S,show:t,preset:"card",title:"每日任务设置",style:{width:"600px"},"onUpdate:show":k=>Bs(k,S)},{header:c(()=>[n("div",ho,[r(i(z),null,{default:c(()=>[r(i(bs))]),_:1}),s[42]||(s[42]=n("span",null,"每日任务设置",-1))])]),footer:c(()=>[n("div",Lo,[r(i(E),{onClick:k=>$e.value.value[S]=!1},{default:c(()=>[...s[53]||(s[53]=[b(" 关闭 ",-1)])]),_:1},8,["onClick"]),r(i(E),{type:"primary",onClick:k=>qe(S,q(S))},{default:c(()=>[...s[54]||(s[54]=[b(" 保存设置 ",-1)])]),_:1},8,["onClick"])])]),default:c(()=>[n("div",vo,[n("div",yo,[s[45]||(s[45]=n("h4",null,"基础设置",-1)),n("div",To,[n("div",_o,[n("div",wo,[s[43]||(s[43]=b(" 竞技场战斗： ",-1)),r(D,{value:q(S).arenaEnable,"onUpdate:value":k=>q(S).arenaEnable=k,size:"small","checked-value":!0,"unchecked-value":!1},null,8,["value","onUpdate:value"])])]),n("div",bo,[n("div",ko,[s[44]||(s[44]=b(" BOSS挑战次数： ",-1)),r(W,{value:q(S).bossTimes,"onUpdate:value":k=>q(S).bossTimes=k,options:i(je),size:"small",class:"task-setting-boss-times"},null,8,["value","onUpdate:value","options"])])])])]),n("div",$o,[s[52]||(s[52]=n("h4",null,"任务设置",-1)),n("div",So,[n("div",Co,[n("div",xo,[s[46]||(s[46]=b(" 领取盐罐： ",-1)),r(D,{value:q(S).claimBottle,"onUpdate:value":k=>q(S).claimBottle=k,size:"small","checked-value":!0,"unchecked-value":!1},null,8,["value","onUpdate:value"])])]),n("div",Mo,[n("div",Po,[s[47]||(s[47]=b(" 付费招募： ",-1)),r(D,{value:q(S).payRecruit,"onUpdate:value":k=>q(S).payRecruit=k,size:"small","checked-value":!0,"unchecked-value":!1},null,8,["value","onUpdate:value"])])]),n("div",Do,[n("div",Eo,[s[48]||(s[48]=b(" 开宝箱： ",-1)),r(D,{value:q(S).openBox,"onUpdate:value":k=>q(S).openBox=k,size:"small","checked-value":!0,"unchecked-value":!1},null,8,["value","onUpdate:value"])])]),n("div",Uo,[n("div",Ro,[s[49]||(s[49]=b(" 领取挂机奖励： ",-1)),r(D,{value:q(S).claimHangUp,"onUpdate:value":k=>q(S).claimHangUp=k,size:"small"},null,8,["value","onUpdate:value"])])]),n("div",zo,[n("div",Bo,[s[50]||(s[50]=b(" 领取邮件奖励： ",-1)),r(D,{value:q(S).claimEmail,"onUpdate:value":k=>q(S).claimEmail=k,size:"small"},null,8,["value","onUpdate:value"])])]),n("div",Ao,[n("div",No,[s[51]||(s[51]=b(" 黑市购买： ",-1)),r(D,{value:q(S).blackMarketPurchase,"onUpdate:value":k=>q(S).blackMarketPurchase=k,size:"small"},null,8,["value","onUpdate:value"])])])])])])]),_:2},1032,["show","onUpdate:show"]))),128))])}}},tl=$s(Oo,[["__scopeId","data-v-63bae3c6"]]);export{tl as default};
