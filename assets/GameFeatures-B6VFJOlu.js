import{k as Ie,c as y,i as m,a as e,y as fe,s as ge,r as G,o as ke,A as Me,I,z as me,f as te,d as u,q as de,t as f,n as se,w as d,j as V,F as pe,g as ye,K as Se,b as ce,u as ne,l as je,L as Ge,G as qe,M as Ve,O as $e,P as Te,p as Qe,T as Je,Q as Ke,R as Ye,e as Xe}from"./index-wKIbGhGo.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{R as Ne}from"./Refresh-B4apZMLB.js";import{C as Re}from"./Copy-B4mkBN3W.js";import{C as ze}from"./ChevronDown-aKTwG0qv.js";import{_ as Ze}from"./xiaoyugan-Dwisk7G8.js";import{S as et}from"./Settings-etHOxbY7.js";import{C as tt}from"./CheckmarkCircle-B0PnRn1P.js";import{E as st,C as nt}from"./EllipseOutline-CphiJv0t.js";import{B as He}from"./index-xPc3ULf4.js";const at={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ot=e("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M112 328l144-144l144 144"},null,-1),lt=[ot],Ue=Ie({name:"ChevronUp",render:function(s,a){return m(),y("svg",at,lt)}}),it={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},rt=e("path",{d:"M424.44 227.25a16 16 0 0 1-12.12-12.39c-7.68-36.68-24.45-68.15-49.18-92A153.57 153.57 0 0 0 256 80c-35.5 0-68.24 11.69-94.68 33.8a156.24 156.24 0 0 0-42 56a16 16 0 0 1-11.37 9.15c-27 5.62-51.07 17.34-69.18 33.87C13.39 235.88 0 267.42 0 304c0 36 14.38 68.88 40.49 92.59C65.64 419.43 99.56 432 136 432h260c32.37 0 60.23-8.57 80.59-24.77C499.76 388.78 512 361.39 512 328c0-57.57-42-90.58-87.56-100.75zm-95.2-8.94l-107.8 128a16 16 0 0 1-12 5.69h-.27a16 16 0 0 1-11.88-5.28l-45.9-50.87c-5.77-6.39-5.82-16.33.3-22.4a16 16 0 0 1 23.16.63l33.9 37.58l96-114a16 16 0 1 1 24.48 20.62z",fill:"currentColor"},null,-1),ct=[rt],ut=Ie({name:"CloudDone",render:function(s,a){return m(),y("svg",it,ct)}}),dt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},mt=e("path",{d:"M428 224H288a48 48 0 0 1-48-48V36a4 4 0 0 0-4-4h-92a64 64 0 0 0-64 64v320a64 64 0 0 0 64 64h224a64 64 0 0 0 64-64V228a4 4 0 0 0-4-4zm-92 160H176a16 16 0 0 1 0-32h160a16 16 0 0 1 0 32zm0-80H176a16 16 0 0 1 0-32h160a16 16 0 0 1 0 32z",fill:"currentColor"},null,-1),vt=e("path",{d:"M419.22 188.59L275.41 44.78a2 2 0 0 0-3.41 1.41V176a16 16 0 0 0 16 16h129.81a2 2 0 0 0 1.41-3.41z",fill:"currentColor"},null,-1),pt=[mt,vt],Ae=Ie({name:"DocumentText",render:function(s,a){return m(),y("svg",dt,pt)}}),ft="/icons/%E7%96%AF%E7%8B%82%E8%B5%9B%E8%BD%A6.png",_t={class:"status-card club-car-king"},gt={class:"card-header"},ht={class:"card-content"},yt={class:"car-toolbar"},kt={key:0,class:"hint"},bt={key:1,class:"hint"},wt={key:2,class:"car-grid"},$t={class:"car-header"},Tt=["src","alt"],Ct={class:"car-name"},St={class:"car-meta"},It={class:"kv"},Mt={class:"v"},xt={key:0,class:"kv"},Dt={class:"v"},Nt={key:1,class:"kv"},At={class:"v"},Wt={class:"kv"},Rt={class:"v"},zt={class:"kv"},Ut={class:"v"},Bt={key:2,class:"kv"},Et={class:"car-actions"},Pt={class:"helper-body"},Ot={class:"helper-row"},Be=4*60*60*1e3,Lt={__name:"ClubCarKing",setup(K){const s=fe(),a=ge(),o=G(!1),l=G(null),_=G(!1),T=G(0),B=G(Date.now());let $=null;ke(()=>{$=setInterval(()=>{B.value=Date.now()},6e4)}),Me(()=>{$&&clearInterval($)});const S=I(()=>new Date(B.value).getHours()>=20),N=I(()=>{const n=new Date(B.value).getDay();return n>=1&&n<=3}),k=I(()=>{const r=s.selectedToken;return r?s.getWebSocketStatus(r.id)==="connected":!1}),z=r=>{const n=r||{},w=n.body||n,x=w.roleCar||w.rolecar||{},O=x.carDataMap||x.cardatamap;if(O&&typeof O=="object")return Object.entries(O).map(([oe,R],re)=>({key:re,id:oe,...R||{}}));let F=w.cars||w.list||w.data||w.carList||w.vehicles||[];return!Array.isArray(F)&&typeof F=="object"&&F!==null&&(F=Object.values(F)),Array.isArray(w)&&F.length===0&&(F=w),(Array.isArray(F)?F:[]).map((oe,R)=>({key:R,...oe}))},g=I(()=>z(l.value)),h=I(()=>(g.value||[]).filter(r=>Number(r.refreshCount??0)===0).length),E=I(()=>h.value>0),q=r=>({1:"绿·普通",2:"蓝·稀有",3:"紫·史诗",4:"橙·传说",5:"红·神话",6:"金·传奇"})[r]||"未知",D=r=>({1:"/icons/大众.svg",2:"/icons/特斯拉.svg",3:"/icons/奥迪.svg",4:"/icons/奔驰.svg",5:"/icons/保时捷.svg",6:"/icons/兰博基尼.svg"})[r]||"/icons/大众.svg",C=r=>{const n=[{type:3,itemId:3201,value:10},{type:3,itemId:1001,value:10},{type:3,itemId:1022,value:2e3},{type:2,itemId:0,value:2e3},{type:3,itemId:1023,value:5},{type:3,itemId:1022,value:2500},{type:3,itemId:1001,value:12}];return Array.isArray(r)?n.some(w=>r.find(x=>x.type===w.type&&x.itemId===w.itemId&&Number(x.value||0)>=w.value)):!1},v=r=>Array.isArray(r)?r.reduce((n,w)=>n+(w.type===3&&w.itemId===35002?Number(w.value||0):0),0):0,b=(r,n)=>{const w=Number((r==null?void 0:r.color)||0),x=Array.isArray(r==null?void 0:r.rewards)?r.rewards:[],O=v(x);return n>=6?w>=5||O>=4||C(x):w>=4||O>=2||C(x)},M=async()=>{var n,w,x;const r=s.selectedToken;if(!r||!k.value){a.warning("请先选择 Token 并建立连接");return}o.value=!0;try{const O=await s.sendMessageWithPromise(r.id,"car_getrolecar",{},1e4);try{const F=await s.sendMessageWithPromise(r.id,"role_getroleinfo",{},1e4),oe=(x=(w=(n=F==null?void 0:F.role)==null?void 0:n.items)==null?void 0:w[35002])==null?void 0:x.quantity;T.value=Number(oe||0)}catch{}l.value=(O==null?void 0:O.body)??O,_.value=!0,z(l.value).length?a.success("疯狂赛车数据已更新"):a.info("未识别到车辆字段，已启用智能解析。如仍为空请提供返回示例")}catch(O){a.error("获取车辆数据失败："+(O.message||"未知错误"))}finally{o.value=!1}};me(k,r=>{r&&!_.value&&M()});const W=async r=>{var w,x,O,F,oe;const n=s.selectedToken;if(!n||!k.value){a.warning("请先选择 Token 并建立连接");return}if(!(r!=null&&r.id)){a.warning("未找到车辆ID");return}if(Number(r.sendAt||0)!==0){a.warning("仅未发车的车辆可刷新品阶");return}try{Number(r.refreshCount??0)!==0&&a.info("将消耗车票进行刷新");const R=await s.sendMessageWithPromise(n.id,"car_refresh",{carId:String(r.id)},1e4),re=(R==null?void 0:R.car)||((w=R==null?void 0:R.body)==null?void 0:w.car)||R;if(re&&typeof re=="object"){if(re.color!=null&&(r.color=Number(re.color)),re.refreshCount!=null){r.refreshCount=Number(re.refreshCount);const De=((x=l.value)==null?void 0:x.body)||l.value||{};De.roleCar&&De.roleCar.refreshCount!=null&&(De.roleCar.refreshCount=Number(re.refreshCount))}const Ce=q(r.color);a.success(`刷新完成：${Ce}`)}else await M(),a.success("品阶刷新完成");try{const Ce=await s.sendMessageWithPromise(n.id,"role_getroleinfo",{},8e3);T.value=Number(((oe=(F=(O=Ce==null?void 0:Ce.role)==null?void 0:O.items)==null?void 0:F[35002])==null?void 0:oe.quantity)||0)}catch{}}catch(R){a.error("刷新失败："+(R.message||"未知错误"))}},U=async r=>{var w;const n=s.selectedToken;if(!n||!k.value){a.warning("请先选择 Token 并建立连接");return}if(Number(r.sendAt||0)!==0){a.info("该车辆已发车");return}if(!N.value){a.warning("非活动时间不可发车（仅周一至周三开放）");return}if(!(r!=null&&r.id)){a.warning("未找到车辆ID");return}if(Number(r.sendAt||0)!==0){a.info("该车辆已发车");return}try{a.info("发车中...");const x=await s.sendMessageWithPromise(n.id,"car_send",{carId:String(r.id),helperId:Number(r.helperId||0),text:"",isUpgrade:!1},1e4),O=(x==null?void 0:x.body)||x,F=(O==null?void 0:O.roleCar)||(O==null?void 0:O.rolecar),oe=(F==null?void 0:F.carDataMap)||(F==null?void 0:F.cardatamap);if(oe&&oe[r.id]){const R=oe[r.id],re=((w=l.value)==null?void 0:w.body)||l.value||{};re.roleCar&&re.roleCar.carDataMap&&re.roleCar.carDataMap[r.id]&&(re.roleCar.carDataMap[r.id]={...re.roleCar.carDataMap[r.id],...R}),R.sendAt!=null&&(r.sendAt=R.sendAt),R.color!=null&&(r.color=R.color),R.refreshCount!=null&&(r.refreshCount=R.refreshCount),a.success("已发车")}else await M(),a.success("已发车")}catch(x){a.error("发车失败："+(x.message||"未知错误"))}},L=r=>{const n=Number((r==null?void 0:r.sendAt)||0);if(!n)return!1;const w=n<1e12?n*1e3:n;return B.value-w>=Be},le=async r=>{var w;const n=s.selectedToken;if(!n||!k.value)return a.warning("请先选择 Token 并建立连接");if(!(r!=null&&r.id))return a.warning("未找到车辆ID");if(!L(r))return a.warning("未到可收车时间（需超过4小时）");try{a.info("收车中...");const x=await s.sendMessageWithPromise(n.id,"car_claim",{carId:String(r.id)},1e4);r.sendAt=0;const O=((w=l.value)==null?void 0:w.body)||l.value||{};O.roleCar&&O.roleCar.carDataMap&&O.roleCar.carDataMap[r.id]&&(O.roleCar.carDataMap[r.id]={...O.roleCar.carDataMap[r.id],sendAt:0}),a.success("收车完成")}catch(x){a.error("收车失败："+(x.message||"未知错误"))}},ie=r=>{const n=Number((r==null?void 0:r.sendAt)||0);return n?(n<1e12?n*1e3:n)+Be-B.value:0},Z=r=>{if(r<=0)return"0分";const n=Math.ceil(r/1e3),w=Math.floor(n/3600),x=Math.floor(n%3600/60);return w>0?`${w}小时${x}分`:`${x}分`},H=r=>Number((r==null?void 0:r.sendAt)||0)!==0?L(r)?"收车":`收车(剩余${Z(ie(r))})`:"发车",ae=r=>Number((r==null?void 0:r.sendAt)||0)!==0?!L(r):S.value||!N.value,Q=async r=>{if(!(Number((r==null?void 0:r.sendAt)||0)!==0))return U(r);if(L(r))return le(r);{const w=Z(ie(r));a.info(`未到可收车时间，剩余 ${w}`)}},P=async()=>{if(!s.selectedToken||!k.value)return a.warning("请先选择 Token 并建立连接");try{const n=(g.value||[]).filter(w=>L(w));for(const w of n){try{await le(w)}catch{}await new Promise(x=>setTimeout(x,300))}await M(),a.success("一键收车完成")}catch(n){a.error("一键收车失败："+(n.message||"未知错误"))}},i=async()=>{if(!s.selectedToken||!k.value)return a.warning("请先选择 Token 并建立连接");try{await M();let n=Number(T.value||0);for(const w of g.value){if(Number(w.sendAt||0)!==0)continue;if(b(w,n)){await U(w),await new Promise(F=>setTimeout(F,500));continue}let x=!1;const O=Number(w.refreshCount??0)===0;if(n>=6)x=!0;else if(O)x=!0;else{await U(w),await new Promise(F=>setTimeout(F,500));continue}for(;x;){if(await W(w),n=Number(T.value||0),b(w,n)){await U(w),await new Promise(oe=>setTimeout(oe,500));break}const F=Number(w.refreshCount??0)===0;if(n>=6)x=!0;else if(F)x=!0;else{await U(w),await new Promise(oe=>setTimeout(oe,500));break}}}await M(),a.success("智能发车完成")}catch(n){a.error("智能发车失败："+(n.message||"未知错误"))}},t=G(!1),p=G(!1),c=G([]),j=G(null),Y=G(null),X=I(()=>{var r;return((r=s.gameData)==null?void 0:r.legionInfo)||null}),ee=I(()=>{var r;return((r=X.value)==null?void 0:r.info)||{}}),A=I(()=>{var r;return((r=ee.value)==null?void 0:r.members)||{}}),J=I(()=>Object.values(A.value||{})),ue=async r=>{var w;const n=s.selectedToken;if(!n||!k.value)return a.warning("请先选择 Token 并建立连接");if(Number(r.color||0)<5)return a.warning("仅品阶≥5的车辆可设置护卫");if(Number(r.sendAt||0)!==0)return a.warning("已发车车辆不可设置护卫");Y.value=r,t.value=!0,p.value=!0,j.value=r.helperId?String(r.helperId):null;try{const x=await s.sendMessageWithPromise(n.id,"car_getmemberhelpingcnt",{},1e4),O=((w=x==null?void 0:x.body)==null?void 0:w.memberHelpingCntMap)||(x==null?void 0:x.memberHelpingCntMap)||{},F=J.value.map(oe=>{const R=String(oe.roleId),re=Number(O[R]??0);return{label:`${oe.name||oe.nickname||R}（已护卫 ${re}/4）`,value:R,disabled:re>=4}});c.value=F}catch(x){a.error("获取护卫数据失败："+(x.message||"未知错误")),c.value=[]}finally{p.value=!1}},ve=()=>{Y.value&&(Y.value.helperId=j.value?String(j.value):null),t.value=!1},_e=()=>{t.value=!1};return(r,n)=>{const w=te("n-button"),x=te("n-tag"),O=te("n-space"),F=te("n-select"),oe=te("n-modal");return m(),y(pe,null,[e("div",_t,[e("div",gt,[n[3]||(n[3]=e("img",{class:"status-icon",src:ft,alt:"疯狂赛车"},null,-1)),n[4]||(n[4]=e("div",{class:"status-info"},[e("h3",null,"疯狂赛车"),e("p",null,"车辆仓库与品阶")],-1)),e("div",{class:de(["status-badge",{active:g.value.length>0}])},[n[2]||(n[2]=e("div",{class:"status-dot"},null,-1)),e("span",null,f(g.value.length>0?`共 ${g.value.length} 辆`:"暂无数据"),1)],2)]),e("div",ht,[e("div",yt,[u(O,{size:"small"},{default:d(()=>[u(w,{type:"primary",size:"small",loading:o.value,onClick:M},{default:d(()=>[V(f(o.value?"加载中...":"刷新数据"),1)]),_:1},8,["loading"]),u(w,{size:"small",secondary:"",disabled:o.value||!k.value,onClick:i},{default:d(()=>[...n[5]||(n[5]=[V("智能发车",-1)])]),_:1},8,["disabled"]),u(w,{size:"small",secondary:"",disabled:o.value||!k.value,onClick:P},{default:d(()=>[...n[6]||(n[6]=[V("一键收车",-1)])]),_:1},8,["disabled"]),u(x,{size:"small",type:E.value?"success":"default"},{default:d(()=>[V(f(E.value?`有 ${h.value} 辆可免费刷新`:"无免费刷新"),1)]),_:1},8,["type"]),u(x,{size:"small",type:"info"},{default:d(()=>[V("剩余车票: "+f(T.value),1)]),_:1})]),_:1})]),k.value?g.value.length===0&&!o.value?(m(),y("div",bt,"暂无车辆数据")):se("",!0):(m(),y("div",kt,"请先选择 Token 并建立连接")),g.value.length>0?(m(),y("div",wt,[(m(!0),y(pe,null,ye(g.value,R=>(m(),y("div",{key:R.key,class:"car-card"},[e("div",$t,[e("img",{class:"car-brand-icon",src:D(R.color),alt:q(R.color)},null,8,Tt),e("div",{class:de(["car-badge","grade-"+(R.color||0)])},f(q(R.color)),3),e("div",Ct,f(R.name||R.carName||"车辆 #"+(R.id||R.key)),1)]),e("div",St,[e("div",It,[n[7]||(n[7]=e("span",{class:"k"},"品阶",-1)),e("span",Mt,[e("span",{class:de(["grade-dot","grade-"+(R.color||0)])},null,2),V(f(q(R.color)),1)])]),R.level!=null?(m(),y("div",xt,[n[8]||(n[8]=e("span",{class:"k"},"等级",-1)),e("span",Dt,f(R.level),1)])):se("",!0),R.star!=null?(m(),y("div",Nt,[n[9]||(n[9]=e("span",{class:"k"},"星级",-1)),e("span",At,f(R.star),1)])):se("",!0),e("div",Wt,[n[10]||(n[10]=e("span",{class:"k"},"状态",-1)),e("span",Rt,f(Number(R.sendAt||0)===0?"未发车":"已发车"),1)]),e("div",zt,[n[11]||(n[11]=e("span",{class:"k"},"帮手",-1)),e("span",Ut,f(Number(R.color||0)>=5?"可携带":"—"),1)]),C(R.rewards)?(m(),y("div",Bt,[...n[12]||(n[12]=[e("span",{class:"k"},"奖励",-1),e("span",{class:"v",style:{color:"#f59e0b"}},"包含大奖",-1)])])):se("",!0)]),e("div",Et,[u(w,{size:"small",type:Number(R.refreshCount??0)===0?"success":"warning",disabled:o.value||Number(R.sendAt||0)!==0,onClick:re=>W(R)},{default:d(()=>[V(f(Number(R.refreshCount??0)===0?"免费刷新品阶":"刷新品阶(需车票)"),1)]),_:2},1032,["type","disabled","onClick"]),u(w,{size:"small",type:"primary",disabled:o.value||ae(R),onClick:re=>Q(R)},{default:d(()=>[V(f(H(R)),1)]),_:2},1032,["disabled","onClick"]),u(w,{size:"small",quaternary:"",disabled:o.value||Number(R.color||0)<5||Number(R.sendAt||0)!==0,onClick:re=>ue(R)},{default:d(()=>[...n[13]||(n[13]=[V(" 护卫 ",-1)])]),_:1},8,["disabled","onClick"])])]))),128))])):se("",!0)])]),u(oe,{show:t.value,"onUpdate:show":n[1]||(n[1]=R=>t.value=R),preset:"card",title:"选择护卫",style:{width:"520px"}},{footer:d(()=>[u(O,null,{default:d(()=>[u(w,{onClick:_e},{default:d(()=>[...n[16]||(n[16]=[V("取消",-1)])]),_:1}),u(w,{type:"primary",onClick:ve},{default:d(()=>[...n[17]||(n[17]=[V("确定",-1)])]),_:1})]),_:1})]),default:d(()=>[e("div",Pt,[e("div",Ot,[n[14]||(n[14]=e("span",{class:"label"},"护卫成员",-1)),u(F,{value:j.value,"onUpdate:value":n[0]||(n[0]=R=>j.value=R),options:c.value,placeholder:"选择俱乐部成员",loading:p.value,filterable:"",style:{width:"320px"}},null,8,["value","options","loading"])]),n[15]||(n[15]=e("div",{class:"tips"},"说明：次数满 4 的成员不可再被选择。",-1))])]),_:1},8,["show"])],64)}}},Ht=he(Lt,[["__scopeId","data-v-86823775"]]),Ft={class:"status-card"},jt={class:"card-header"},Gt={class:"status-icon"},qt={class:"status-title"},Vt={class:"card-content"},xe=Ie({__name:"MyCard",props:{statusClass:{}},setup(K){return(s,a)=>(m(),y("div",Ft,[e("div",jt,[e("div",Gt,[Se(s.$slots,"icon")]),e("div",qt,[Se(s.$slots,"title")]),e("div",{class:de(["status-badge",K.statusClass])},[a[0]||(a[0]=e("div",{class:"status-dot"},null,-1)),Se(s.$slots,"badge")],2),Se(s.$slots,"extra")]),e("div",Vt,[Se(s.$slots,"default")]),e("div",{class:de(["card-action",K.statusClass])},[Se(s.$slots,"action")],2)]))}}),Qt="/icons/1733492491706152.png";function Jt(){const K=new Date,s=K.getDay();let a=0;s===6?a=0:s===0?a=1:a=s+1;const o=new Date(K);o.setDate(K.getDate()-a);const l=o.getFullYear(),_=String(o.getMonth()+1).padStart(2,"0"),T=String(o.getDate()).padStart(2,"0");return`${l}/${_}/${T}`}function Ee(K){const s=new Date(K*1e3),a=String(s.getMonth()+1).padStart(2,"0"),o=String(s.getDate()).padStart(2,"0"),l=String(s.getHours()).padStart(2,"0"),_=String(s.getMinutes()).padStart(2,"0"),T=String(s.getSeconds()).padStart(2,"0");return`${a}-${o} ${l}:${_}:${T}`}function Pe(K){return K===2?"胜利":"失败"}function Oe(K){return K===0?"进攻":"防守"}function Kt(K,s){if(!K||K.length===0)return"暂无战绩数据";const a=[`俱乐部盐场战绩 - ${s}`,`参战人数: ${K.length}`,"─".repeat(40),""],o=[...K].sort((B,$)=>($.winCnt||0)-(B.winCnt||0));let l=0,_=0,T=0;return o.forEach((B,$)=>{const{name:S,winCnt:N,loseCnt:k,buildingCnt:z}=B;l+=N||0,_+=k||0,T+=z||0,a.push(`${$+1}. ${S}  击杀${N||0}  死亡${k||0}  攻城${z||0}`)}),a.push(""),a.push("─".repeat(40)),a.push(`总计  击杀${l}  死亡${_}  攻城${T}`),a.push(""),a.push(`导出时间: ${new Date().toLocaleString("zh-CN")}`),a.join(`
`)}async function Yt(K){if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(K);else{const s=document.createElement("textarea");s.value=K,s.style.position="fixed",s.style.left="-999999px",s.style.top="-999999px",document.body.appendChild(s),s.focus(),s.select();try{document.execCommand("copy")}catch{throw new Error("复制失败")}finally{s.remove()}}}const Xt={key:0,class:"inline-wrapper"},Zt={class:"inline-header"},es={class:"header-actions"},ts={class:"battle-records-content"},ss={key:0,class:"loading-state"},ns={key:1,class:"records-list"},as={class:"records-info"},os={class:"member-header"},ls={class:"member-info"},is=["src","alt"],rs={key:1,class:"member-avatar-placeholder"},cs={class:"member-name"},us={class:"member-stats-inline"},ds={class:"stat-inline win"},ms={class:"stat-inline loss"},vs={class:"stat-inline siege"},ps={class:"battle-details"},fs={key:0,class:"battles-list"},_s={class:"battle-participants"},gs={class:"participant attacker"},hs=["src","alt"],ys={class:"participant-name"},ks={class:"battle-vs"},bs={class:"participant defender"},ws=["src","alt"],$s={class:"participant-name"},Ts={class:"battle-time"},Cs={key:1,class:"no-battles"},Ss={key:2,class:"empty-state"},Is={class:"header-actions"},Ms={class:"battle-records-content"},xs={key:0,class:"loading-state"},Ds={key:1,class:"records-list"},Ns={class:"records-info"},As={class:"member-header"},Ws={class:"member-info"},Rs=["src","alt"],zs={key:1,class:"member-avatar-placeholder"},Us={class:"member-name"},Bs={class:"member-stats-inline"},Es={class:"stat-inline win"},Ps={class:"stat-inline loss"},Os={class:"stat-inline siege"},Ls={class:"battle-details"},Hs={key:0,class:"battles-list"},Fs={class:"battle-participants"},js={class:"participant attacker"},Gs=["src","alt"],qs={class:"participant-name"},Vs={class:"battle-vs"},Qs={class:"participant defender"},Js=["src","alt"],Ks={class:"participant-name"},Ys={class:"battle-time"},Xs={key:1,class:"no-battles"},Zs={key:2,class:"empty-state"},en={__name:"ClubBattleRecords",props:{visible:{type:Boolean,default:!1},inline:{type:Boolean,default:!1}},emits:["update:visible"],setup(K,{expose:s,emit:a}){const o=K,l=a,_=ge(),T=fe(),B=I({get:()=>o.visible,set:v=>l("update:visible",v)}),$=G(!1),S=G(null),N=G(new Set),k=G("");G({isRegistered:!1});const z=v=>{const b=[];return v.newWinFlag===2?b.push("battle-win"):b.push("battle-loss"),v.attackType===0?b.push("battle-attack"):b.push("battle-defend"),b.join(" ")},g=v=>{N.value.has(v)?N.value.delete(v):N.value.add(v)},h=v=>{v.target.style.display="none"},E=async()=>{if(!T.selectedToken){_.warning("请先选择游戏角色");return}const v=T.selectedToken.id;if(T.getWebSocketStatus(v)!=="connected"){_.error("WebSocket未连接，无法查询战绩");return}$.value=!0,k.value=Jt();try{const M=await T.sendMessageWithPromise(v,"legionwar_getdetails",{date:k.value},1e4);M&&M.roleDetailsList?(S.value=M,_.success("战绩加载成功")):(S.value=null,_.warning("未查询到战绩数据"))}catch(M){console.error("查询战绩失败:",M),_.error(`查询失败: ${M.message}`),S.value=null}finally{$.value=!1}},q=()=>{E()},D=async()=>{if(!S.value||!S.value.roleDetailsList){_.warning("没有可导出的数据");return}try{const v=Kt(S.value.roleDetailsList,k.value);await Yt(v),_.success("战绩已复制到剪贴板")}catch(v){console.error("导出失败:",v),_.error("导出失败，请重试")}},C=()=>{N.value.clear()};return s({fetchBattleRecords:E}),ke(()=>{o.inline&&E()}),(v,b)=>{const M=te("n-icon"),W=te("n-button"),U=te("n-spin"),L=te("n-tag"),le=te("n-empty"),ie=te("n-collapse-transition"),Z=te("n-modal");return m(),y("div",null,[K.inline?(m(),y("div",Xt,[e("div",Zt,[b[3]||(b[3]=e("div",{class:"inline-title"},"俱乐部盐场战绩",-1)),e("div",es,[u(W,{size:"small",disabled:$.value,onClick:q},{icon:d(()=>[u(M,null,{default:d(()=>[u(ne(Ne))]),_:1})]),default:d(()=>[b[1]||(b[1]=V(" 刷新 ",-1))]),_:1},8,["disabled"]),u(W,{type:"primary",size:"small",disabled:!S.value||$.value,onClick:D},{icon:d(()=>[u(M,null,{default:d(()=>[u(ne(Re))]),_:1})]),default:d(()=>[b[2]||(b[2]=V(" 导出 ",-1))]),_:1},8,["disabled"])])]),e("div",ts,[$.value?(m(),y("div",ss,[u(U,{size:"large"},{description:d(()=>[...b[4]||(b[4]=[V("正在加载战绩数据...",-1)])]),_:1})])):S.value&&S.value.roleDetailsList?(m(),y("div",ns,[e("div",as,[u(L,{type:"info"},{default:d(()=>[V("查询日期: "+f(k.value),1)]),_:1}),u(L,{type:"success"},{default:d(()=>[V("总成员: "+f(S.value.roleDetailsList.length),1)]),_:1})]),(m(!0),y(pe,null,ye(S.value.roleDetailsList,H=>{var ae;return m(),y("div",{key:H.roleId,class:"member-card"},[e("div",os,[e("div",ls,[H.headImg?(m(),y("img",{key:0,src:H.headImg,alt:H.name,class:"member-avatar",onError:h},null,40,is)):(m(),y("div",rs,f(((ae=H.name)==null?void 0:ae.charAt(0))||"?"),1)),e("span",cs,f(H.name),1)]),e("div",us,[e("span",ds,"击杀 "+f(H.winCnt||0),1),e("span",ms,"死亡 "+f(H.loseCnt||0),1),e("span",vs,"攻城 "+f(H.buildingCnt||0),1)]),u(W,{text:"",size:"small",class:"details-button",onClick:Q=>g(H.roleId)},{icon:d(()=>[u(M,null,{default:d(()=>[N.value.has(H.roleId)?(m(),ce(ne(Ue),{key:1})):(m(),ce(ne(ze),{key:0}))]),_:2},1024)]),_:2},1032,["onClick"])]),u(ie,{show:N.value.has(H.roleId)},{default:d(()=>[e("div",ps,[H.targetRoleList&&H.targetRoleList.length>0?(m(),y("div",fs,[(m(!0),y(pe,null,ye(H.targetRoleList,(Q,P)=>{var i,t,p,c;return m(),y("div",{key:P,class:de(["battle-item",z(Q)])},[e("div",_s,[e("div",gs,[(i=Q.roleInfo)!=null&&i.headImg?(m(),y("img",{key:0,src:Q.roleInfo.headImg,alt:Q.roleInfo.name,class:"participant-avatar",onError:h},null,40,hs)):se("",!0),e("span",ys,f(((t=Q.roleInfo)==null?void 0:t.name)||"未知"),1)]),e("div",ks,[u(L,{type:Q.attackType===0?"warning":"info",size:"small"},{default:d(()=>[V(f(ne(Oe)(Q.attackType)),1)]),_:2},1032,["type"]),u(L,{type:Q.newWinFlag===2?"success":"error",size:"small"},{default:d(()=>[V(f(ne(Pe)(Q.newWinFlag)),1)]),_:2},1032,["type"])]),e("div",bs,[(p=Q.targetRoleInfo)!=null&&p.headImg?(m(),y("img",{key:0,src:Q.targetRoleInfo.headImg,alt:Q.targetRoleInfo.name,class:"participant-avatar",onError:h},null,40,ws)):se("",!0),e("span",$s,f(((c=Q.targetRoleInfo)==null?void 0:c.name)||"未知"),1)])]),e("div",Ts,f(ne(Ee)(Q.timestamp)),1)],2)}),128))])):(m(),y("div",Cs,[u(le,{description:"暂无战斗记录",size:"small"})]))])]),_:2},1032,["show"])])}),128))])):(m(),y("div",Ss,[u(le,{description:"暂无战绩数据",size:"large"},{icon:d(()=>[u(M,null,{default:d(()=>[u(ne(Ae))]),_:1})]),_:1})]))])])):(m(),ce(Z,{key:1,show:B.value,"onUpdate:show":b[0]||(b[0]=H=>B.value=H),preset:"card",title:"俱乐部盐场战绩",style:{width:"90%","max-width":"800px"},onAfterLeave:C},{"header-extra":d(()=>[e("div",Is,[u(W,{size:"small",disabled:$.value,onClick:q},{icon:d(()=>[u(M,null,{default:d(()=>[u(ne(Ne))]),_:1})]),default:d(()=>[b[5]||(b[5]=V(" 刷新 ",-1))]),_:1},8,["disabled"]),u(W,{type:"primary",size:"small",disabled:!S.value||$.value,onClick:D},{icon:d(()=>[u(M,null,{default:d(()=>[u(ne(Re))]),_:1})]),default:d(()=>[b[6]||(b[6]=V(" 导出 ",-1))]),_:1},8,["disabled"])])]),default:d(()=>[e("div",Ms,[$.value?(m(),y("div",xs,[u(U,{size:"large"},{description:d(()=>[...b[7]||(b[7]=[V("正在加载战绩数据...",-1)])]),_:1})])):S.value&&S.value.roleDetailsList?(m(),y("div",Ds,[e("div",Ns,[u(L,{type:"info"},{default:d(()=>[V("查询日期: "+f(k.value),1)]),_:1}),u(L,{type:"success"},{default:d(()=>[V("总成员: "+f(S.value.roleDetailsList.length),1)]),_:1})]),(m(!0),y(pe,null,ye(S.value.roleDetailsList,H=>{var ae;return m(),y("div",{key:H.roleId,class:"member-card"},[e("div",As,[e("div",Ws,[H.headImg?(m(),y("img",{key:0,src:H.headImg,alt:H.name,class:"member-avatar",onError:h},null,40,Rs)):(m(),y("div",zs,f(((ae=H.name)==null?void 0:ae.charAt(0))||"?"),1)),e("span",Us,f(H.name),1)]),e("div",Bs,[e("span",Es,"击杀 "+f(H.winCnt||0),1),e("span",Ps,"死亡 "+f(H.loseCnt||0),1),e("span",Os,"攻城 "+f(H.buildingCnt||0),1)]),u(W,{text:"",size:"small",class:"details-button",onClick:Q=>g(H.roleId)},{icon:d(()=>[u(M,null,{default:d(()=>[N.value.has(H.roleId)?(m(),ce(ne(Ue),{key:1})):(m(),ce(ne(ze),{key:0}))]),_:2},1024)]),_:2},1032,["onClick"])]),u(ie,{show:N.value.has(H.roleId)},{default:d(()=>[e("div",Ls,[H.targetRoleList&&H.targetRoleList.length>0?(m(),y("div",Hs,[(m(!0),y(pe,null,ye(H.targetRoleList,(Q,P)=>{var i,t,p,c;return m(),y("div",{key:P,class:de(["battle-item",z(Q)])},[e("div",Fs,[e("div",js,[(i=Q.roleInfo)!=null&&i.headImg?(m(),y("img",{key:0,src:Q.roleInfo.headImg,alt:Q.roleInfo.name,class:"participant-avatar",onError:h},null,40,Gs)):se("",!0),e("span",qs,f(((t=Q.roleInfo)==null?void 0:t.name)||"未知"),1)]),e("div",Vs,[u(L,{type:Q.attackType===0?"warning":"info",size:"small"},{default:d(()=>[V(f(ne(Oe)(Q.attackType)),1)]),_:2},1032,["type"]),u(L,{type:Q.newWinFlag===2?"success":"error",size:"small"},{default:d(()=>[V(f(ne(Pe)(Q.newWinFlag)),1)]),_:2},1032,["type"])]),e("div",Qs,[(p=Q.targetRoleInfo)!=null&&p.headImg?(m(),y("img",{key:0,src:Q.targetRoleInfo.headImg,alt:Q.targetRoleInfo.name,class:"participant-avatar",onError:h},null,40,Js)):se("",!0),e("span",Ks,f(((c=Q.targetRoleInfo)==null?void 0:c.name)||"未知"),1)])]),e("div",Ys,f(ne(Ee)(Q.timestamp)),1)],2)}),128))])):(m(),y("div",Xs,[u(le,{description:"暂无战斗记录",size:"small"})]))])]),_:2},1032,["show"])])}),128))])):(m(),y("div",Zs,[u(le,{description:"暂无战绩数据",size:"large"},{icon:d(()=>[u(M,null,{default:d(()=>[u(ne(Ae))]),_:1})]),_:1})]))])]),_:1},8,["show"]))])}}},tn=he(en,[["__scopeId","data-v-baffdadd"]]),sn={key:0,class:"empty-club"},nn={class:"actions"},an={key:1},on={class:"toolbar"},ln={class:"overview"},rn={class:"club-header"},cn={class:"meta"},un={class:"name"},dn={class:"sub"},mn={class:"overview-actions"},vn={class:"grid"},pn={class:"item"},fn={class:"value"},_n={class:"item"},gn={class:"value"},hn={class:"item"},yn={class:"value"},kn={class:"item"},bn={class:"value"},wn={key:0,class:"announcement"},$n={class:"text"},Tn={key:1,class:"leader"},Cn={class:"leader-info"},Sn={class:"leader-name"},In={class:"members"},Mn={class:"members-list"},xn={class:"left"},Dn={class:"name"},Nn={class:"right"},An={class:"power"},Wn={class:"tag"},Rn={key:0,class:"hint"},zn={__name:"ClubInfo",setup(K){const s=fe(),a=ge(),o=I(()=>{var D;return((D=s.gameData)==null?void 0:D.legionInfo)||null}),l=I(()=>{var D;return((D=o.value)==null?void 0:D.info)||null}),_=I(()=>{var D;return((D=l.value)==null?void 0:D.members)||{}}),T=I(()=>Object.values(_.value||{})),B=I(()=>T.value.length),$=I(()=>{var C;const D=(C=l.value)==null?void 0:C.leaderId;return D&&T.value.find(v=>Number(v.roleId)===Number(D))||null}),S=I(()=>[...T.value].sort((D,C)=>{var v,b;return Number(C.power||((v=C.custom)==null?void 0:v.s_power)||0)-Number(D.power||((b=D.custom)==null?void 0:b.s_power)||0)}).slice(0,20)),N=G("overview"),k=I(()=>{var b,M,W,U;const D=Number(((U=(W=(M=(b=s.gameData)==null?void 0:b.roleInfo)==null?void 0:M.role)==null?void 0:W.statisticsTime)==null?void 0:U["legion:sign:in"])||0),C=new Date;C.setHours(0,0,0,0);const v=Math.floor(C.getTime()/1e3);return D>v}),z=()=>{const D=s.selectedToken;!D||k.value||(s.sendMessage(D.id,"legion_signin"),s.sendMessage(D.id,"role_getroleinfo"),a.info("俱乐部签到"))},g=I(()=>{const D=o.value||{},C=D.info||{},v=D.statistics||D.stat||{},b=Number(C.power??D.power??C.s_power??D.s_power??0),M=C.dan??D.dan??C.rank??D.rank??"-",W=Number(C.redQuenchCnt??D.redQuenchCnt??v["red:quench"]??v.red_quench??0),U=v["last:war:rank"]??v.lastWarRank??v["legion:last:war:rank"]??"-",L=!!(C.noApply??D.noApply);return{power:b,dan:M??"-",redQuench:W,lastWarRank:U,noApply:L}}),h=()=>{const D=s.selectedToken;D&&s.sendMessage(D.id,"legion_getinfo")},E=D=>D===1?"会长":D===2?"副会长":"成员",q=D=>{const C=Number(D||0);return C>=1e8?(C/1e8).toFixed(2)+"亿":C>=1e4?(C/1e4).toFixed(2)+"万":String(C)};return(D,C)=>{const v=te("n-empty"),b=te("n-button"),M=te("n-space"),W=te("n-avatar"),U=te("n-tab-pane"),L=te("n-tabs"),le=xe;return m(),ce(le,{class:"club-info",statusClass:{active:!!l.value}},{icon:d(()=>[...C[1]||(C[1]=[e("img",{src:Qt,alt:"俱乐部图标"},null,-1)])]),title:d(()=>[...C[2]||(C[2]=[e("h3",null,"俱乐部信息",-1),e("p",null,"军团/俱乐部概览与成员",-1)])]),badge:d(()=>[e("span",null,f(l.value?"已加入":"暂无俱乐部"),1)]),default:d(()=>[l.value?(m(),y("div",an,[e("div",on,[u(M,{size:"small"},{default:d(()=>[u(b,{size:"small",onClick:h},{default:d(()=>[...C[4]||(C[4]=[V("刷新",-1)])]),_:1})]),_:1})]),u(L,{value:N.value,"onUpdate:value":C[0]||(C[0]=ie=>N.value=ie),type:"line",animated:""},{default:d(()=>[u(U,{name:"overview",tab:"概览","display-directive":"show:lazy"},{default:d(()=>[e("div",ln,[e("div",rn,[u(W,{size:48,src:l.value.logo||"/icons/xiaoyugan.png"},null,8,["src"]),e("div",cn,[e("div",un,f(l.value.name),1),e("div",dn,"ID "+f(l.value.id)+" · Lv."+f(l.value.level)+" · 服务器 "+f(l.value.serverId),1)])]),e("div",mn,[u(M,{size:"small"},{default:d(()=>[u(b,{size:"small",disabled:k.value,type:"primary",onClick:z},{default:d(()=>[V(f(k.value?"已签到":"俱乐部签到"),1)]),_:1},8,["disabled"])]),_:1})]),e("div",vn,[e("div",pn,[C[5]||(C[5]=e("div",{class:"label"},"战力",-1)),e("div",fn,f(q(g.value.power)),1)]),e("div",_n,[C[6]||(C[6]=e("div",{class:"label"},"段位",-1)),e("div",gn,f(g.value.dan),1)]),e("div",hn,[C[7]||(C[7]=e("div",{class:"label"},"成员数",-1)),e("div",yn,f(B.value),1)]),e("div",kn,[C[8]||(C[8]=e("div",{class:"label"},"红洗次数",-1)),e("div",bn,f(g.value.redQuench),1)])]),l.value.announcement?(m(),y("div",wn,[C[9]||(C[9]=e("div",{class:"label"},"公告",-1)),e("div",$n,f(l.value.announcement),1)])):se("",!0),$.value?(m(),y("div",Tn,[C[10]||(C[10]=e("div",{class:"label"},"会长",-1)),e("div",Cn,[u(W,{size:32,src:$.value.headImg||"/icons/xiaoyugan.png"},null,8,["src"]),e("span",Sn,f($.value.name),1)])])):se("",!0)])]),_:1}),u(U,{name:"members",tab:"成员","display-directive":"show:lazy"},{default:d(()=>[e("div",In,[e("div",Mn,[(m(!0),y(pe,null,ye(S.value,ie=>{var Z;return m(),y("div",{key:ie.roleId,class:"member-row"},[e("div",xn,[u(W,{size:28,src:ie.headImg||"/icons/xiaoyugan.png"},null,8,["src"]),e("span",Dn,f(ie.name),1)]),e("div",Nn,[e("span",An,f(q(ie.power||((Z=ie.custom)==null?void 0:Z.s_power)||0)),1),e("span",Wn,f(E(ie.job)),1)])])}),128))]),B.value>S.value.length?(m(),y("div",Rn,"仅显示前 "+f(S.value.length)+" 名(按战力)",1)):se("",!0)])]),_:1}),u(U,{name:"records",tab:"盐场战绩","display-directive":"show:lazy"},{default:d(()=>[u(tn,{inline:""})]),_:1})]),_:1},8,["value"])])):(m(),y("div",sn,[u(v,{description:"暂无俱乐部"}),e("div",nn,[u(b,{size:"small",onClick:h},{default:d(()=>[...C[3]||(C[3]=[V("刷新",-1)])]),_:1})])]))]),_:1},8,["statusClass"])}}},Un=he(zn,[["__scopeId","data-v-4cb31180"]]),Bn="/icons/1733492491706148.png",En={class:"status-card tower-status"},Pn={class:"card-header"},On={class:"energy-display"},Ln={class:"energy-count"},Hn={class:"card-content"},Fn={class:"tower-floor"},jn={class:"floor-number"},Gn={class:"card-actions"},qn=["disabled"],Vn={__name:"TowerStatus",setup(K){const s=fe(),a=ge(),o=G(!1),l=G(null);G(null);const _=I(()=>{var h;return((h=s.gameData)==null?void 0:h.roleInfo)||null}),T=I(()=>{var D,C;const g=(C=(D=_.value)==null?void 0:D.role)==null?void 0:C.tower;if(!g||!g.id&&g.id!==0)return"0 - 0";const h=g.id,E=Math.floor(h/10)+1,q=h%10+1;return`${E} - ${q}`}),B=I(()=>{var E,q;const g=(q=(E=_.value)==null?void 0:E.role)==null?void 0:q.tower;return(g==null?void 0:g.energy)||0}),$=I(()=>{const g=B.value>0,h=!o.value;return g&&h}),S=async()=>{if(!s.selectedToken){a.warning("请先选择Token");return}if(!$.value){a.warning("体力不足或正在爬塔中");return}l.value&&(clearTimeout(l.value),l.value=null),o.value=!0,l.value=setTimeout(()=>{o.value=!1,l.value=null},15e3);try{const g=s.selectedToken.id;await s.sendMessageWithPromise(g,"fight_starttower",{},1e4),a.success("爬塔命令已发送"),await k(),setTimeout(async()=>{await k(),l.value&&(clearTimeout(l.value),l.value=null),o.value=!1},2e3)}catch(g){a.error("爬塔失败: "+(g.message||"未知错误")),l.value&&(clearTimeout(l.value),l.value=null),o.value=!1}},N=()=>{l.value&&(clearTimeout(l.value),l.value=null),o.value=!1,a.info("爬塔状态已重置")},k=async()=>{if(s.selectedToken)try{const g=s.selectedToken.id;if(s.getWebSocketStatus(g)!=="connected")return;const E=s.sendMessage(g,"role_getroleinfo"),q=s.sendMessage(g,"tower_getinfo")}catch{}},z=I(()=>s.selectedToken?s.getWebSocketStatus(s.selectedToken.id):"disconnected");return me(z,(g,h)=>{g==="connected"&&h!=="connected"&&setTimeout(()=>{k()},1e3)}),me(()=>s.selectedToken,(g,h)=>{g&&g.id!==(h==null?void 0:h.id)&&s.getWebSocketStatus(g.id)==="connected"&&k()}),me(()=>s.gameData.towerResult,(g,h)=>{g&&g.timestamp!==(h==null?void 0:h.timestamp)&&(g.success?(a.success("咸将塔挑战成功！"),g.autoReward&&setTimeout(()=>{a.success(`自动领取第${g.rewardFloor}层奖励`)},1e3)):a.error("咸将塔挑战失败"),setTimeout(()=>{l.value&&(clearTimeout(l.value),l.value=null),o.value=!1},2e3))},{deep:!0}),ke(()=>{s.selectedToken&&s.getWebSocketClient(s.selectedToken.id),s.selectedToken&&z.value==="connected"&&k()}),(g,h)=>(m(),y("div",En,[e("div",Pn,[h[1]||(h[1]=e("img",{src:Bn,alt:"爬塔图标",class:"status-icon"},null,-1)),h[2]||(h[2]=e("div",{class:"status-info"},[e("h3",null,"咸将塔"),e("p",null,"一个不小心就过了")],-1)),e("div",On,[h[0]||(h[0]=e("img",{src:Ze,alt:"小鱼干",class:"energy-icon"},null,-1)),e("span",Ln,f(B.value),1)])]),e("div",Hn,[e("div",Fn,[h[3]||(h[3]=e("span",{class:"label"},"当前层数",-1)),e("span",jn,f(T.value),1)])]),e("div",Gn,[e("button",{class:de(["climb-button",{active:$.value,disabled:!$.value}]),disabled:!$.value,onClick:S},f(o.value.value?"爬塔中...":"开始爬塔"),11,qn),o.value.value?(m(),y("button",{key:0,class:"reset-button",onClick:N}," 重置状态 ")):se("",!0)])]))}},Qn=he(Vn,[["__scopeId","data-v-1b77bcb2"]]),Jn="/icons/174023274867420.png",Kn={class:"status-card daily-task"},Yn={class:"card-header"},Xn={class:"header-right"},Zn={class:"card-content"},ea={class:"progress-container"},ta={class:"card-actions"},sa=["disabled"],na={key:0,class:"loading-text"},aa={key:1},oa={key:2},la={class:"modal-header"},ia={class:"settings-content"},ra={class:"settings-grid"},ca={class:"setting-item"},ua={class:"setting-item"},da={class:"setting-item"},ma={class:"setting-switches"},va={class:"switch-row"},pa={class:"switch-row"},fa={class:"switch-row"},_a={class:"switch-row"},ga={class:"switch-row"},ha={class:"switch-row"},ya={class:"switch-row"},ka={class:"modal-header"},ba=["disabled"],wa={class:"task-list"},$a={class:"task-item-left"},Ta={class:"task-name"},Ca={class:"modal-header"},Sa={class:"log-time"},Le=500,Ia={__name:"DailyTaskStatus",setup(K){const s=fe(),a=ge(),o=G(!1),l=G(!1),_=G(!1),T=G(!1),B=G(null),$=je({arenaFormation:1,bossFormation:1,bossTimes:2,claimBottle:!0,payRecruit:!0,openBox:!0,arenaEnable:!0,claimHangUp:!0,claimEmail:!0,blackMarketPurchase:!0}),S=G([{id:1,name:"登录一次游戏",completed:!1,loading:!1},{id:2,name:"分享一次游戏",completed:!1,loading:!1},{id:3,name:"赠送好友3次金币",completed:!1,loading:!1},{id:4,name:"进行2次招募",completed:!1,loading:!1},{id:5,name:"领取5次挂机奖励",completed:!1,loading:!1},{id:6,name:"进行3次点金",completed:!1,loading:!1},{id:7,name:"开启3次宝箱",completed:!1,loading:!1},{id:12,name:"黑市购买1次物品（请设置采购清单）",completed:!1,loading:!1},{id:13,name:"进行1场竞技场战斗",completed:!1,loading:!1},{id:14,name:"收获1个任意盐罐",completed:!1,loading:!1}]),N=[1,2,3,4].map(i=>({label:`阵容${i}`,value:i})),k=[0,1,2,3,4].map(i=>({label:`${i}次`,value:i})),z=I(()=>s.selectedTokenRoleInfo),g=I(()=>{var i,t,p;return((p=(t=(i=z.value)==null?void 0:i.role)==null?void 0:t.dailyTask)==null?void 0:p.dailyPoint)??0}),h=I(()=>Math.min(g.value,100)),E=I(()=>h.value>=100),q=I(()=>E.value?"#10b981":"#3b82f6"),D=I(()=>s.selectedToken?s.getWebSocketStatus(s.selectedToken.id)==="connected":!1),C=G([]),v=(i,t="info")=>{const p=new Date().toLocaleTimeString();C.value.push({time:p,message:i,type:t}),C.value.length>Le&&C.value.splice(0,C.value.length-Le),qe(()=>{B.value&&(B.value.scrollTop=B.value.scrollHeight)})},b=i=>{var Y,X;if(!((X=(Y=i==null?void 0:i.role)==null?void 0:Y.dailyTask)!=null&&X.complete)){v("角色信息中无任务完成数据","warning");return}const t=i.role.dailyTask.complete,p=ee=>ee===-1;v("开始同步任务完成状态..."),v(`服务器返回的任务完成数据: ${JSON.stringify(t)}`);let c=0,j=0;S.value.forEach(ee=>{ee.completed=!1}),Object.keys(t).forEach(ee=>{const A=Number(ee),J=S.value.findIndex(ue=>ue.id===A);if(J>=0){const ue=p(t[ee]);S.value[J].completed=ue,c++,ue&&j++,v(`任务${A} "${S.value[J].name}": ${ue?"已完成":"未完成"}`,ue?"success":"info")}else v(`服务器返回未知任务ID: ${A} (完成值: ${t[ee]})`,"warning")}),v(`任务状态同步完成: ${j}/${c} 已完成`),v(`当前进度: ${g.value}/100`)},M=async()=>{if(!s.selectedToken)throw new Error("没有选中的Token");const i=s.selectedToken.id;v("正在获取角色信息...");try{const t=await s.sendGetRoleInfo(i);return v("角色信息获取成功","success"),t&&b(t),t}catch(t){throw v(`获取角色信息失败: ${t.message}`,"error"),t}},W=async(i,t,p={},c="",j=8e3)=>{try{c&&v(`执行: ${c}`);const Y=await s.sendMessageWithPromise(i,t,p,j);return await new Promise(X=>setTimeout(X,500)),c&&v(`${c} - 成功`,"success"),Y}catch(Y){throw c&&v(`${c} - 失败: ${Y.message}`,"error"),Y}},U=i=>{if(!i)return!0;const t=new Date().toDateString(),p=new Date(i).toDateString();return t!==p},L=()=>{const i=[9904,9905,9901,9902,9903,9904,9905],t=new Date().getDay();return i[t]},le=async(i,t,p,c)=>{var j,Y,X;try{const ee=(Y=(j=s.gameData)==null?void 0:j.presetTeam)==null?void 0:Y.presetTeamInfo;let A=ee==null?void 0:ee.useTeamId;if(A)c(`从缓存获取当前阵容: ${A}`);else{c("缓存中无阵容信息，从服务器获取...");const J=await W(i,"presetteam_getinfo",{},"获取阵容信息");A=(X=J==null?void 0:J.presetTeamInfo)==null?void 0:X.useTeamId,c(`从服务器获取当前阵容: ${A}`)}return A===t?(c(`当前已是${p}${t}，无需切换`,"success"),!1):(c(`当前阵容: ${A}, 目标阵容: ${t}，开始切换...`),await W(i,"presetteam_saveteam",{teamId:t},`切换到${p}${t}`),c(`成功切换到${p}${t}`,"success"),!0)}catch(ee){c(`阵容检查失败，直接切换: ${ee.message}`,"warning");try{return await W(i,"presetteam_saveteam",{teamId:t},`强制切换到${p}${t}`),!0}catch(A){throw c(`强制切换也失败: ${A.message}`,"error"),A}}},ie=async(i,t,p)=>{var r;const c=s.selectedToken.id,j=i==null?void 0:i.role;if(!j)throw new Error("角色数据不存在");t("开始执行每日任务补差");const Y=((r=j.dailyTask)==null?void 0:r.complete)??{},X=n=>Y[n]===-1,ee=j.statistics??{},A=j.statisticsTime??{},J=[];if(X(2)||J.push({name:"分享一次游戏",execute:()=>W(c,"system_mysharecallback",{isSkipShareCard:!0,type:2},"分享游戏")}),X(3)||J.push({name:"赠送好友金币",execute:()=>W(c,"friend_batch",{},"赠送好友金币")}),X(4)||(J.push({name:"免费招募",execute:()=>W(c,"hero_recruit",{recruitType:3,recruitNumber:1},"免费招募")}),$.payRecruit&&J.push({name:"付费招募",execute:()=>W(c,"hero_recruit",{recruitType:1,recruitNumber:1},"付费招募")})),!X(6)&&U(A["buy:gold"]))for(let n=0;n<3;n++)J.push({name:`免费点金 ${n+1}/3`,execute:()=>W(c,"system_buygold",{buyNum:1},`免费点金 ${n+1}`)});if(!X(5)&&$.claimHangUp){for(let n=0;n<4;n++)J.push({name:`挂机加钟 ${n+1}/4`,execute:()=>W(c,"system_mysharecallback",{isSkipShareCard:!0,type:2},`挂机加钟 ${n+1}`)});J.push({name:"领取挂机奖励",execute:()=>W(c,"system_claimhangupreward",{},"领取挂机奖励")}),J.push({name:"挂机加钟 5/5",execute:()=>W(c,"system_mysharecallback",{isSkipShareCard:!0,type:2},"挂机加钟 5")})}if(!X(7)&&$.openBox&&J.push({name:"开启木质宝箱",execute:()=>W(c,"item_openbox",{itemId:2001,number:10},"开启木质宝箱10个")}),!X(14)&&$.claimBottle&&J.push({name:"领取盐罐奖励",execute:()=>W(c,"bottlehelper_claim",{},"领取盐罐奖励")}),!X(13)&&$.arenaEnable&&J.push({name:"竞技场战斗",execute:async()=>{var n,w;if(t("开始竞技场战斗流程"),new Date().getHours()<8){t("当前时间未到8点，跳过竞技场战斗","warning");return}if(new Date().getHours()>22){t("当前时间已过22点，跳过竞技场战斗","warning");return}await le(c,$.arenaFormation,"竞技场阵容",t),await W(c,"arena_startarea",{},"开始竞技场");for(let x=1;x<=3;x++){t(`竞技场战斗 ${x}/3`);const O=await W(c,"arena_getareatarget",{refresh:!1},`获取竞技场目标${x}`),F=(w=(n=O==null?void 0:O.roleList)==null?void 0:n[0])==null?void 0:w.roleId;F?await W(c,"fight_startareaarena",{targetId:F},`竞技场战斗${x}`,1e4):t(`竞技场战斗${x} - 未找到目标`,"warning"),await new Promise(oe=>setTimeout(oe,1e3))}}}),$.bossTimes>0){const n=ee["legion:boss"]??0,w=Math.max($.bossTimes-n,0);if(w>0){J.push({name:"军团BOSS阵容检查",execute:()=>le(c,$.bossFormation,"BOSS阵容",t)});for(let O=0;O<w;O++)J.push({name:`军团BOSS ${O+1}/${w}`,execute:()=>W(c,"fight_startlegionboss",{},`军团BOSS ${O+1}`,12e3)})}const x=L();w===0&&J.push({name:"每日BOSS阵容检查",execute:()=>le(c,$.bossFormation,"BOSS阵容",t)});for(let O=0;O<3;O++)J.push({name:`每日BOSS ${O+1}/3`,execute:()=>W(c,"fight_startboss",{bossId:x},`每日BOSS ${O+1}`,12e3)})}const ue=[{name:"福利签到",cmd:"system_signinreward"},{name:"俱乐部",cmd:"legion_signin"},{name:"领取每日礼包",cmd:"discount_claimreward"},{name:"领取每日免费奖励",cmd:"collection_claimfreereward"},{name:"领取免费礼包",cmd:"card_claimreward"},{name:"领取永久卡礼包",cmd:"card_claimreward",params:{cardId:4003}}];if($.claimEmail&&ue.push({name:"领取邮件奖励",cmd:"mail_claimallattachment"}),ue.forEach(n=>{J.push({name:n.name,execute:()=>W(c,n.cmd,n.params||{},n.name)})}),U(A["artifact:normal:lottery:time"]))for(let n=0;n<3;n++)J.push({name:`免费钓鱼 ${n+1}/3`,execute:()=>W(c,"artifact_lottery",{lotteryNumber:1,newFree:!0,type:1},`免费钓鱼 ${n+1}`)});const ve=["魏国","蜀国","吴国","群雄"];for(let n=1;n<=4;n++)U(A[`genie:daily:free:${n}`])&&J.push({name:`${ve[n-1]}灯神免费扫荡`,execute:()=>W(c,"genie_sweep",{genieId:n},`${ve[n-1]}灯神免费扫荡`)});for(let n=0;n<3;n++)J.push({name:`领取免费扫荡卷 ${n+1}/3`,execute:()=>W(c,"genie_buysweep",{},`领取免费扫荡卷 ${n+1}`)});!X(12)&&$.blackMarketPurchase&&J.push({name:"黑市购买1次物品",execute:()=>W(c,"store_purchase",{goodsId:1},"黑市购买1次物品")});for(let n=1;n<=10;n++)J.push({name:`领取任务奖励${n}`,execute:()=>W(c,"task_claimdailypoint",{taskId:n},`领取任务奖励${n}`,5e3)});J.push({name:"领取日常任务奖励",execute:()=>W(c,"task_claimdailyreward",{},"领取日常任务奖励")},{name:"领取周常任务奖励",execute:()=>W(c,"task_claimweekreward",{},"领取周常任务奖励")});const _e=J.length;t(`共有 ${_e} 个任务待执行`);for(let n=0;n<J.length;n++){const w=J[n];try{await w.execute();const x=Math.floor((n+1)/_e*100);p&&p(c,x),await new Promise(O=>setTimeout(O,500))}catch(x){t(`任务执行失败: ${w.name} - ${x.message}`,"error")}}p&&p(c,100),t("所有任务执行完成","success"),await new Promise(n=>setTimeout(n,2e3)),await M()},Z=async()=>{var i;if(!s.selectedToken||T.value){a.warning("没有选中Token或正在执行中");return}if(!D.value){a.error("WebSocket连接未建立，请检查连接状态");return}T.value=!0,_.value=!0,C.value=[];try{v("=== 开始执行一键补差任务 ===");const t=await M();if(!(t!=null&&t.role))throw new Error("获取角色信息失败或数据异常");v(`当前每日任务进度: ${((i=t.role.dailyTask)==null?void 0:i.dailyPoint)||0}/100`),v("第二步: 开始执行每日任务..."),await ie(t,v,(p,c)=>{v(`任务进度: ${c}%`)}),v("=== 任务执行完成 ===","success"),a.success("每日任务补差执行完成"),setTimeout(async()=>{try{await M(),v("最终角色信息刷新完成","success")}catch(p){v(`最终刷新失败: ${p.message}`,"warning")}},3e3)}catch(t){v(`任务执行失败: ${t.message}`,"error"),console.error("详细错误信息:",t),a.error(`任务执行失败: ${t.message}`)}finally{T.value=!1}},H=async()=>{if(!D.value){a.warning("WebSocket未连接，无法刷新任务状态");return}try{v("手动刷新任务状态..."),await M(),a.success("任务状态刷新成功")}catch(i){v(`刷新失败: ${i.message}`,"error"),a.error(`刷新失败: ${i.message}`)}},ae=()=>s.selectedToken?{roleId:s.selectedToken.id}:null,Q=i=>{try{const t=localStorage.getItem(`daily-settings:${i}`);return t?JSON.parse(t):null}catch(t){return console.error("Failed to load settings:",t),null}},P=(i,t)=>{try{localStorage.setItem(`daily-settings:${i}`,JSON.stringify(t))}catch(p){console.error("Failed to save settings:",p)}};return me($,i=>{const t=ae();t&&P(t.roleId,i)},{deep:!0}),me(()=>s.selectedToken,async(i,t)=>{if(i&&i!==t){v(`切换到Token: ${i.name}`);const p=Q(i.id);if(p&&Object.assign($,p),D.value)try{await M()}catch(c){console.warn("切换token后获取角色信息失败:",c.message)}}},{immediate:!0}),me(()=>s.selectedTokenRoleInfo,i=>{var t,p;(p=(t=i==null?void 0:i.role)==null?void 0:t.dailyTask)!=null&&p.complete&&(v("角色信息更新，同步任务状态"),b(i))},{immediate:!0,deep:!0}),ke(async()=>{if(v("组件初始化完成"),s.selectedToken&&D.value)try{await M()}catch(t){console.warn("初始化时获取角色信息失败:",t.message)}const i=ae();if(i){const t=Q(i.roleId);t&&Object.assign($,t)}}),Ge(()=>{v("组件即将卸载")}),(i,t)=>{const p=te("n-progress"),c=te("n-icon"),j=te("n-select"),Y=te("n-switch"),X=te("n-modal"),ee=te("n-tag");return m(),y("div",Kn,[e("div",Yn,[t[17]||(t[17]=e("img",{src:Jn,alt:"每日任务",class:"status-icon"},null,-1)),t[18]||(t[18]=e("div",{class:"status-info"},[e("h3",null,"每日任务"),e("p",null,"当前进度")],-1)),e("div",Xn,[e("div",{class:de(["status-badge",{completed:E.value}]),onClick:t[0]||(t[0]=A=>l.value=!0)},[e("div",{class:de(["status-dot",{completed:E.value}])},null,2),t[15]||(t[15]=e("span",null,"任务详情",-1))],2),e("button",{class:"settings-gear",onClick:t[1]||(t[1]=A=>o.value=!0),title:"任务设置"},[...t[16]||(t[16]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("path",{d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.240.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z"}),e("path",{d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1)])])])]),e("div",Zn,[e("div",ea,[u(p,{type:"line",percentage:h.value,height:8,"border-radius":4,color:q.value,"rail-color":"#f3f4f6"},null,8,["percentage","color"])]),t[19]||(t[19]=e("div",{class:"info-container"}," 右上角小齿轮有惊喜 ",-1))]),e("div",ta,[e("button",{class:"action-button",disabled:T.value||!D.value,onClick:Z},[T.value?(m(),y("span",na,[...t[20]||(t[20]=[e("svg",{class:"loading-icon",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M12 22c5.421 0 10-4.579 10-10h-2c0 4.337-3.663 8-8 8s-8-3.663-8-8c0-4.336 3.663-8 8-8V2C6.579 2 2 6.58 2 12c0 5.421 4.579 10 10 10z"})],-1),V(" 执行中... ",-1)])])):D.value?(m(),y("span",oa,"一键补差")):(m(),y("span",aa,"WebSocket未连接"))],8,sa)]),u(X,{show:o.value,"onUpdate:show":t[12]||(t[12]=A=>o.value=A),preset:"card",title:"任务设置",style:{width:"400px"}},{header:d(()=>[e("div",la,[u(c,null,{default:d(()=>[u(ne(et))]),_:1}),t[21]||(t[21]=e("span",null,"任务设置",-1))])]),default:d(()=>[e("div",ia,[e("div",ra,[e("div",ca,[t[22]||(t[22]=e("label",{class:"setting-label"},"竞技场阵容",-1)),u(j,{value:$.arenaFormation,"onUpdate:value":t[2]||(t[2]=A=>$.arenaFormation=A),options:ne(N),size:"small"},null,8,["value","options"])]),e("div",ua,[t[23]||(t[23]=e("label",{class:"setting-label"},"BOSS阵容",-1)),u(j,{value:$.bossFormation,"onUpdate:value":t[3]||(t[3]=A=>$.bossFormation=A),options:ne(N),size:"small"},null,8,["value","options"])]),e("div",da,[t[24]||(t[24]=e("label",{class:"setting-label"},"BOSS次数",-1)),u(j,{value:$.bossTimes,"onUpdate:value":t[4]||(t[4]=A=>$.bossTimes=A),options:ne(k),size:"small"},null,8,["value","options"])]),e("div",ma,[e("div",va,[t[25]||(t[25]=e("span",{class:"switch-label"},"领罐子",-1)),u(Y,{value:$.claimBottle,"onUpdate:value":t[5]||(t[5]=A=>$.claimBottle=A)},null,8,["value"])]),e("div",pa,[t[26]||(t[26]=e("span",{class:"switch-label"},"领挂机",-1)),u(Y,{value:$.claimHangUp,"onUpdate:value":t[6]||(t[6]=A=>$.claimHangUp=A)},null,8,["value"])]),e("div",fa,[t[27]||(t[27]=e("span",{class:"switch-label"},"竞技场",-1)),u(Y,{value:$.arenaEnable,"onUpdate:value":t[7]||(t[7]=A=>$.arenaEnable=A)},null,8,["value"])]),e("div",_a,[t[28]||(t[28]=e("span",{class:"switch-label"},"开宝箱",-1)),u(Y,{value:$.openBox,"onUpdate:value":t[8]||(t[8]=A=>$.openBox=A)},null,8,["value"])]),e("div",ga,[t[29]||(t[29]=e("span",{class:"switch-label"},"领取邮件奖励",-1)),u(Y,{value:$.claimEmail,"onUpdate:value":t[9]||(t[9]=A=>$.claimEmail=A)},null,8,["value"])]),e("div",ha,[t[30]||(t[30]=e("span",{class:"switch-label"},"黑市购买物品",-1)),u(Y,{value:$.blackMarketPurchase,"onUpdate:value":t[10]||(t[10]=A=>$.blackMarketPurchase=A)},null,8,["value"])]),e("div",ya,[t[31]||(t[31]=e("span",{class:"switch-label"},"付费招募",-1)),u(Y,{value:$.payRecruit,"onUpdate:value":t[11]||(t[11]=A=>$.payRecruit=A)},null,8,["value"])])])])])]),_:1},8,["show"]),u(X,{show:l.value,"onUpdate:show":t[13]||(t[13]=A=>l.value=A),preset:"card",title:"每日任务详情",style:{width:"400px"}},{header:d(()=>[e("div",ka,[u(c,null,{default:d(()=>[u(ne(nt))]),_:1}),t[33]||(t[33]=e("span",null,"每日任务详情",-1)),e("button",{class:"refresh-button",disabled:T.value,onClick:H},[u(c,null,{default:d(()=>[u(ne(Ne))]),_:1}),t[32]||(t[32]=V(" 刷新状态 ",-1))],8,ba)])]),default:d(()=>[e("div",wa,[(m(!0),y(pe,null,ye(S.value,A=>(m(),y("div",{key:A.id,class:"task-item"},[e("div",$a,[u(c,{class:de(["task-status-icon",{completed:A.completed}])},{default:d(()=>[A.completed?(m(),ce(ne(tt),{key:0})):(m(),ce(ne(st),{key:1}))]),_:2},1032,["class"]),e("span",Ta,f(A.name),1)]),u(ee,{type:A.completed?"success":"default",size:"small"},{default:d(()=>[V(f(A.completed?"已完成":"未完成"),1)]),_:2},1032,["type"])]))),128))])]),_:1},8,["show"]),u(X,{show:_.value,"onUpdate:show":t[14]||(t[14]=A=>_.value=A),preset:"card",title:"任务执行日志",style:{width:"500px"}},{header:d(()=>[e("div",Ca,[u(c,null,{default:d(()=>[u(ne(Ae))]),_:1}),t[34]||(t[34]=e("span",null,"任务执行日志",-1))])]),default:d(()=>[e("div",{ref_key:"logContainer",ref:B,class:"log-container"},[(m(!0),y(pe,null,ye(C.value,A=>(m(),y("div",{key:A.time+A.message,class:"log-item"},[e("span",Sa,f(A.time),1),e("span",{class:de(["log-message",{error:A.type==="error",success:A.type==="success",warning:A.type==="warning"}])},f(A.message),3)]))),128))],512)]),_:1},8,["show"])])}}},Ma=he(Ia,[["__scopeId","data-v-a3bc125f"]]),We="/icons/Ob7pyorzmHiJcbab2c25af264d0758b527bc1b61cc3b.png",xa={class:"status-card team-formation-card"},Da={class:"card-header"},Na={class:"team-selector"},Aa=["disabled","onClick"],Wa=["disabled"],Ra={class:"card-content"},za={class:"current-team-info"},Ua={class:"team-number"},Ba={class:"heroes-container"},Ea={key:0,class:"heroes-inline"},Pa={class:"hero-circle"},Oa=["src","alt"],La={key:1,class:"hero-placeholder"},Ha={class:"hero-name"},Fa={key:1,class:"empty-team"},ja={key:2,class:"empty-team"},Ga=Ie({__name:"TeamFormation",setup(K){const s=fe(),a=ge(),o=G(!1),l=G(!1),_=G(1),T=G([1,2,3,4]),B={101:{name:"司马懿",type:"魏国"},102:{name:"郭嘉",type:"魏国"},103:{name:"关羽",type:"蜀国"},104:{name:"诸葛亮",type:"蜀国"},105:{name:"周瑜",type:"吴国"},106:{name:"太史慈",type:"吴国"},107:{name:"吕布",type:"群雄"},108:{name:"华佗",type:"群雄"},109:{name:"甄姬",type:"魏国"},110:{name:"黄月英",type:"蜀国"},111:{name:"孙策",type:"吴国"},112:{name:"贾诩",type:"群雄"},113:{name:"曹仁",type:"魏国"},114:{name:"姜维",type:"蜀国"},115:{name:"孙坚",type:"吴国"},116:{name:"公孙瓒",type:"群雄"},117:{name:"典韦",type:"魏国"},118:{name:"赵云",type:"蜀国"},119:{name:"大乔",type:"吴国"},120:{name:"张角",type:"群雄"},201:{name:"徐晃",type:"魏国"},202:{name:"荀彧",type:"魏国"},203:{name:"典韦",type:"魏国"},204:{name:"张飞",type:"蜀国"},205:{name:"赵云",type:"蜀国"},206:{name:"庞统",type:"蜀国"},207:{name:"鲁肃",type:"吴国"},208:{name:"陆逊",type:"吴国"},209:{name:"甘宁",type:"吴国"},210:{name:"貂蝉",type:"群雄"},211:{name:"董卓",type:"群雄"},212:{name:"张角",type:"群雄"},213:{name:"张辽",type:"魏国"},214:{name:"夏侯惇",type:"魏国"},215:{name:"许褚",type:"魏国"},216:{name:"夏侯渊",type:"魏国"},217:{name:"魏延",type:"蜀国"},218:{name:"黄忠",type:"蜀国"},219:{name:"马超",type:"蜀国"},220:{name:"马岱",type:"蜀国"},221:{name:"吕蒙",type:"吴国"},222:{name:"黄盖",type:"吴国"},223:{name:"蔡文姬",type:"魏国"},224:{name:"小乔",type:"吴国"},225:{name:"袁绍",type:"群雄"},226:{name:"华雄",type:"群雄"},227:{name:"颜良",type:"群雄"},228:{name:"文丑",type:"群雄"},301:{name:"周泰",type:"吴国"},302:{name:"许攸",type:"魏国"},303:{name:"于禁",type:"魏国"},304:{name:"张星彩",type:"蜀国"},305:{name:"关银屏",type:"蜀国"},306:{name:"关平",type:"蜀国"},307:{name:"程普",type:"吴国"},308:{name:"张昭",type:"吴国"},309:{name:"陆绩",type:"吴国"},310:{name:"吕玲绮",type:"群雄"},311:{name:"潘凤",type:"群雄"},312:{name:"邢道荣",type:"群雄"},313:{name:"祝融夫人",type:"群雄"},314:{name:"孟获",type:"群雄"}},$=I(()=>s.selectedToken?s.getWebSocketStatus(s.selectedToken.id):"disconnected"),S=I(()=>{var v;return((v=s.gameData)==null?void 0:v.presetTeam)??null});function N(v){var ie;if(!v)return{useTeamId:1,teams:{}};const b=v.presetTeamInfo??v,M=Z=>{if(!Z||typeof Z!="object")return null;if(typeof Z.useTeamId=="number")return Z.useTeamId;for(const H of Object.keys(Z)){const ae=M(Z[H]);if(ae)return ae}return null},W=b.useTeamId??((ie=b.presetTeamInfo)==null?void 0:ie.useTeamId)??M(b)??1,U=b.presetTeamInfo??b,L={},le=Object.keys(U||{}).filter(Z=>/^\d+$/.test(Z));for(const Z of le){const H=Number(Z),ae=U[Z];if(!ae){L[H]={teamInfo:{}};continue}if(ae.teamInfo)L[H]={teamInfo:ae.teamInfo};else if(ae.heroes){const Q={};ae.heroes.forEach((P,i)=>{Q[String(i+1)]=P}),L[H]={teamInfo:Q}}else if(typeof ae=="object"){const Q=Object.values(ae).some(P=>P&&typeof P=="object"&&"heroId"in P);L[H]={teamInfo:Q?ae:{}}}else L[H]={teamInfo:{}}}return{useTeamId:Number(W)||1,teams:L}}const k=I(()=>N(S.value)),z=I(()=>{var M;const v=(M=k.value.teams[_.value])==null?void 0:M.teamInfo;if(!v)return[];const b=[];for(const[W,U]of Object.entries(v)){const L=(U==null?void 0:U.heroId)??(U==null?void 0:U.id);if(!L)continue;const le=B[Number(L)];b.push({id:Number(L),name:(le==null?void 0:le.name)??`英雄${L}`,type:(le==null?void 0:le.type)??"",position:Number(W),level:(U==null?void 0:U.level)??1,avatar:U==null?void 0:U.avatar})}return b.sort((W,U)=>W.position-U.position),b}),g=async(v,b,M={},W="",U=8e3)=>{try{return await s.sendMessageWithPromise(v,b,M,U)}catch(L){throw W&&a.error(`${W}失败：${(L==null?void 0:L.message)??L}`),L}},h=async(v=!1)=>{var M,W;if(!s.selectedToken)return a.warning("请先选择Token"),null;const b=s.selectedToken.id;if(!v){const U=(W=(M=s.gameData)==null?void 0:M.presetTeam)==null?void 0:W.presetTeamInfo;if(U)return U}o.value=!0;try{const U=await g(b,"presetteam_getinfo",{},"获取阵容信息");return s.$patch(L=>{L.gameData={...L.gameData??{},presetTeam:U}}),(U==null?void 0:U.presetTeamInfo)??null}catch(U){return console.error("获取阵容信息失败:",U),null}finally{o.value=!1}},E=()=>{const v=Object.keys(k.value.teams).map(Number).filter(b=>!Number.isNaN(b)).sort((b,M)=>b-M);T.value=v.length?v:[1,2,3,4]},q=()=>{_.value=k.value.useTeamId||1},D=async v=>{if(l.value||o.value)return;if(!s.selectedToken){a.warning("请先选择Token");return}const b=_.value;l.value=!0;try{await g(s.selectedToken.id,"presetteam_saveteam",{teamId:v},`切换到阵容 ${v}`),_.value=v,a.success(`已切换到阵容 ${v}`),await C(!0)}catch{_.value=b}finally{l.value=!1}},C=async(v=!1)=>{await h(v)};return ke(async()=>{s.selectedToken&&$.value==="connected"&&(await C(!1),E(),q(),S.value||(await C(!0),E(),q()))}),me($,(v,b)=>{v==="connected"&&b!=="connected"&&s.selectedToken&&setTimeout(async()=>{await C(!1),E(),q(),S.value||(await C(!0),E(),q())},1e3)}),me(()=>s.selectedToken,async(v,b)=>{v&&v.id!==(b==null?void 0:b.id)&&s.getWebSocketStatus(v.id)==="connected"&&(await C(!0),E(),q())}),me(()=>S.value,()=>{E(),q()},{deep:!0}),(v,b)=>(m(),y("div",xa,[e("div",Da,[b[2]||(b[2]=e("img",{src:We,alt:"阵容",class:"icon"},null,-1)),b[3]||(b[3]=e("div",{class:"info"},[e("h3",null,"阵容"),e("p",null,"当前使用的战斗阵容")],-1)),e("div",Na,[(m(!0),y(pe,null,ye(T.value,M=>(m(),y("button",{key:M,disabled:o.value||l.value,class:de(["team-button",{active:_.value===M}]),onClick:W=>D(M)},f(M),11,Aa))),128)),e("button",{class:"refresh-button",disabled:o.value,title:"刷新队伍数据",onClick:b[0]||(b[0]=M=>C(!0))},[...b[1]||(b[1]=[Ve('<svg class="refresh-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-c736ceea><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" data-v-c736ceea></path><path d="M21 3v5h-5" data-v-c736ceea></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" data-v-c736ceea></path><path d="M3 21v-5h5" data-v-c736ceea></path></svg><span class="refresh-text" data-v-c736ceea>刷新</span>',2)])],8,Wa)])]),e("div",Ra,[e("div",za,[b[4]||(b[4]=e("span",{class:"label"},"当前阵容",-1)),e("span",Ua,[o.value?(m(),y(pe,{key:1},[V("加载中…")],64)):(m(),y(pe,{key:0},[V("阵容 "+f(_.value),1)],64))])]),e("div",Ba,[o.value?se("",!0):(m(),y("div",Ea,[(m(!0),y(pe,null,ye(z.value,M=>{var W;return m(),y("div",{key:M.id||M.name,class:"hero-item"},[e("div",Pa,[M.avatar?(m(),y("img",{key:0,src:M.avatar,alt:M.name,class:"hero-avatar"},null,8,Oa)):(m(),y("div",La,f(((W=M.name)==null?void 0:W.substring(0,2))||"?"),1))]),e("span",Ha,f(M.name||"未知"),1)])}),128))])),!o.value&&!z.value.length?(m(),y("div",Fa,[...b[5]||(b[5]=[e("p",null,"暂无队伍信息",-1)])])):se("",!0),o.value?(m(),y("div",ja,[...b[6]||(b[6]=[e("p",null,"正在加载队伍信息…",-1)])])):se("",!0)])])]))}}),qa=he(Ga,[["__scopeId","data-v-c736ceea"]]),Va={key:0,class:"identity-embedded"},Qa={class:"identity-card embedded"},Ja={class:"role-profile-content"},Ka={class:"avatar-container"},Ya=["src","alt"],Xa={class:"role-info-section"},Za={class:"role-name"},eo={class:"role-stats"},to={class:"level-text"},so={class:"power-value"},no={class:"rank-section"},ao={class:"rank-icon"},oo={class:"rank-title"},lo={key:1,class:"resources"},io={class:"label"},ro={class:"value"},co={key:2,class:"loading"},uo={class:"identity-card"},mo={class:"card-header"},vo={class:"role-profile-content"},po={class:"avatar-container"},fo=["src","alt"],_o={class:"role-info-section"},go={class:"role-name"},ho={class:"role-stats"},yo={class:"level-text"},ko={class:"power-value"},bo={class:"rank-section"},wo={class:"rank-icon"},$o={class:"rank-title"},To={key:1,class:"loading"},Co=Ie({__name:"IdentityCard",props:{visible:{type:Boolean},embedded:{type:Boolean}},emits:["close"],setup(K,{emit:s}){const a=fe(),o=s,l=I(()=>a.selectedToken?a.getWebSocketStatus(a.selectedToken.id):"disconnected"),_=I(()=>{var t,p;const P=a.gameData,i=(t=P==null?void 0:P.roleInfo)==null?void 0:t.role;return i?{roleId:i.roleId,name:i.name,headImg:i.headImg,level:i.level,power:i.power||i.fighting||0,gold:i.gold??0,diamond:i.diamond??0,fishing:i.fishing||i.fish||null,items:i.items||i.itemList||((p=i.bag)==null?void 0:p.items)||i.inventory||null}:{}}),T=I(()=>Object.keys(_.value||{}).length>0),B=["/icons/1733492491706148.png","/icons/1733492491706152.png","/icons/1736425783912140.png","/icons/173746572831736.png","/icons/174023274867420.png"],$=G(""),S=G(""),N=[{min:0,max:1e6,title:"初出茅庐",icon:"🌱",class:"rank-beginner"},{min:1e6,max:1e7,title:"小有名气",icon:"⚔️",class:"rank-known"},{min:1e7,max:1e8,title:"出入江湖",icon:"🗡️",class:"rank-veteran"},{min:1e8,max:5e8,title:"纵横四方",icon:"🏹",class:"rank-master"},{min:5e8,max:2e9,title:"盖世豪杰",icon:"⚡",class:"rank-hero"},{min:2e9,max:4e9,title:"一方枭雄",icon:"👑",class:"rank-overlord"},{min:4e9,max:6e9,title:"睥睨江湖",icon:"🔱",class:"rank-supreme"},{min:6e9,max:9e9,title:"独霸天下",icon:"⚜️",class:"rank-emperor"},{min:9e9,max:15e9,title:"不世之尊",icon:"💎",class:"rank-legend"},{min:15e9,max:1/0,title:"无极至尊",icon:"🌟",class:"rank-infinite"}],k=I(()=>{const P=Number(_.value.power||0);return N.find(i=>P>=i.min&&P<i.max)||N[0]}),z=P=>{if(!P)return"0";const i=1e8,t=1e4;return P>=i?(P/i).toFixed(1)+"亿":P>=t?(P/t).toFixed(1)+"万":P.toLocaleString()},g=P=>{const i=Number(P||0),t=1e8,p=1e4;return i>=t?(i/t).toFixed(1)+"亿":i>=p?(i/p).toFixed(1)+"万":i.toLocaleString()},h=I(()=>_.value.gold??0),E=I(()=>_.value.diamond??0),q=(P,i)=>{if(!P)return null;if(Array.isArray(P)){const p=P.find(c=>Number(c.id??c.itemId)===i);return p?Number(p.num??p.count??p.quantity??0):0}const t=P[String(i)]??P[i];if(t==null){const p=Object.values(P).find(c=>Number((c==null?void 0:c.itemId)??(c==null?void 0:c.id))===i);return p?Number(p.num??p.count??p.quantity??0):0}return typeof t=="number"?Number(t):typeof t=="object"?Number(t.num??t.count??t.quantity??0):Number(t)||0},D=I(()=>_.value.items),C=I(()=>q(D.value,1011)),v=I(()=>q(D.value,1012)),b=I(()=>q(D.value,108)),M=I(()=>q(D.value,1001)),W=I(()=>q(D.value,1006)),U=I(()=>q(D.value,1023)),L=I(()=>q(D.value,1003)),le=I(()=>{var i,t,p,c;const P=C.value;return P??((t=(i=_.value)==null?void 0:i.fishing)==null?void 0:t.normalRod)??((c=(p=_.value)==null?void 0:p.fishing)==null?void 0:c.rod)??null}),ie=I(()=>{var i,t,p,c;const P=v.value;return P??((t=(i=_.value)==null?void 0:i.fishing)==null?void 0:t.goldRod)??((c=(p=_.value)==null?void 0:p.fishing)==null?void 0:c.vipRod)??null}),Z=P=>P==null?"-":g(Number(P)),H=I(()=>[{label:"金币",value:g(h.value)},{label:"金砖",value:g(E.value)},{label:"普通鱼竿",value:Z(le.value)},{label:"金鱼竿",value:Z(ie.value)},{label:"珍珠",value:Z(b.value)},{label:"招募令",value:Z(M.value)},{label:"精铁",value:Z(W.value)},{label:"彩玉",value:Z(U.value)},{label:"进阶石",value:Z(L.value)}]),ae=()=>{if(_.value&&_.value.headImg)$.value=_.value.headImg;else{if(!S.value){const P=_.value.roleId||_.value.name||"default",i=Array.from(String(P)).reduce((t,p)=>t+p.charCodeAt(0),0);S.value=B[i%B.length]}$.value=S.value}},Q=()=>{if(!S.value){const P=Math.floor(Math.random()*B.length);S.value=B[P]}$.value=S.value};return ke(async()=>{if(ae(),a.selectedToken&&l.value==="connected")try{await a.sendMessage(a.selectedToken.id,"role_getroleinfo")}catch{}}),me(()=>_.value,ae,{deep:!0}),(P,i)=>K.embedded?(m(),y("div",Va,[e("div",Qa,[i[2]||(i[2]=e("div",{class:"card-header"},[e("img",{src:We,alt:"身份牌",class:"icon"}),e("div",{class:"info"},[e("h3",null,"身份牌"),e("p",null,"角色与资源概览")])],-1)),T.value?(m(),y("div",{key:0,class:de(["role-profile-header",k.value.class])},[e("div",Ja,[e("div",Ka,[e("img",{src:$.value,alt:_.value.name||"角色",class:"role-avatar",onError:Q},null,40,Ya)]),e("div",Xa,[e("div",Za,f(_.value.name||"未知角色"),1),e("div",eo,[e("span",to,"Lv."+f(_.value.level||1),1),e("span",so,"战力 "+f(z(_.value.power)),1)])]),e("div",no,[e("div",ao,f(k.value.icon),1),e("div",oo,f(k.value.title),1)])])],2)):se("",!0),T.value?(m(),y("div",lo,[(m(!0),y(pe,null,ye(H.value,t=>(m(),y("div",{key:t.label,class:"res-item"},[e("span",io,f(t.label),1),e("span",ro,f(t.value),1)]))),128))])):(m(),y("div",co,"正在获取角色信息..."))])])):(m(),ce(Je,{key:1,name:"drop"},{default:d(()=>[$e(e("div",{class:"identity-overlay",onClick:i[1]||(i[1]=Qe(t=>o("close"),["self"]))},[e("div",uo,[i[6]||(i[6]=e("div",{class:"strap"},[e("div",{class:"strap-tape"}),e("div",{class:"strap-buckle"})],-1)),e("div",mo,[i[3]||(i[3]=e("img",{src:We,alt:"身份牌",class:"icon"},null,-1)),i[4]||(i[4]=e("div",{class:"info"},[e("h3",null,"身份牌"),e("p",null,"角色与战力概览")],-1)),e("button",{class:"close-btn",onClick:i[0]||(i[0]=t=>o("close"))},"✕")]),T.value?(m(),y("div",{key:0,class:de(["role-profile-header",k.value.class])},[e("div",vo,[e("div",po,[e("img",{src:$.value,alt:_.value.name||"角色",class:"role-avatar",onError:Q},null,40,fo)]),e("div",_o,[e("div",go,f(_.value.name||"未知角色"),1),e("div",ho,[e("span",yo,"Lv."+f(_.value.level||1),1),e("span",ko,"战力 "+f(z(_.value.power)),1)])]),e("div",bo,[e("div",wo,f(k.value.icon),1),e("div",$o,f(k.value.title),1)])]),i[5]||(i[5]=e("div",{class:"glow-border"},null,-1))],2)):(m(),y("div",To,"正在获取角色信息..."))])],512),[[Te,K.visible]])]),_:1}))}}),So=he(Co,[["__scopeId","data-v-a13099e7"]]),Io="/icons/173746572831736.png",Mo={class:"time-display"},xo={__name:"BottleHelperCard",setup(K){const s=fe(),a=ge(),o=I(()=>{var S;return((S=s.gameData)==null?void 0:S.roleInfo)||null}),l=G({isRunning:!1,remainingTime:0,stopTime:0}),_=S=>{const N=Math.floor(Number(S)||0);if(N<=0)return"00:00:00";const k=Math.floor(N/3600).toString().padStart(2,"0"),z=Math.floor(N%3600/60).toString().padStart(2,"0"),g=(N%60).toString().padStart(2,"0");return`${k}:${z}:${g}`},T=()=>{var k;const S=(k=o.value)==null?void 0:k.role;if(!(S!=null&&S.bottleHelpers))return;const N=Date.now()/1e3;l.value.stopTime=S.bottleHelpers.helperStopTime,l.value.isRunning=S.bottleHelpers.helperStopTime>N,l.value.remainingTime=Math.max(0,Math.floor(S.bottleHelpers.helperStopTime-N))};me(o,()=>T(),{deep:!0,immediate:!0});let B=null;ke(()=>{B=setInterval(()=>{l.value.isRunning&&l.value.remainingTime>0&&(l.value.remainingTime=Math.max(0,l.value.remainingTime-1),l.value.remainingTime<=0&&(l.value.isRunning=!1))},1e3)}),Me(()=>{B&&clearInterval(B)});const $=()=>{if(!s.selectedToken){a.warning("请先选择Token");return}const S=s.selectedToken.id;s.sendMessage(S,"bottlehelper_stop"),setTimeout(()=>{s.sendMessage(S,"bottlehelper_start"),s.sendMessage(S,"role_getroleinfo")},500),a.info(l.value.isRunning?"重启盐罐机器人":"启动盐罐机器人")};return(S,N)=>{const k=He;return m(),ce(xe,{class:"bottle-helper",statusClass:{active:l.value.isRunning}},{icon:d(()=>[...N[0]||(N[0]=[e("img",{src:Io,alt:"盐罐图标"},null,-1)])]),title:d(()=>[...N[1]||(N[1]=[e("h3",null,"盐罐机器人",-1),e("p",null,"剩余时间",-1)])]),badge:d(()=>[e("span",null,f(l.value.isRunning?"运行中":"已停止"),1)]),default:d(()=>[e("div",Mo,f(_(l.value.remainingTime)),1)]),action:d(()=>[u(k,{type:"primary",secondary:"",size:"small",block:"",onClick:$},{default:d(()=>[V(f(l.value.isRunning?"重启服务":"启动服务"),1)]),_:1})]),_:1},8,["statusClass"])}}},Do=he(xo,[["__scopeId","data-v-e178c49e"]]),No="/icons/174061875626614.png",Ao={class:"time-display"},Wo=["disabled"],Ro={key:0,class:"loading-text"},zo={key:1},Uo=["disabled"],Bo={key:0,class:"loading-text"},Eo={key:1},Po={__name:"HangUpStatusCard",setup(K){const s=fe(),a=ge(),o=I(()=>{var N;return((N=s.gameData)==null?void 0:N.roleInfo)||null}),l=G({isActive:!1,remainingTime:0,elapsedTime:0,lastTime:0,hangUpTime:0,isExtending:!1,isClaiming:!1}),_=N=>{const k=Math.floor(Number(N)||0);if(k<=0)return"00:00:00";const z=Math.floor(k/3600).toString().padStart(2,"0"),g=Math.floor(k%3600/60).toString().padStart(2,"0"),h=(k%60).toString().padStart(2,"0");return`${z}:${g}:${h}`},T=()=>{var g;const N=(g=o.value)==null?void 0:g.role;if(!(N!=null&&N.hangUp))return;const k=Date.now()/1e3;l.value.lastTime=N.hangUp.lastTime,l.value.hangUpTime=N.hangUp.hangUpTime;const z=k-l.value.lastTime;z<=l.value.hangUpTime?(l.value.remainingTime=Math.floor(l.value.hangUpTime-z),l.value.isActive=!0):(l.value.remainingTime=0,l.value.isActive=!1),l.value.elapsedTime=Math.floor(l.value.hangUpTime-l.value.remainingTime)};me(o,()=>T(),{deep:!0,immediate:!0});let B=null;ke(()=>{B=setInterval(()=>{l.value.isActive&&l.value.remainingTime>0&&(l.value.remainingTime=Math.max(0,l.value.remainingTime-1),l.value.elapsedTime=l.value.elapsedTime+1,l.value.remainingTime<=0&&(l.value.isActive=!1))},1e3)}),Me(()=>{B&&clearInterval(B)});const $=async()=>{if(!s.selectedToken)return a.warning("请先选择Token");const N=s.selectedToken.id;try{l.value.isExtending=!0,a.info("正在加钟...");const k=[];for(let z=0;z<4;z++)k.push(new Promise(g=>{setTimeout(()=>{s.sendMessage(N,"system_mysharecallback",{isSkipShareCard:!0,type:2}),g()},z*300)}));await Promise.all(k),setTimeout(()=>s.sendMessage(N,"role_getroleinfo"),1500),setTimeout(()=>{a.success("加钟操作已完成，请查看挂机剩余时间"),l.value.isExtending=!1},2500)}catch(k){a.error("加钟操作失败: "+((k==null?void 0:k.message)||"未知错误")),l.value.isExtending=!1}},S=async()=>{if(!s.selectedToken)return a.warning("请先选择Token");const N=s.selectedToken.id;try{l.value.isClaiming=!0,a.info("正在领取挂机奖励..."),s.sendMessage(N,"system_mysharecallback"),setTimeout(()=>s.sendMessage(N,"system_claimhangupreward"),200),setTimeout(()=>s.sendMessage(N,"system_mysharecallback",{isSkipShareCard:!0,type:2}),400),setTimeout(()=>s.sendMessage(N,"role_getroleinfo"),600),setTimeout(()=>{a.success("挂机奖励领取完成"),l.value.isClaiming=!1},1200)}catch(k){a.error("领取挂机奖励失败: "+((k==null?void 0:k.message)||"未知错误")),l.value.isClaiming=!1}};return(N,k)=>(m(),ce(xe,{class:"hang-up",statusClass:{active:l.value.isActive}},{icon:d(()=>[...k[0]||(k[0]=[e("img",{src:No,alt:"挂机图标"},null,-1)])]),title:d(()=>[k[1]||(k[1]=e("h3",null,"挂机时间",-1)),e("p",null,"已挂机："+f(_(l.value.elapsedTime)),1)]),badge:d(()=>[e("span",null,f(l.value.isActive?"挂机中":"已完成"),1)]),default:d(()=>[e("div",Ao,f(_(l.value.remainingTime)),1)]),action:d(()=>[e("button",{class:"action-button secondary",disabled:l.value.isExtending,onClick:$},[l.value.isExtending?(m(),y("span",Ro,[...k[2]||(k[2]=[e("i",{class:"line-md:loading-loop"},null,-1),V(" 加钟中... ",-1)])])):(m(),y("span",zo,"加钟"))],8,Wo),e("button",{class:"action-button primary",disabled:l.value.isClaiming,onClick:S},[l.value.isClaiming?(m(),y("span",Bo,[...k[3]||(k[3]=[e("i",{class:"line-md:loading-loop"},null,-1),V(" 领取中... ",-1)])])):(m(),y("span",Eo,"领取奖励"))],8,Uo)]),_:1},8,["statusClass"]))}},Oo=he(Po,[["__scopeId","data-v-491764b8"]]),Fe="/icons/1736425783912140.png",Lo={key:0},Ho={key:1},Fo={class:"monthly-row"},jo={class:"row-value"},Go={class:"monthly-row"},qo={class:"row-value"},Vo={class:"action-row"},Qo=["disabled"],be=320,we=240,Jo={__name:"MonthlyTasksCard",setup(K,{expose:s}){const a=fe(),o=ge(),l=G(!1),_=G(!1),T=G(!1),B=G(null),$=new Date,S=new Date($.getFullYear(),$.getMonth()+1,0).getDate(),N=$.getDate(),k=I(()=>Math.max(0,S-N)),z=I(()=>Math.min(1,Math.max(0,N/S))),g=I(()=>{var p;return((p=B.value)==null?void 0:p.myMonthInfo)||{}}),h=I(()=>{var p;return((p=B.value)==null?void 0:p.myArenaInfo)||{}}),E=I(()=>{var p,c;return Number(((c=(p=g.value)==null?void 0:p["2"])==null?void 0:c.num)||0)}),q=I(()=>{var p;return Number(((p=h.value)==null?void 0:p.num)||0)}),D=I(()=>Math.min(100,Math.round(E.value/be*100))),C=I(()=>Math.min(100,Math.round(q.value/we*100))),v=I(()=>k.value===0?be:Math.min(be,Math.ceil(z.value*be))),b=I(()=>k.value===0?we:Math.min(we,Math.ceil(z.value*we))),M=[{label:"一键完成",key:"complete-fish"}],W=[{label:"一键完成",key:"complete-arena"}],U=I(()=>a.selectedToken?a.getWebSocketStatus(a.selectedToken.id)==="connected":!1),L=async()=>{var p;if(!a.selectedToken)return o.warning("请先选择Token");if(U.value){l.value=!0;try{const c=a.selectedToken.id,j=await a.sendMessageWithPromise(c,"activity_get",{},1e4),Y=(j==null?void 0:j.activity)||((p=j==null?void 0:j.body)==null?void 0:p.activity)||j;B.value=Y||null,Y&&o.success("月度任务进度已更新")}catch(c){o.error(`获取月度任务失败：${c.message}`)}finally{l.value=!1}}},le=()=>{const p=new Date;return p.setHours(0,0,0,0),Math.floor(p.getTime()/1e3)},ie=p=>!p||typeof p!="number"?!0:p<le(),Z=p=>{const c=p==="fish",j=c?be:we,Y=c?E.value:q.value,X=c?v.value:b.value,ee=Math.max(0,X-Y);return ee<=0?o.success("当前进度已达标，无需补齐"):c?P(ee,X,j):i(ee,X,j)},H=p=>{const c=p==="fish",j=c?be:we,Y=c?E.value:q.value,X=Math.max(0,j-Y);return X<=0?o.success("已满额，无需完成"):c?P(X,j,j):i(X,j,j)},ae=p=>{p==="complete-fish"&&H("fish")},Q=p=>{p==="complete-arena"&&H("arena")},P=async(p,c,j)=>{var Y,X,ee,A,J;if(!a.selectedToken)return o.warning("请先选择Token");if(!U.value)return o.warning("请先建立WS连接");_.value=!0;try{const ue=a.selectedToken.id;let ve=(X=(Y=a.gameData)==null?void 0:Y.roleInfo)==null?void 0:X.role;if(!ve){try{await a.sendGetRoleInfo(ue)}catch{}ve=(A=(ee=a.gameData)==null?void 0:ee.roleInfo)==null?void 0:A.role}let _e=0;const r=Number(((J=ve==null?void 0:ve.statisticsTime)==null?void 0:J["artifact:normal:lottery:time"])||0);if(ie(r)){o.info("检测到今日免费钓鱼次数，开始消耗 3 次");for(let w=0;w<3;w++)try{await a.sendMessageWithPromise(ue,"artifact_lottery",{lotteryNumber:1,newFree:!0,type:1},8e3),_e++,await new Promise(x=>setTimeout(x,500))}catch{break}_e>0&&await L()}let n=Math.max(0,c-E.value);if(n<=0)return o.success("已通过免费次数完成当日目标");for(o.info(`开始付费钓鱼补齐：共需 ${n} 次（每次最多10）`);n>0;){const w=Math.min(10,n);try{await a.sendMessageWithPromise(ue,"artifact_lottery",{lotteryNumber:w,newFree:!0,type:1},12e3)}catch(x){o.error(`钓鱼失败：${x.message}`);break}n-=w,await new Promise(x=>setTimeout(x,800))}await L(),E.value>=c||E.value>=j?o.success("钓鱼补齐完成"):o.warning("钓鱼补齐已停止，未达到目标")}finally{_.value=!1}},i=async(p,c,j)=>{var Y,X,ee,A,J,ue;if(!a.selectedToken)return o.warning("请先选择Token");if(!U.value)return o.warning("请先建立WS连接");T.value=!0;try{const ve=a.selectedToken.id;try{await a.sendMessageWithPromise(ve,"arena_startarea",{},6e3)}catch{}let _e=0;const r=100;let n=1,w=p;for(;w>0&&_e<r;){const x=Math.ceil(w/2);o.info(`竞技场补齐 第${n}轮：计划战斗 ${x} 场（估算每胜+2）`);for(let O=0;O<x&&_e<r;O++){let F;try{F=await a.sendMessageWithPromise(ve,"arena_getareatarget",{refresh:!1},8e3)}catch{try{F=await a.sendMessageWithPromise(ve,"arena_getareatarget",{refresh:!0},8e3)}catch(R){o.error(`获取竞技场目标失败：${R.message}`);break}}const oe=((X=(Y=F==null?void 0:F.roleList)==null?void 0:Y[0])==null?void 0:X.roleId)||((A=(ee=F==null?void 0:F.targets)==null?void 0:ee[0])==null?void 0:A.roleId)||((ue=(J=F==null?void 0:F.targets)==null?void 0:J[0])==null?void 0:ue.id);if(!oe){o.warning("未找到可用的竞技场目标，已停止此轮");break}try{await a.sendMessageWithPromise(ve,"fight_startareaarena",{targetId:oe},15e3)}catch(R){o.error(`竞技场对决失败：${R.message}`)}_e++,await new Promise(R=>setTimeout(R,1200))}await L(),w=Math.max(0,c-q.value),n++}q.value>=c||q.value>=j?o.success("竞技场补齐完成"):_e>=r?o.warning("达到安全上限，已停止竞技场补齐"):o.warning("竞技场补齐已停止，未达到目标")}finally{T.value=!1}},t=G(!1);return me(()=>a.selectedToken?a.getWebSocketStatus(a.selectedToken.id):"disconnected",p=>{p==="connected"&&!t.value&&(t.value=!0,L())},{immediate:!0}),ke(()=>{a.selectedToken&&U.value&&L()}),s({fetchMonthlyActivity:L}),(p,c)=>{const j=te("n-button"),Y=te("n-dropdown"),X=te("n-button-group");return m(),ce(xe,{class:"monthly-tasks",statusClass:B.value?"active":""},{icon:d(()=>[...c[2]||(c[2]=[e("img",{src:Fe,alt:"月度任务"},null,-1)])]),title:d(()=>[...c[3]||(c[3]=[e("h3",null,"月度任务",-1),e("p",null,"进度与一键补齐",-1)])]),badge:d(()=>[k.value>0?(m(),y("span",Lo,"剩余 "+f(k.value)+" 天",1)):(m(),y("span",Ho,"本月最后一天"))]),default:d(()=>[e("div",Fo,[c[4]||(c[4]=e("div",{class:"row-title"},"钓鱼进度",-1)),e("div",jo,f(E.value)+" / "+f(be)+"（"+f(D.value)+"%）",1)]),e("div",Go,[c[5]||(c[5]=e("div",{class:"row-title"},"竞技场进度",-1)),e("div",qo,f(q.value)+" / "+f(we)+"（"+f(C.value)+"%）",1)]),e("div",Vo,[e("button",{class:"action-button secondary",disabled:l.value||_.value||T.value,onClick:L},f(l.value?"刷新中...":"刷新进度"),9,Qo),u(X,null,{default:d(()=>[u(j,{class:"action-button",disabled:l.value||_.value,onClick:c[0]||(c[0]=ee=>Z("fish"))},{default:d(()=>[V(f(_.value?"补齐中...":"钓鱼补齐"),1)]),_:1},8,["disabled"]),u(Y,{options:M,trigger:"click",onSelect:ae},{default:d(()=>[u(j,{disabled:l.value||_.value},{default:d(()=>[...c[6]||(c[6]=[V("▾",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1}),u(X,null,{default:d(()=>[u(j,{class:"action-button",disabled:l.value||T.value,onClick:c[1]||(c[1]=ee=>Z("arena"))},{default:d(()=>[V(f(T.value?"补齐中...":"竞技场补齐"),1)]),_:1},8,["disabled"]),u(Y,{options:W,trigger:"click",onSelect:Q},{default:d(()=>[u(j,{disabled:l.value||T.value},{default:d(()=>[...c[7]||(c[7]=[V("▾",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})]),e("p",{class:"description muted"}," 补齐规则：让“当前天数比例”和“完成比例”一致；若无剩余天数则按满额（"+f(be)+"/"+f(we)+"）计算。 ")]),_:1},8,["statusClass"])}}},Ko=he(Jo,[["__scopeId","data-v-77b18c56"]]),Yo={__name:"StudyChallengeCard",setup(K){const s=fe(),a=ge(),o=I(()=>s.gameData.studyStatus),l=async()=>{if(!s.selectedToken||o.value.thisWeek||o.value.status!=""&&o.value.status!="idel")return;console.log("开始答题",o.value),o.value.status="starting",await Ke(),o.value.status="answering";const _=await Ye();if(a.info(`🚀 开始一键答题... (题库包含 ${_} 道题目)`),o.value.isCompleted)return a.success("✅ 咸鱼大冲关任务已完成，无需重复作答！");try{s.gameData.studyStatus={...s.gameData.studyStatus,isAnswering:!0,questionCount:0,answeredCount:0,status:"starting",timestamp:Date.now()};const T=s.selectedToken.id;s.sendMessage(T,"study_startgame"),setTimeout(()=>{s.gameData.studyStatus.isAnswering&&(s.gameData.studyStatus={...s.gameData.studyStatus,isAnswering:!1,questionCount:0,answeredCount:0,status:"",timestamp:null},a.warning("答题超时，已自动重置状态"))},4e4),a.info(`🚀 开始一键答题... (题库包含 ${_} 道题目)`)}catch(T){console.error("启动答题失败:",T),a.error("启动答题失败: "+T.message)}};return(_,T)=>{const B=He;return m(),ce(xe,{class:"study",statusClass:{weekly:!0,completed:o.value.isCompleted}},{icon:d(()=>[...T[0]||(T[0]=[e("img",{src:Fe,alt:"学习图标"},null,-1)])]),title:d(()=>[...T[1]||(T[1]=[e("h3",null,"咸鱼大冲关",-1),e("p",null,"每日知识挑战",-1)])]),badge:d(()=>[...T[2]||(T[2]=[e("span",null,"每周任务",-1)])]),default:d(()=>[...T[3]||(T[3]=[e("p",{class:"description"},"没有什么可以阻挡我求知的欲望！",-1)])]),action:d(()=>[o.value.thisWeek?se("",!0):(m(),ce(B,{key:0,status:"primary",onClick:l},{default:d(()=>[...T[4]||(T[4]=[V(" 🎯 一键答题. ",-1)])]),_:1})),!o.value.thisWeek&&o.value.status=="starting"?(m(),ce(B,{key:1,status:"warning",disabled:!0},{default:d(()=>[...T[5]||(T[5]=[V(" 正在获取题库... ",-1)])]),_:1})):se("",!0),!o.value.thisWeek&&o.value.status=="answering"?(m(),ce(B,{key:2,status:"warning",disabled:!0},{default:d(()=>[...T[6]||(T[6]=[V(" 答题中... ",-1)])]),_:1})):se("",!0),!o.value.thisWeek&&o.value.status=="claiming_rewards"?(m(),ce(B,{key:3,status:"warning",disabled:!0},{default:d(()=>[...T[7]||(T[7]=[V(" 正在领取奖励... ",-1)])]),_:1})):se("",!0),!o.value.thisWeek&&o.value.status=="completed"?(m(),ce(B,{key:4,status:"warning",disabled:!0},{default:d(()=>[...T[8]||(T[8]=[V(" 答题完成 ",-1)])]),_:1})):se("",!0),o.value.thisWeek?(m(),ce(B,{key:5,status:"success",disabled:!0},{default:d(()=>[...T[9]||(T[9]=[V(" ✅ 已完成无需作答 ",-1)])]),_:1})):se("",!0)]),_:1},8,["statusClass"])}}},Xo={class:"game-status-container"},Zo={__name:"GameStatus",setup(K){const s=fe();ge();const a=G({isRegistered:!1});G(!1);const o=G("daily");I(()=>{const z=new Date().getDay();return z>=1&&z<=3});const l=G({isRunning:!1,remainingTime:0,stopTime:0}),_=G({isActive:!1,remainingTime:0,elapsedTime:0,lastTime:0,hangUpTime:0,isExtending:!1,isClaiming:!1}),T=G({isSignedIn:!1,clubName:""});I(()=>s.gameData.studyStatus);const B=I(()=>{var z;return((z=s.gameData)==null?void 0:z.roleInfo)||null});I(()=>s.selectedToken?s.getWebSocketStatus(s.selectedToken.id)==="connected":!1);const $=()=>{if(!B.value)return;const z=B.value.role;if(z.bottleHelpers){const g=Date.now()/1e3;l.value.stopTime=z.bottleHelpers.helperStopTime,l.value.isRunning=z.bottleHelpers.helperStopTime>g,l.value.remainingTime=Math.max(0,Math.floor(z.bottleHelpers.helperStopTime-g))}if(z.hangUp){const g=Date.now()/1e3;_.value.lastTime=z.hangUp.lastTime,_.value.hangUpTime=z.hangUp.hangUpTime;const h=g-_.value.lastTime;h<=_.value.hangUpTime?(_.value.remainingTime=Math.floor(_.value.hangUpTime-h),_.value.isActive=!0):(_.value.remainingTime=0,_.value.isActive=!1),_.value.elapsedTime=Math.floor(_.value.hangUpTime-_.value.remainingTime)}if(z.statistics){const g=new Date;g.setHours(0,0,0,0);const h=g.getTime()/1e3;a.value.isRegistered=Number(z.statistics["last:legion:match:sign:up:time"])>h}if(z.statisticsTime){const g=new Date;g.setHours(0,0,0,0);const h=g.getTime()/1e3;T.value.isSignedIn=z.statisticsTime["legion:sign:in"]>h}};let S=null;const N=()=>{S&&clearInterval(S),S=setInterval(()=>{l.value.isRunning&&l.value.remainingTime>0&&(l.value.remainingTime=Math.max(0,l.value.remainingTime-1),l.value.remainingTime<=0&&(l.value.isRunning=!1)),_.value.isActive&&_.value.remainingTime>0&&(_.value.remainingTime=Math.max(0,_.value.remainingTime-1),_.value.elapsedTime=_.value.elapsedTime+1,_.value.remainingTime<=0&&(_.value.isActive=!1))},1e3)};me(B,z=>{z&&$()},{deep:!0,immediate:!0});const k=G(!1);return me(()=>s.selectedToken?s.getWebSocketStatus(s.selectedToken.id):"disconnected",z=>{if(z==="connected"&&!k.value&&s.selectedToken){k.value=!0;const g=s.selectedToken.id;s.sendMessage(g,"legion_getinfo")}}),ke(()=>{if($(),N(),s.selectedToken&&s.getWebSocketStatus(s.selectedToken.id)==="connected"){const z=s.selectedToken.id;s.sendMessage(z,"legion_getinfo"),k.value=!0}}),Me(()=>{S&&clearInterval(S)}),(z,g)=>{const h=So,E=te("n-tab-pane"),q=te("n-tabs"),D=qa,C=Ma,v=Qn,b=Un,M=Ht;return m(),y("div",Xo,[u(h,{embedded:""}),u(q,{class:"section-tabs",value:o.value,"onUpdate:value":g[0]||(g[0]=W=>o.value=W),type:"line",animated:"",size:"small"},{default:d(()=>[u(E,{name:"daily",tab:"日常"}),u(E,{name:"club",tab:"俱乐部"}),u(E,{name:"activity",tab:"活动"})]),_:1},8,["value"]),$e(u(D,null,null,512),[[Te,o.value==="daily"]]),$e(u(C,null,null,512),[[Te,o.value==="daily"]]),$e(u(v,null,null,512),[[Te,o.value==="daily"]]),$e(u(Do,null,null,512),[[Te,o.value==="daily"]]),$e(u(Oo,null,null,512),[[Te,o.value==="daily"]]),se("",!0),se("",!0),o.value==="club"?(m(),ce(b,{key:2})):se("",!0),o.value==="club"?(m(),ce(M,{key:3})):se("",!0),$e(u(Ko,null,null,512),[[Te,o.value==="activity"]]),$e(u(Yo,null,null,512),[[Te,o.value==="activity"]])])}}},el=he(Zo,[["__scopeId","data-v-846adb47"]]),tl={class:"game-features-page"},sl={class:"page-header"},nl={class:"container"},al={class:"header-content"},ol={class:"header-left"},ll={class:"page-subtitle"},il={class:"header-actions"},rl={key:0,class:"feedback-section"},cl={class:"features-grid-section"},ul={class:"container"},dl={class:"ws-status-section"},ml={class:"container"},vl={class:"ws-status-card"},pl={class:"status-header"},fl={class:"status-content"},_l={class:"status-item"},gl={key:0,class:"status-item"},hl={key:1,class:"status-item"},yl={__name:"GameFeatures",setup(K){const s=Xe(),a=ge(),o=fe(),l=G(!0),_=G(null),T=I(()=>o.selectedToken&&o.getWebSocketStatus(o.selectedToken.id)==="connected"?"connected":"disconnected"),B=I(()=>o.selectedToken?o.getWebSocketStatus(o.selectedToken.id)==="connected"?"已连接":"未连接":"未选择Token"),$=I(()=>T.value==="connected"?"status-connected":"status-disconnected"),S=I(()=>T.value==="connected"),N=()=>{if(!o.selectedToken){a.warning("请先选择一个Token"),s.push("/tokens");return}try{const h=o.selectedToken.id,E=o.selectedToken.token;o.createWebSocketConnection(h,E),a.info("正在建立 WebSocket 连接..."),setTimeout(async()=>{o.getWebSocketStatus(h)==="connected"&&(a.success("WebSocket 连接成功"),await g())},2e3)}catch(h){console.error("WebSocket连接失败:",h),a.error("WebSocket连接失败")}},k=()=>{if(o.selectedToken){const h=o.selectedToken.id;o.closeWebSocketConnection(h),a.info("WebSocket连接已断开")}},z=()=>{T.value==="connected"?k():N()};ke(()=>{o.selectedToken&&(o.getWebSocketStatus(o.selectedToken.id)!=="connected"?N():g())}),me(()=>{if(!o.selectedToken)return{status:"disconnected",lastError:null};const h=o.wsConnections[o.selectedToken.id];return{status:h==null?void 0:h.status,lastError:h==null?void 0:h.lastError}},h=>{if(h&&h.status==="error"&&h.lastError){const E=String(h.lastError.error||"").toLowerCase();E.includes("token")&&E.includes("expired")&&(a.error("当前 Token 已过期，请重新导入后再试"),s.push("/tokens"))}},{deep:!0});const g=async()=>{if(o.selectedToken)try{const h=o.selectedToken.id;o.sendMessage(h,"role_getroleinfo"),o.sendMessage(h,"tower_getinfo"),o.sendMessage(h,"presetteam_getinfo")}catch{}};return Me(()=>{}),(h,E)=>{var v;const q=te("n-icon"),D=el,C=te("n-button");return m(),y("div",tl,[e("div",sl,[e("div",nl,[e("div",al,[e("div",ol,[E[0]||(E[0]=e("h1",{class:"page-title"}," 游戏功能 ",-1)),e("p",ll,f(((v=ne(o).selectedToken)==null?void 0:v.name)||"未选择Token"),1)]),e("div",il,[e("div",{class:de(["connection-status",T.value])},[u(q,null,{default:d(()=>[u(ne(ut))]),_:1}),e("span",null,f(B.value),1)],2)])])])]),l.value?(m(),y("div",rl)):se("",!0),e("div",cl,[e("div",ul,[u(D)])]),e("div",dl,[e("div",ml,[e("div",vl,[e("div",pl,[E[1]||(E[1]=e("h3",null,"连接状态",-1)),u(C,{text:"",onClick:z},{default:d(()=>[V(f(S.value?"断开连接":"重新连接"),1)]),_:1})]),e("div",fl,[e("div",_l,[E[2]||(E[2]=e("span",null,"WebSocket状态:",-1)),e("span",{class:de($.value)},f(B.value),3)]),ne(o).selectedToken?(m(),y("div",gl,[E[3]||(E[3]=e("span",null,"当前Token:",-1)),e("span",null,f(ne(o).selectedToken.name),1)])):se("",!0),_.value?(m(),y("div",hl,[E[4]||(E[4]=e("span",null,"最后活动:",-1)),e("span",null,f(_.value),1)])):se("",!0)])])])])])}}},Dl=he(yl,[["__scopeId","data-v-cdd77b84"]]);export{Dl as default};
